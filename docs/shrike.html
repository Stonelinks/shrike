<!DOCTYPE html>

<html>
<head>
  <title>shrike.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>shrike.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>shrike - v0.0.1</p>
<p><a href="https://github.com/Stonelinks/shrike">https://github.com/Stonelinks/shrike</a></p>
<p>A fast and easy to use vector and matrix library</p>
<p>Copyright (c)2014 - Lucas Doyle <a href="&#109;&#x61;&#x69;&#108;&#x74;&#111;&#x3a;&#x6c;&#117;&#x63;&#x61;&#115;&#x2e;&#x70;&#46;&#x64;&#x6f;&#x79;&#x6c;&#101;&#x40;&#103;&#x6d;&#x61;&#105;&#108;&#x2e;&#99;&#x6f;&#x6d;">&#x6c;&#117;&#x63;&#x61;&#115;&#x2e;&#x70;&#46;&#x64;&#x6f;&#x79;&#x6c;&#101;&#x40;&#103;&#x6d;&#x61;&#105;&#108;&#x2e;&#99;&#x6f;&#x6d;</a></p>
<p>Distributed under MIT license</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>

define([<span class="hljs-string">'underscore'</span>, <span class="hljs-string">'mjs'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_, mjs)</span> {</span>
<span class="hljs-pi">  'use strict'</span>;

  <span class="hljs-keyword">var</span> shrike = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Borrow all of window.Math’s functions and constants… except round since shrike provides its own round function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.without(<span class="hljs-built_in">Object</span>.getOwnPropertyNames(<span class="hljs-built_in">Math</span>), <span class="hljs-string">'round'</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(prop)</span> {</span>
    shrike[prop] = <span class="hljs-built_in">Math</span>[prop];
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>Borrow mjs too.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-built_in">Object</span>.getOwnPropertyNames(mjs).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(prop)</span> {</span>
    shrike[prop] = mjs[prop];
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Alias M4x4 to M4 for convenience.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.M4 = shrike.M4x4;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="constant-float_array_type">Constant: FLOAT_ARRAY_TYPE</h2>
<p>The base float array type, borrowed it from mjs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">var</span> FLOAT_ARRAY_TYPE = shrike.FLOAT_ARRAY_TYPE = mjs.FLOAT_ARRAY_TYPE;
  
  shrike.throwError = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(msg)</span> {</span>
    msg = msg || <span class="hljs-string">'undefined error'</span>;
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'SHRIKE: '</span> + msg);
  };
  
  shrike.assert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(cond, msg)</span> {</span>
    <span class="hljs-keyword">if</span> (!cond) {
      shrike.throwError(msg);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2 id="function-shrike-prettyprint">Function: shrike.prettyPrint</h2>
<p>Pretty printing a matrix. TODO: maybe delete this? it is old and never really used.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>x</strong> - whatever it is you’re trying to print.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>nothing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.prettyPrint = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span> {</span>
    console.log(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">if</span> (shrike.isArray(x)) {
  
        <span class="hljs-keyword">if</span> (!shrike.is2DArray(x)) {
          <span class="hljs-keyword">var</span> ret = <span class="hljs-string">'[ '</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(x).join(<span class="hljs-string">', '</span>) + <span class="hljs-string">' ]'</span>;
          <span class="hljs-keyword">return</span> ret;
        }
        <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>find out what the widest number will be</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">var</span> precision = <span class="hljs-number">6</span>;
          <span class="hljs-keyword">var</span> widest = <span class="hljs-number">0</span>;
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; x.length; i++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; x[i].length; j++) {
  
              shrike.assert(!_.isString(x[i][j]), <span class="hljs-string">'prettyPrint: there is a string in this matrix, you should fix that'</span>);
              <span class="hljs-keyword">if</span> (shrike.round(x[i][j], precision).toString().length &gt; widest) {
                widest = shrike.round(x[i][j], precision).toString().length;
              }
            }
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>add spacing and create borders</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">var</span> formatted = [];
          <span class="hljs-keyword">var</span> border = <span class="hljs-literal">undefined</span>;
  
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; x.length; i++) {
            <span class="hljs-keyword">var</span> row = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; x[i].length; j++) {
              <span class="hljs-keyword">var</span> raw = shrike.round(x[i][j], precision).toString();
              <span class="hljs-keyword">var</span> extra_space = widest - raw.length;
              <span class="hljs-keyword">var</span> left = <span class="hljs-string">''</span>;
              <span class="hljs-keyword">var</span> right = <span class="hljs-string">''</span>;
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; extra_space; k++) {
                <span class="hljs-keyword">if</span> (k &gt;= extra_space / <span class="hljs-number">2.0</span>) {
                  left += <span class="hljs-string">' '</span>;
                }
                <span class="hljs-keyword">else</span> {
                  right += <span class="hljs-string">' '</span>;
                }
              }
              row.push(left + raw + right);
            }
            formatted.push(row);
  
            <span class="hljs-keyword">if</span> (border === <span class="hljs-literal">undefined</span>) {
              <span class="hljs-keyword">var</span> spacers = [];
              <span class="hljs-keyword">var</span> spacer = <span class="hljs-string">''</span>;
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; widest; k++) {
                spacer += <span class="hljs-string">'-'</span>;
              }
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; row.length; k++) {
                spacers.push(spacer);
              }
              border = <span class="hljs-string">'+-'</span> + spacers.join(<span class="hljs-string">'-+-'</span>) + <span class="hljs-string">'-+'</span>;
            }
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>actually print everything</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">var</span> ret = border + <span class="hljs-string">'\n'</span>;
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; x.length; i++) {
            <span class="hljs-keyword">var</span> row = formatted[i];
            <span class="hljs-keyword">var</span> line = <span class="hljs-string">'| '</span> + row.join(<span class="hljs-string">' | '</span>) + <span class="hljs-string">' |'</span>;
            ret += line + <span class="hljs-string">'\n'</span>;
            ret += border + <span class="hljs-string">'\n'</span>;
          }
          <span class="hljs-keyword">return</span> ret;
        }
      }
      <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>not an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> x;
      }
    }());
  };
  window.pp = shrike.prettyPrint;</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2 id="function-shrike-isarray">Function: shrike.isArray</h2>
<p>A safer version of _.isArray that works with float32 array types.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>a</strong> - the array / object / whatever operand.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>true or false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.isArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
    <span class="hljs-keyword">if</span> (_.isArray(a)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
  
    <span class="hljs-keyword">return</span> shrike.isTypedArray(a);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h2 id="function-shrike-istypedarray">Function: shrike.isTypedArray</h2>
<p>Detects if something is a float array.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>a</strong> - the array / object / whatever operand.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>true or false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.isTypedArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> (_.isArray(a) !== <span class="hljs-literal">true</span>) &amp;&amp; <span class="hljs-built_in">Object</span>.prototype.toString.call(a).slice(-<span class="hljs-string">'Array]'</span>.length) == <span class="hljs-string">'Array]'</span>;
    }
    <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2 id="function-shrike-is2darray">Function: shrike.is2DArray</h2>
<p>Detects if something is a 2d array.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>a</strong> - the array / object / whatever operand.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>true or false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.is2DArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
    <span class="hljs-keyword">if</span> (!shrike.isArray(a)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  
    <span class="hljs-keyword">if</span> (shrike.isTypedArray(a)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  
    <span class="hljs-keyword">if</span> (a.length === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  
    <span class="hljs-keyword">return</span> _.every(_.map(a, shrike.isArray));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <h2 id="function-shrike-isnumber">Function: shrike.isNumber</h2>
<p>Detects if something is a number or numeric type, or can be converted into one.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>a</strong> - the operand.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>true or false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.isNumber = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
    <span class="hljs-keyword">return</span> !<span class="hljs-built_in">isNaN</span>(<span class="hljs-built_in">parseFloat</span>(a)) &amp;&amp; <span class="hljs-built_in">isFinite</span>(a) &amp;&amp; !shrike.isArray(a);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <h2 id="function-shrike-tofloat">Function: shrike.toFloat</h2>
<p>Converts the argument to a float value.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>thing</strong> - thing you’re trying to convert.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>A new vector containing with the given argument values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.toFloat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(thing)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>its a number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (shrike.isNumber(thing)) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(thing);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>its already floating point</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (shrike.isTypedArray(thing)) {
      <span class="hljs-keyword">return</span> thing;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>its an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (shrike.isArray(thing)) {
  
      <span class="hljs-keyword">var</span> _convert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(thing)</span> {</span>
  
        shrike.assert(shrike.isNumber(thing), <span class="hljs-string">'toFloat: array has something in it that is not a number: '</span> + thing);
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(thing);
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>its a 2d array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (shrike.is2DArray(thing)) {
        <span class="hljs-keyword">return</span> _.map(thing, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(row)</span> {</span>
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE(_.map(row, _convert));
        });
      }
      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE(_.map(thing, _convert));
      }
    }
    <span class="hljs-keyword">else</span> {
      shrike.throwError(<span class="hljs-string">'toFloat: can not convert to float: '</span> + thing);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h2 id="function-shrike-tountypedarray">Function: shrike.toUntypedArray</h2>
<p>Converts the argument to an untyped array.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>thing</strong> - thing you’re trying to convert.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>A new plain converted array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.toUntypedArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
  
    shrike.assert(shrike.isArray(a), <span class="hljs-string">'toUntypedArray: needs to be a float array or array like object: '</span> + a);
  
    <span class="hljs-keyword">if</span> (shrike.isTypedArray(a)) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>.apply([], a);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <h2 id="function-shrike-unitconversionscale">Function: shrike.unitConversionScale</h2>
<p>Return a scale so that X source * scale = Y target.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>sourceUnit</strong> - the source unit.</li>
<li><strong>targetUnit</strong> - the target unit.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float scale.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.unitConversionScale = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sourceUnit, targetUnit)</span> {</span>
    <span class="hljs-keyword">var</span> unitDict = {
      m: <span class="hljs-number">1.0</span>,
      meter: <span class="hljs-number">1.0</span>,
      cm: <span class="hljs-number">100.0</span>,
      mm: <span class="hljs-number">1000.0</span>,
      um: <span class="hljs-number">1e6</span>,
      nm: <span class="hljs-number">1e9</span>,
      inch: <span class="hljs-number">39.370078740157481</span>,
      <span class="hljs-keyword">in</span> : <span class="hljs-number">39.370078740157481</span>
    };
    <span class="hljs-keyword">var</span> units = _.keys(unitDict);
  
    shrike.assert(_.contains(units, targetUnit) &amp;&amp; _.contains(units, sourceUnit), <span class="hljs-string">'no conversion for either '</span> + sourceUnit + <span class="hljs-string">' or '</span> + targetUnit);
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(unitDict[targetUnit] / unitDict[sourceUnit]);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h2 id="function-shrike-todegrees">Function: shrike.toDegrees</h2>
<p>Converts a number, 1 or 2d array of angles in degrees to radians.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>x</strong> - the item being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>the converted value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.toDegrees = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span> {</span>
    <span class="hljs-keyword">var</span> _convert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span> {</span>
  
      shrike.assert(shrike.isNumber(n), <span class="hljs-string">'toDegrees: not a number'</span>);
      <span class="hljs-keyword">if</span> (shrike.abs(n) &lt;= <span class="hljs-number">1e-10</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>;
      }
      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> (<span class="hljs-number">180.0</span> / shrike.PI) * n;
      }
    };
  
    <span class="hljs-keyword">if</span> (shrike.isNumber(x)) {
      <span class="hljs-keyword">return</span> _convert(x);
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> shrike.scalarIterator(x, _convert);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <h2 id="function-shrike-toradians">Function: shrike.toRadians</h2>
<p>Converts a number, 1 or 2d array of angles in radians to degrees.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>x</strong> - the item being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.toRadians = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span> {</span>
    <span class="hljs-keyword">var</span> _convert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span> {</span>
  
      shrike.assert(shrike.isNumber(n), <span class="hljs-string">'toRadians: not a number'</span>);
      <span class="hljs-keyword">return</span> (shrike.PI / <span class="hljs-number">180.0</span>) * n;
    };
  
    <span class="hljs-keyword">if</span> (shrike.isNumber(x)) {
      <span class="hljs-keyword">return</span> _convert(x);
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> shrike.scalarIterator(x, _convert);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <h2 id="function-shrike-matrix4to3">Function: shrike.matrix4to3</h2>
<p>Carves out the 3x3 rotation matrix out of a 3x4 or 4x4 transform.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>M</strong> - the source matrix.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float 3x3 rotation matrix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.matrix4to3 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(M)</span> {</span>
    <span class="hljs-keyword">return</span> [
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([M[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], M[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], M[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>]]),
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([M[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], M[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>], M[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]]),
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([M[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>], M[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>], M[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]])
      ];
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h2 id="function-shrike-composetransformarray">Function: shrike.composeTransformArray</h2>
<p>Make a 4x4 transform from a 3x3 rotation matrix and a translation vector.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>rot</strong> - the rotation matrix.</li>
<li><strong>trans</strong> - the translation vector.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the 4x4 result matrix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.composeTransformArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(rot, trans)</span> {</span>
    <span class="hljs-keyword">return</span> [
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([rot[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], rot[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], rot[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>], trans[<span class="hljs-number">0</span>]]),
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([rot[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], rot[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>], rot[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>], trans[<span class="hljs-number">1</span>]]),
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([rot[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>], rot[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>], rot[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>], trans[<span class="hljs-number">2</span>]]),
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>])
      ];
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h2 id="function-shrike-decomposetransformarray">Function: shrike.decomposeTransformArray</h2>
<p>Break a 4x4 transform down into a 3x3 rotation matrix and a translation vector.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>T</strong> - the source matrix.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>an object that looks like this</p>
<pre><code>{
  rotationMatrix: <span class="hljs-number">3</span>x3 rotation matrix,
  translation: [float x, float y, float z],
}
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.decomposeTransformArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(T)</span> {</span>
    <span class="hljs-keyword">return</span> {
      rotationMatrix: [
        <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], T[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>]]),
        <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>], T[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]]),
        <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>], T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>], T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]])
      ],
      translation: <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([T[<span class="hljs-number">0</span>][<span class="hljs-number">3</span>], T[<span class="hljs-number">1</span>][<span class="hljs-number">3</span>], T[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>]])
    };
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h2 id="function-shrike-scalariterator">Function: shrike.scalarIterator</h2>
<p>Iterates through an array and applies a function to every element.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>A</strong> - 1d or 2d array.</li>
<li><strong>_function</strong> - function to be called with each element supplied as its single argument.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>The modified array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.scalarIterator = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(A, _function)</span> {</span>
    _function = _function || pass;
    <span class="hljs-keyword">if</span> (shrike.is2DArray(A)) {
      <span class="hljs-keyword">return</span> _.map(A, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span> {</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE(_.map(element, _function));
      });
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (shrike.isArray(A)) {
      <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE(A.length);
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; A.length; i++) {
        ret[i] = _function(A[i]);
      }
      <span class="hljs-keyword">return</span> ret;
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> _function(A);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h2 id="function-shrike-sum">Function: shrike.sum</h2>
<p>Sum up a 1d array.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>a</strong> - the array operand.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float sum.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.sum = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
  
    shrike.assert(shrike.isArray(a), <span class="hljs-string">'can\'t compute sum of non-array '</span> + a);
    <span class="hljs-keyword">return</span> _.reduce(shrike.toFloat(a), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(memo, num)</span> {</span>
      <span class="hljs-keyword">if</span> (!shrike.isNumber(num)) {
        shrike.throwError(<span class="hljs-string">'can\'t compute sum of array with non numeric element: '</span> + num);
      }
  
      <span class="hljs-keyword">return</span> memo + num;
    }, <span class="hljs-number">0.0</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h2 id="function-shrike-square">Function: shrike.square</h2>
<p>Square a number.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>x</strong> - the numeric operand.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.square = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span> {</span>
  
    shrike.assert(shrike.isNumber(x), <span class="hljs-string">'can\'t square non numeric element: '</span> + x);
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(x) * <span class="hljs-built_in">parseFloat</span>(x);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h2 id="function-shrike-round">Function: shrike.round</h2>
<p>Round a number to a an arbitrary precision.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>x</strong> - numeric operand.</li>
<li><strong>dec</strong> - (optional) the number of decimal places, defaults to zero.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float rounded number.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.round = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n, dec)</span> {</span>
    <span class="hljs-keyword">if</span> (dec === <span class="hljs-literal">undefined</span>) {
      dec = <span class="hljs-number">0</span>;
    }
  
    shrike.assert(shrike.isNumber(dec), <span class="hljs-string">'round: '</span> + dec + <span class="hljs-string">' is not valid number of decimal places'</span>);
    shrike.assert(dec &lt;= <span class="hljs-number">20</span>, <span class="hljs-string">'round: can only round up to 20 decimal places'</span>);
    shrike.assert(shrike.isNumber(n), <span class="hljs-string">'round: '</span> + n + <span class="hljs-string">' is not a numeric type'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Number</span>(n + <span class="hljs-string">''</span>).toFixed(<span class="hljs-built_in">parseInt</span>(dec)));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h2 id="function-shrike-roundarray">Function: shrike.roundArray</h2>
<p>Round each element in an array to a an arbitrary precision.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>A</strong> - numeric array operand.</li>
<li><strong>dec</strong> - (optional) the number of decimal places, defaults to zero.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float rounded array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.roundArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(A, dec)</span> {</span>
    shrike.throwError(shrike.isArray(A), <span class="hljs-string">'roundArray: not an array'</span>);
    <span class="hljs-keyword">return</span> shrike.scalarIterator(A, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
      <span class="hljs-keyword">return</span> shrike.round(a, dec);
    });
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <h2 id="function-shrike-divide">Function: shrike.divide</h2>
<p>Divides an arbitrarily large 1 or 2d array by a scalar.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>A</strong> - the source array.</li>
<li><strong>scalar</strong> - scalar that each element in the array will be be divided by.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the result array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.divide = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(A, scalar)</span> {</span>
    <span class="hljs-keyword">return</span> shrike.scalarIterator(shrike.toFloat(A), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
      <span class="hljs-keyword">return</span> a / <span class="hljs-built_in">parseFloat</span>(scalar);
    });
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h2 id="function-shrike-magnitude">Function: shrike.magnitude</h2>
<p>Matrix or vector norm.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>a</strong> - source.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.magnitude = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
    <span class="hljs-keyword">if</span> (shrike.isTypedArray(a)) {
  
      shrike.assert(a.length === <span class="hljs-number">3</span> || a.length === <span class="hljs-number">4</span>, <span class="hljs-string">'magnitude: native float array\'s need to be of length 3 or 4'</span>);
      <span class="hljs-keyword">if</span> (a.length === <span class="hljs-number">3</span>) {
        <span class="hljs-keyword">return</span> shrike.sqrt(a[<span class="hljs-number">0</span>] * a[<span class="hljs-number">0</span>] + a[<span class="hljs-number">1</span>] * a[<span class="hljs-number">1</span>] + a[<span class="hljs-number">2</span>] * a[<span class="hljs-number">2</span>]);
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (a.length === <span class="hljs-number">4</span>) {
        <span class="hljs-keyword">return</span> shrike.sqrt(a[<span class="hljs-number">0</span>] * a[<span class="hljs-number">0</span>] + a[<span class="hljs-number">1</span>] * a[<span class="hljs-number">1</span>] + a[<span class="hljs-number">2</span>] * a[<span class="hljs-number">2</span>] + a[<span class="hljs-number">3</span>] * a[<span class="hljs-number">3</span>]);
      }
      <span class="hljs-keyword">else</span> {
        shrike.throwError(<span class="hljs-string">'magnitude: incorrect native float array length'</span>);
      }
    }
    <span class="hljs-keyword">return</span> shrike.sqrt(shrike.sum(_.map(shrike.toFloat(a), shrike.square)));
  };
  
  shrike.norm = shrike.magnitude;</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h2 id="function-shrike-normalize">Function: shrike.normalize</h2>
<p>Matrix or vector normalization.
TODO: make a V3.normalize</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>a</strong> - source.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float normalized array or matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.normalize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(array)</span> {</span>
    <span class="hljs-keyword">var</span> length = shrike.magnitude(array);
  
    shrike.assert(length !== <span class="hljs-number">0</span>, <span class="hljs-string">'normalize: trying to normalize a zero array'</span>);
    <span class="hljs-keyword">return</span> shrike.divide(array, length);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <h2 id="function-shrike-eye">Function: shrike.eye</h2>
<p>Makes an identity matrix.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>m</strong> - number of columns.</li>
<li><strong>n</strong> - (optional) number of rows. If left unspecified, result will be an m x m matrix</li>
</ul>
<p><strong>Returns:</strong></p>
<p>An m x n identity matrix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.eye = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m, n)</span> {</span>
    n = n || m;
    <span class="hljs-keyword">var</span> ret = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
      <span class="hljs-keyword">var</span> row = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; m; j++) {
        <span class="hljs-keyword">if</span> (i == j) {
          row.push(<span class="hljs-number">1.0</span>);
        }
        <span class="hljs-keyword">else</span> {
          row.push(<span class="hljs-number">0.0</span>);
        }
      }
      ret.push(row);
    }
    <span class="hljs-keyword">return</span> ret;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <h2 id="function-shrike-matrixmult">Function: shrike.matrixMult</h2>
<p>Unfancy 2d matrix multiplication.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>_A</strong> - first array operand.</li>
<li><strong>_B</strong> - second array operand.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float result of A * B</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.matrixMult = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_A, _B)</span> {</span>
    <span class="hljs-keyword">var</span> A = shrike.toFloat(_A);
    <span class="hljs-keyword">var</span> B = shrike.toFloat(_B);
  
    shrike.assert(A[<span class="hljs-number">0</span>].length === A.length, <span class="hljs-string">'matrixMult: incompatible array sizes!'</span>);
    <span class="hljs-keyword">var</span> result = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; A.length; i++) {
      <span class="hljs-keyword">var</span> row = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; B[i].length; j++) {
        <span class="hljs-keyword">var</span> sum = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; A[i].length; k++) {
          sum += A[i][k] * B[k][j];
        }
        row.push(sum);
      }
      result.push(row);
    }
  
    <span class="hljs-keyword">return</span> result;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h2 id="function-shrike-matrixfromquat">Function: shrike.matrixFromQuat</h2>
<p>Convert a matrix from quaternion.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>quatRaw</strong> - the quaternion being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted matrix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.matrixFromQuat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(quatRaw)</span> {</span>
    <span class="hljs-keyword">var</span> quat = shrike.toFloat(quatRaw);
  
    <span class="hljs-keyword">var</span> length2 = shrike.square(shrike.magnitude(quat));
    <span class="hljs-keyword">if</span> (length2 &lt;= <span class="hljs-number">1e-8</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>invalid quaternion, so return identity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> m.eye(<span class="hljs-number">4</span>);
    }
    <span class="hljs-keyword">var</span> ilength2 = <span class="hljs-number">2.0</span> / length2;
  
    <span class="hljs-keyword">var</span> qq1 = ilength2 * quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">var</span> qq2 = ilength2 * quat[<span class="hljs-number">2</span>] * quat[<span class="hljs-number">2</span>];
    <span class="hljs-keyword">var</span> qq3 = ilength2 * quat[<span class="hljs-number">3</span>] * quat[<span class="hljs-number">3</span>];
  
    <span class="hljs-keyword">var</span> T = shrike.eye(<span class="hljs-number">4</span>);
  
    T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">1.0</span> - qq2 - qq3;
    T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">2</span>] - quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">3</span>]);
    T[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">3</span>] + quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">2</span>]);
    T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">2</span>] + quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">3</span>]);
    T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = <span class="hljs-number">1.0</span> - qq1 - qq3;
    T[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>] = ilength2 * (quat[<span class="hljs-number">2</span>] * quat[<span class="hljs-number">3</span>] - quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">1</span>]);
    T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">3</span>] - quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">2</span>]);
    T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>] = ilength2 * (quat[<span class="hljs-number">2</span>] * quat[<span class="hljs-number">3</span>] + quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">1</span>]);
    T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] = <span class="hljs-number">1.0</span> - qq1 - qq2;
  
    <span class="hljs-keyword">return</span> T;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <h2 id="function-shrike-matrixfromzxy">Function: shrike.matrixFromZXY</h2>
<p>Convert a zxy angle array into matrix representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>ZXY</strong> - the zxy angle array being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted matrix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.matrixFromZXY = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ZXY)</span> {</span>
  
    <span class="hljs-keyword">var</span> x = shrike.toRadians(<span class="hljs-built_in">parseFloat</span>(ZXY[<span class="hljs-number">0</span>]));
    <span class="hljs-keyword">var</span> y = shrike.toRadians(<span class="hljs-built_in">parseFloat</span>(ZXY[<span class="hljs-number">1</span>]));
    <span class="hljs-keyword">var</span> z = shrike.toRadians(<span class="hljs-built_in">parseFloat</span>(ZXY[<span class="hljs-number">2</span>]));
    <span class="hljs-keyword">return</span> [
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([
      -<span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.sin(z) + <span class="hljs-built_in">Math</span>.cos(y) * <span class="hljs-built_in">Math</span>.cos(z),
      -<span class="hljs-built_in">Math</span>.sin(z) * <span class="hljs-built_in">Math</span>.cos(x),
      <span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.sin(z) * <span class="hljs-built_in">Math</span>.cos(y) + <span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.cos(z)
    ]),
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([
      <span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.cos(z) + <span class="hljs-built_in">Math</span>.sin(z) * <span class="hljs-built_in">Math</span>.cos(y),
      <span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.cos(z),
      -<span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.cos(y) * <span class="hljs-built_in">Math</span>.cos(z) + <span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.sin(z)
    ]),
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([
      -<span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.cos(x),
      <span class="hljs-built_in">Math</span>.sin(x),
      <span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.cos(y)
    ])
      ];
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <h2 id="function-shrike-matrixfromzyx">Function: shrike.matrixFromZYX</h2>
<p>Convert a zyx angle array into matrix representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>Traw</strong> - the matrix being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted matrix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.matrixFromZYX = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ZYX)</span> {</span>
    <span class="hljs-keyword">var</span> x = shrike.toRadians(<span class="hljs-built_in">parseFloat</span>(ZYX[<span class="hljs-number">0</span>]));
    <span class="hljs-keyword">var</span> y = shrike.toRadians(<span class="hljs-built_in">parseFloat</span>(ZYX[<span class="hljs-number">1</span>]));
    <span class="hljs-keyword">var</span> z = shrike.toRadians(<span class="hljs-built_in">parseFloat</span>(ZYX[<span class="hljs-number">2</span>]));
    <span class="hljs-keyword">return</span> [
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([
      <span class="hljs-built_in">Math</span>.cos(y) * <span class="hljs-built_in">Math</span>.cos(z),
      -<span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.sin(z) + <span class="hljs-built_in">Math</span>.cos(z) * <span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.sin(y),
      <span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.sin(z) + <span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.cos(z) * <span class="hljs-built_in">Math</span>.sin(y)
    ]),
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([
      <span class="hljs-built_in">Math</span>.cos(y) * <span class="hljs-built_in">Math</span>.sin(z),
      <span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.cos(z) + <span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.sin(z),
      -<span class="hljs-built_in">Math</span>.cos(z) * <span class="hljs-built_in">Math</span>.sin(x) + <span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.sin(z)
    ]),
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([
      -<span class="hljs-built_in">Math</span>.sin(y),
      <span class="hljs-built_in">Math</span>.cos(y) * <span class="hljs-built_in">Math</span>.sin(x),
      <span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.cos(y)
    ])
      ];
  };
  
  shrike.quat = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <h2 id="function-shrike-quat-fromaxisangle">Function: shrike.quat.fromAxisAngle</h2>
<p>Convert a quaternion from axis angle (radians).</p>
<p><strong>Parameters:</strong></p>
<ul>
<li>Can be an object with axis and angle properties</li>
<li>or an array of 3 values for the axis and an angle as the second argument</li>
<li>or an array of 4 values, first three being axis and the last one angle</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted quaternion.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.quat.fromAxisAngle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_axis, _angle)</span> {</span>
    <span class="hljs-keyword">var</span> aa = shrike.axisAngle.$(_axis, _angle);
    <span class="hljs-keyword">var</span> axis = aa.axis;
    <span class="hljs-keyword">var</span> angle = aa.angle;
  
    <span class="hljs-keyword">var</span> axisLength = shrike.sum(_.map(axis, shrike.square));
    <span class="hljs-keyword">if</span> (axisLength &lt;= <span class="hljs-number">1e-10</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>]);
    }
    <span class="hljs-keyword">var</span> halfangle = angle / <span class="hljs-number">2.0</span>;
    <span class="hljs-keyword">var</span> sinangle = <span class="hljs-built_in">Math</span>.sin(halfangle) / <span class="hljs-built_in">Math</span>.sqrt(axisLength);</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>TODO: return a float array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([<span class="hljs-built_in">Math</span>.cos(halfangle), axis[<span class="hljs-number">0</span>] * sinangle, axis[<span class="hljs-number">1</span>] * sinangle, axis[<span class="hljs-number">2</span>] * sinangle]);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <h2 id="function-shrike-quat-frommatrix">Function: shrike.quat.fromMatrix</h2>
<p>Convert a quaternion from matrix.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>Traw</strong> - the matrix being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted quaternion.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.quat.fromMatrix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Traw)</span> {</span>
  
    <span class="hljs-keyword">var</span> T = shrike.toFloat(Traw);
  
    <span class="hljs-keyword">var</span> tr = T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] + T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>];
    <span class="hljs-keyword">var</span> r = <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>]);
    <span class="hljs-keyword">if</span> (tr &gt;= <span class="hljs-number">0.0</span>) {
      r[<span class="hljs-number">0</span>] = tr + <span class="hljs-number">1.0</span>;
      r[<span class="hljs-number">1</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>] - T[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]);
      r[<span class="hljs-number">2</span>] = (T[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] - T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]);
      r[<span class="hljs-number">3</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] - T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]);
    }
    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>find the largest diagonal element and jump to the appropriate case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] &gt; T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]) {
        <span class="hljs-keyword">if</span> (T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] &gt; T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]) {
          r[<span class="hljs-number">3</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] - (T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>])) + <span class="hljs-number">1.0</span>;
          r[<span class="hljs-number">1</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] + T[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>]);
          r[<span class="hljs-number">2</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>] + T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>]);
          r[<span class="hljs-number">0</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] - T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]);
        }
        <span class="hljs-keyword">else</span> {
          r[<span class="hljs-number">2</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] - (T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] + T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>])) + <span class="hljs-number">1.0</span>;
          r[<span class="hljs-number">3</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>] + T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>]);
          r[<span class="hljs-number">1</span>] = (T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] + T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]);
          r[<span class="hljs-number">0</span>] = (T[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] - T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]);
        }
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] &gt; T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]) {
        r[<span class="hljs-number">3</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] - (T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>])) + <span class="hljs-number">1.0</span>;
        r[<span class="hljs-number">1</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] + T[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>]);
        r[<span class="hljs-number">2</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>] + T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>]);
        r[<span class="hljs-number">0</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] - T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]);
      }
      <span class="hljs-keyword">else</span> {
        r[<span class="hljs-number">1</span>] = (T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] - (T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] + T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>])) + <span class="hljs-number">1.0</span>;
        r[<span class="hljs-number">2</span>] = (T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] + T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]);
        r[<span class="hljs-number">3</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] + T[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>]);
        r[<span class="hljs-number">0</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>] - T[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]);
      }
    }
  
    <span class="hljs-keyword">return</span> shrike.divide(r, shrike.magnitude(r));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h2 id="function-shrike-quat-fromm4">Function: shrike.quat.fromM4</h2>
<p>Convert a quaternion from an M4.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>_m</strong> - the M4 being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted quaternion.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.quat.fromM4 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_m)</span> {</span>
  
    <span class="hljs-keyword">var</span> m = shrike.toFloat(_m);
  
    <span class="hljs-keyword">var</span> m11 = m[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">var</span> m21 = m[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">var</span> m31 = m[<span class="hljs-number">2</span>];
    <span class="hljs-keyword">var</span> m12 = m[<span class="hljs-number">4</span>];
    <span class="hljs-keyword">var</span> m22 = m[<span class="hljs-number">5</span>];
    <span class="hljs-keyword">var</span> m32 = m[<span class="hljs-number">6</span>];
    <span class="hljs-keyword">var</span> m13 = m[<span class="hljs-number">8</span>];
    <span class="hljs-keyword">var</span> m23 = m[<span class="hljs-number">9</span>];
    <span class="hljs-keyword">var</span> m33 = m[<span class="hljs-number">10</span>];
  
    <span class="hljs-keyword">var</span> tr = m11 + m22 + m33;
    <span class="hljs-keyword">var</span> r = <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>]);
    <span class="hljs-keyword">if</span> (tr &gt;= <span class="hljs-number">0.0</span>) {
      r[<span class="hljs-number">0</span>] = tr + <span class="hljs-number">1.0</span>;
      r[<span class="hljs-number">1</span>] = (m32 - m23);
      r[<span class="hljs-number">2</span>] = (m13 - m31);
      r[<span class="hljs-number">3</span>] = (m21 - m12);
    }
    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>find mhe largesm diagonal elemenm and jump mo mhe appropriame case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (m22 &gt; m11) {
        <span class="hljs-keyword">if</span> (m33 &gt; m22) {
          r[<span class="hljs-number">3</span>] = (m33 - (m11 + m22)) + <span class="hljs-number">1.0</span>;
          r[<span class="hljs-number">1</span>] = (m31 + m13);
          r[<span class="hljs-number">2</span>] = (m23 + m32);
          r[<span class="hljs-number">0</span>] = (m21 - m12);
        }
        <span class="hljs-keyword">else</span> {
          r[<span class="hljs-number">2</span>] = (m22 - (m33 + m11)) + <span class="hljs-number">1.0</span>;
          r[<span class="hljs-number">3</span>] = (m23 + m32);
          r[<span class="hljs-number">1</span>] = (m12 + m21);
          r[<span class="hljs-number">0</span>] = (m13 - m31);
        }
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (m33 &gt; m11) {
        r[<span class="hljs-number">3</span>] = (m33 - (m11 + m22)) + <span class="hljs-number">1.0</span>;
        r[<span class="hljs-number">1</span>] = (m31 + m13);
        r[<span class="hljs-number">2</span>] = (m23 + m32);
        r[<span class="hljs-number">0</span>] = (m21 - m12);
      }
      <span class="hljs-keyword">else</span> {
        r[<span class="hljs-number">1</span>] = (m11 - (m22 + m33)) + <span class="hljs-number">1.0</span>;
        r[<span class="hljs-number">2</span>] = (m12 + m21);
        r[<span class="hljs-number">3</span>] = (m31 + m13);
        r[<span class="hljs-number">0</span>] = (m32 - m23);
      }
    }
  
    <span class="hljs-keyword">return</span> shrike.divide(r, shrike.magnitude(r));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h2 id="function-shrike-quat-fromzxy">Function: shrike.quat.fromZXY</h2>
<p>Convert a zxy angle array into quaternion.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>zxy</strong> - the angle array being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted quaternion.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.quat.fromZXY = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(zxy)</span> {</span>
    <span class="hljs-keyword">return</span> shrike.quat.fromMatrix(shrike.matrixFromZXY(shrike.toFloat(zxy)));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <h2 id="function-shrike-quat-fromzyx">Function: shrike.quat.fromZYX</h2>
<p>Convert a zyx angle array into quaternion.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>zyx</strong> - the angle array being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted quaternion.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.quat.fromZYX = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(zyx)</span> {</span>
    <span class="hljs-keyword">return</span> shrike.quat.fromMatrix(shrike.matrixFromZYX(shrike.toFloat(zyx)));
  };
  
  shrike.axisAngle = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <h2 id="function-shrike-axisangle-">Function: shrike.axisAngle.$</h2>
<p>parses an axis and an angle into an object from some arguments</p>
<p><strong>Parameters:</strong></p>
<ul>
<li>Can be an object with axis and angle properties</li>
<li>or an array of 3 values for the axis and an angle as the second argument</li>
<li>or an array of 4 values, first three being axis and the last one angle</li>
</ul>
<p><strong>Returns:</strong></p>
<p>an object that looks like this:</p>
<pre><code>{
  axis: [float x, float y, float z],
  angle: float
}
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.axisAngle.$ = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(axis, angle)</span> {</span>
    <span class="hljs-keyword">var</span> _axis;
    <span class="hljs-keyword">var</span> _angle;
    <span class="hljs-keyword">var</span> _throwError = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      shrike.throwError(<span class="hljs-string">'axisAngle.$: arguments were not something we recognized'</span>);
    };
  
    <span class="hljs-keyword">if</span> (shrike.isArray(axis)) {
      <span class="hljs-keyword">if</span> (axis.length == <span class="hljs-number">4</span> &amp;&amp; angle === <span class="hljs-literal">undefined</span>) {
        _axis = [axis[<span class="hljs-number">0</span>], axis[<span class="hljs-number">1</span>], axis[<span class="hljs-number">2</span>]];
        _angle = axis[<span class="hljs-number">3</span>];
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (axis.length == <span class="hljs-number">3</span> &amp;&amp; angle !== <span class="hljs-literal">undefined</span>) {
        _axis = axis;
        _angle = angle;
      }
      <span class="hljs-keyword">else</span> {
        _throwError();
      }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isObject(axis) &amp;&amp; angle === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">if</span> (axis.hasOwnProperty(<span class="hljs-string">'axis'</span>) &amp;&amp; axis.hasOwnProperty(<span class="hljs-string">'angle'</span>)) {
        _axis = axis.axis;
        _angle = axis.angle;
      }
      <span class="hljs-keyword">else</span> {
        _throwError();
      }
    }
    <span class="hljs-keyword">else</span> {
      _throwError();
    }
    <span class="hljs-keyword">return</span> {
      axis: shrike.toFloat(_axis),
      angle: <span class="hljs-built_in">parseFloat</span>(_angle)
    };
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <h2 id="function-shrike-axisangle-fromquat">Function: shrike.axisAngle.fromQuat</h2>
<p>Convert a quaternion into axis angle representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>quatRaw</strong> - the quaternion being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted axis angle object (angle is in radians).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.axisAngle.fromQuat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(quatraw)</span> {</span>
  
    <span class="hljs-keyword">var</span> quat = shrike.toFloat(quatraw);
    <span class="hljs-keyword">var</span> sinang = shrike.sum(_.map([quat[<span class="hljs-number">1</span>], quat[<span class="hljs-number">2</span>], quat[<span class="hljs-number">3</span>]], shrike.square));
  
    <span class="hljs-keyword">var</span> identity = {
      axis: <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>]),
      angle: <span class="hljs-number">0.0</span>
    };
    <span class="hljs-keyword">if</span> (sinang === <span class="hljs-number">0.0</span>) {
      <span class="hljs-keyword">return</span> identity;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">0</span>] + sinang &lt;= <span class="hljs-number">1e-8</span>) {
      shrike.throwError(<span class="hljs-string">'invalid quaternion '</span> + quat);
    }
    <span class="hljs-keyword">var</span> _quat;
    <span class="hljs-keyword">if</span> (quat[<span class="hljs-number">0</span>] &lt; <span class="hljs-number">0.0</span>) {
      _quat = <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([-quat[<span class="hljs-number">0</span>], -quat[<span class="hljs-number">1</span>], -quat[<span class="hljs-number">2</span>], -quat[<span class="hljs-number">3</span>]]);
    }
    <span class="hljs-keyword">else</span> {
      _quat = quat;
    }
    sinang = <span class="hljs-built_in">Math</span>.sqrt(sinang);
    <span class="hljs-keyword">var</span> f = <span class="hljs-number">1.0</span> / sinang;
  
    <span class="hljs-keyword">var</span> angle = <span class="hljs-number">2.0</span> * <span class="hljs-built_in">Math</span>.atan2(sinang, _quat[<span class="hljs-number">0</span>]);
    <span class="hljs-keyword">return</span> {
      axis: <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([_quat[<span class="hljs-number">1</span>] * f, _quat[<span class="hljs-number">2</span>] * f, _quat[<span class="hljs-number">3</span>] * f]),
      angle: angle
    };
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <h2 id="function-shrike-axisangle-frommatrix">Function: shrike.axisAngle.fromMatrix</h2>
<p>Convert a matrix into axis angle representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>m</strong> - the matrix being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted axis angle object (angle is in radians).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.axisAngle.fromMatrix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m)</span> {</span>
    <span class="hljs-keyword">return</span> shrike.axisAngle.fromQuat(shrike.quat.fromMatrix(m));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <h2 id="function-shrike-v3-fromobject">Function: shrike.V3.fromObject</h2>
<p>Converts an object with xyz attributes into a V3.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>o</strong> - the source object.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the result V3.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.V3.fromObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> {</span>
  
    shrike.assert(_.isObject(o), <span class="hljs-string">'not an object'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([o.x, o.y, o.z]);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <h2 id="function-shrike-v3-toobject">Function: shrike.V3.toObject</h2>
<p>Converts a V3 into an object with xyz attributes.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>_v</strong> - the source V3.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the result object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.V3.toObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_v)</span> {</span>
  
    shrike.assert(shrike.isArray(_v), <span class="hljs-string">'not an array'</span>);
    <span class="hljs-keyword">var</span> v = shrike.toFloat(_v);
    <span class="hljs-keyword">return</span> _.object([<span class="hljs-string">'x'</span>, <span class="hljs-string">'y'</span>, <span class="hljs-string">'z'</span>], v);
  };
  
  shrike.V3.zxy = {};
  shrike.V3.zyx = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <h2 id="function-shrike-v3-zxy-frommatrix">Function: shrike.V3.zxy.fromMatrix</h2>
<p>Convert a matrix into zxy angle representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>Traw</strong> - the matrix being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted array of angles (angles are is in degrees).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.V3.zxy.fromMatrix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Traw)</span> {</span>
  
    <span class="hljs-keyword">var</span> T = shrike.matrix4to3(shrike.toFloat(Traw));
  
    <span class="hljs-keyword">var</span> epsilon = <span class="hljs-number">1e-10</span>;
  
    <span class="hljs-keyword">var</span> x, y, z;
    <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">Math</span>.abs(T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]) &lt; epsilon) &amp;&amp; (<span class="hljs-built_in">Math</span>.abs(T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]) &lt; epsilon)) {
      <span class="hljs-keyword">var</span> sinx = T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>];
      <span class="hljs-keyword">if</span> (sinx &gt; <span class="hljs-number">0.0</span>) {
        x = <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2.0</span>;
      }
      <span class="hljs-keyword">else</span> {
        x = -<span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2.0</span>;
      }
      z = <span class="hljs-number">0.0</span>;
      y = <span class="hljs-built_in">Math</span>.atan2(sinx * T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]);
    }
    <span class="hljs-keyword">else</span> {
      y = <span class="hljs-built_in">Math</span>.atan2(-T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>], T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]);
      <span class="hljs-keyword">var</span> siny = <span class="hljs-built_in">Math</span>.sin(y);
      <span class="hljs-keyword">var</span> cosy = <span class="hljs-built_in">Math</span>.cos(y);
      <span class="hljs-keyword">var</span> Ryinv = [
      [cosy, <span class="hljs-number">0.0</span>, -siny],
      [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>],
      [siny, <span class="hljs-number">0.0</span>, cosy]
    ];
      <span class="hljs-keyword">var</span> Rzx = shrike.matrixMult(T, Ryinv);
      x = <span class="hljs-built_in">Math</span>.atan2(Rzx[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>], Rzx[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]);
      z = <span class="hljs-built_in">Math</span>.atan2(Rzx[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], Rzx[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]);
    }
    <span class="hljs-keyword">return</span> shrike.toDegrees([x, y, z]);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <h2 id="function-shrike-v3-zyx-frommatrix">Function: shrike.V3.zyx.fromMatrix</h2>
<p>Convert a matrix into zyx angle representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>Traw</strong> - the matrix being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted array of angles (angles are is in degrees).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.V3.zyx.fromMatrix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Traw)</span> {</span>
    <span class="hljs-keyword">var</span> T = shrike.toFloat(Traw);
    <span class="hljs-keyword">var</span> epsilon = <span class="hljs-number">1e-10</span>;
    <span class="hljs-keyword">var</span> x, y, z;
  
    <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">Math</span>.abs(T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>]) &lt; epsilon) &amp;&amp; (<span class="hljs-built_in">Math</span>.abs(T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]) &lt; epsilon)) {
      <span class="hljs-keyword">if</span> (T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] &lt;= <span class="hljs-number">0.0</span>) {
        y = <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2.0</span>;
      }
      <span class="hljs-keyword">else</span> {
        y = -<span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2.0</span>;
      }
      <span class="hljs-keyword">if</span> (y &gt; <span class="hljs-number">0.0</span>) {
        <span class="hljs-keyword">var</span> xminusz = <span class="hljs-built_in">Math</span>.atan2(T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]);
        x = xminusz;
        z = <span class="hljs-number">0.0</span>;
      }
      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> xplusz = -<span class="hljs-built_in">Math</span>.atan2(T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]);
        x = xplusz;
        z = <span class="hljs-number">0.0</span>;
      }
    }
    <span class="hljs-keyword">else</span> {
      x = <span class="hljs-built_in">Math</span>.atan2(T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>], T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]);
      <span class="hljs-keyword">var</span> sinx = <span class="hljs-built_in">Math</span>.sin(x);
      <span class="hljs-keyword">var</span> cosx = <span class="hljs-built_in">Math</span>.cos(x);
      <span class="hljs-keyword">var</span> Rxinv = [[<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>], [<span class="hljs-number">0.0</span>, cosx, sinx], [<span class="hljs-number">0.0</span>, -sinx, cosx]];
      <span class="hljs-keyword">var</span> Rzy = shrike.matrixMult(shrike.matrix4to3(T), Rxinv);
      y = <span class="hljs-built_in">Math</span>.atan2(-Rzy[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>], Rzy[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]);
      z = <span class="hljs-built_in">Math</span>.atan2(-Rzy[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], Rzy[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]);
    }
  
    <span class="hljs-keyword">return</span> shrike.toDegrees([x, y, z]);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <h2 id="function-shrike-v3-zxy-fromquat">Function: shrike.V3.zxy.fromQuat</h2>
<p>Convert a quaternion into zxy representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>quat</strong> - the quaternion being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted array of angles (angles are is in degrees).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.V3.zxy.fromQuat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(quat)</span> {</span>
    <span class="hljs-keyword">return</span> shrike.V3.zxy.fromMatrix(shrike.matrixFromQuat(shrike.toFloat(quat)));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <h2 id="function-shrike-v3-zyx-fromquat">Function: shrike.V3.zyx.fromQuat</h2>
<p>Convert a quaternion into zxy representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>quat</strong> - the quaternion being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted array of angles (angles are is in degrees).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.V3.zyx.fromQuat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(quat)</span> {</span>
    <span class="hljs-keyword">return</span> shrike.V3.zyx.fromMatrix(shrike.matrixFromQuat(shrike.toFloat(quat)));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <h2 id="function-shrike-m4-fromquat">Function: shrike.M4.fromQuat</h2>
<p>Convert an M4 from quaternion.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>quatRaw</strong> - the quaternion being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted M4.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.M4.fromQuat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(quatRaw)</span> {</span>
  
    shrike.assert(quatRaw.length === <span class="hljs-number">4</span>, <span class="hljs-string">'M4.fromQuat: quatRaw.length !== 4'</span>);
    <span class="hljs-keyword">var</span> quat = shrike.toFloat(quatRaw);
    <span class="hljs-keyword">var</span> r = shrike.M4.clone(shrike.M4.I);
  
    <span class="hljs-keyword">var</span> length2 = shrike.sum(_.map(quat, shrike.square));
    <span class="hljs-keyword">if</span> (length2 &lt;= <span class="hljs-number">1e-8</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>invalid quaternion, so return identity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> r;
    }
    <span class="hljs-keyword">var</span> ilength2 = <span class="hljs-number">2.0</span> / length2;
  
    <span class="hljs-keyword">var</span> qq1 = ilength2 * quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">var</span> qq2 = ilength2 * quat[<span class="hljs-number">2</span>] * quat[<span class="hljs-number">2</span>];
    <span class="hljs-keyword">var</span> qq3 = ilength2 * quat[<span class="hljs-number">3</span>] * quat[<span class="hljs-number">3</span>];
  
    r[<span class="hljs-number">0</span>] = <span class="hljs-number">1.0</span> - qq2 - qq3;
    r[<span class="hljs-number">1</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">2</span>] + quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">3</span>]);
    r[<span class="hljs-number">2</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">3</span>] - quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">2</span>]);
  
    r[<span class="hljs-number">4</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">2</span>] - quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">3</span>]);
    r[<span class="hljs-number">5</span>] = <span class="hljs-number">1.0</span> - qq1 - qq3;
    r[<span class="hljs-number">6</span>] = ilength2 * (quat[<span class="hljs-number">2</span>] * quat[<span class="hljs-number">3</span>] + quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">1</span>]);
  
    r[<span class="hljs-number">8</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">3</span>] + quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">2</span>]);
    r[<span class="hljs-number">9</span>] = ilength2 * (quat[<span class="hljs-number">2</span>] * quat[<span class="hljs-number">3</span>] - quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">1</span>]);
    r[<span class="hljs-number">10</span>] = <span class="hljs-number">1.0</span> - qq1 - qq2;
  
    <span class="hljs-keyword">return</span> r;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <h2 id="function-shrike-m4-transfrommatrix">Function: shrike.M4.transFromMatrix</h2>
<p>Get a translation vector out of an M4.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>m</strong> - the source M4.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the result translation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.M4.transFromMatrix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m)</span> {</span>
    <span class="hljs-keyword">var</span> r = <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE(<span class="hljs-number">3</span>);
    r[<span class="hljs-number">0</span>] = m[<span class="hljs-number">12</span>];
    r[<span class="hljs-number">1</span>] = m[<span class="hljs-number">13</span>];
    r[<span class="hljs-number">2</span>] = m[<span class="hljs-number">14</span>];
    <span class="hljs-keyword">return</span> r;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <h2 id="function-shrike-m4-composefromquattrans">Function: shrike.M4.composeFromQuatTrans</h2>
<p>Composes an M4 from a quaternion and translation V3</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>quatRaw</strong> - the source quaternion.</li>
<li><strong>transRaw</strong> - the source translation.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the result M4.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.M4.composeFromQuatTrans = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(quatRaw, transRaw)</span> {</span>
    <span class="hljs-keyword">var</span> r = shrike.M4.fromQuat(quatRaw);
  
    <span class="hljs-keyword">var</span> trans = shrike.toFloat(transRaw);
  
    shrike.assert(trans.length === <span class="hljs-number">3</span>, <span class="hljs-string">'M4.composeFromQuatTrans: trans.length !== 3'</span>);
    r[<span class="hljs-number">12</span>] = trans[<span class="hljs-number">0</span>];
    r[<span class="hljs-number">13</span>] = trans[<span class="hljs-number">1</span>];
    r[<span class="hljs-number">14</span>] = trans[<span class="hljs-number">2</span>];
  
    <span class="hljs-keyword">return</span> r;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <h2 id="function-shrike-m4-totransformarray">Function: shrike.M4.toTransformArray</h2>
<p>Converts an M4 into a 2d transform array.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>m</strong> - the source M4.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the result transform array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.M4.toTransformArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m)</span> {</span>
    <span class="hljs-keyword">return</span> [
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([m[<span class="hljs-number">0</span>], m[<span class="hljs-number">4</span>], m[<span class="hljs-number">8</span>], m[<span class="hljs-number">12</span>]]),
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([m[<span class="hljs-number">1</span>], m[<span class="hljs-number">5</span>], m[<span class="hljs-number">9</span>], m[<span class="hljs-number">13</span>]]),
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([m[<span class="hljs-number">2</span>], m[<span class="hljs-number">6</span>], m[<span class="hljs-number">10</span>], m[<span class="hljs-number">14</span>]]),
      <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([m[<span class="hljs-number">3</span>], m[<span class="hljs-number">7</span>], m[<span class="hljs-number">11</span>], m[<span class="hljs-number">15</span>]])
      ];
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <h2 id="function-shrike-m4-fromtransformarray">Function: shrike.M4.fromTransformArray</h2>
<p>Converts a 2d transform array into an M4.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>m</strong> - the source transform array.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the result M4.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.M4.fromTransformArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE([m[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], m[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], m[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>], m[<span class="hljs-number">3</span>][<span class="hljs-number">0</span>], m[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], m[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>], m[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>], m[<span class="hljs-number">3</span>][<span class="hljs-number">1</span>], m[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>], m[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>], m[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>], m[<span class="hljs-number">3</span>][<span class="hljs-number">2</span>], m[<span class="hljs-number">0</span>][<span class="hljs-number">3</span>], m[<span class="hljs-number">1</span>][<span class="hljs-number">3</span>], m[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>], m[<span class="hljs-number">3</span>][<span class="hljs-number">3</span>]]);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <h2 id="function-shrike-m4-inverse">Function: shrike.M4.inverse</h2>
<p>Computes the inverse of an M4.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>m</strong> - the source.</li>
<li><strong>r</strong> - the optional place to store the result.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the result M4.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.M4.inverse = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m, r)</span> {</span>
    <span class="hljs-keyword">if</span> (r == <span class="hljs-literal">undefined</span>) {
      r = <span class="hljs-keyword">new</span> FLOAT_ARRAY_TYPE(<span class="hljs-number">16</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>cache the matrix values (makes for huge speed increases!)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> a00 = m[<span class="hljs-number">0</span>],
      a10 = m[<span class="hljs-number">1</span>],
      a20 = m[<span class="hljs-number">2</span>],
      a30 = m[<span class="hljs-number">3</span>];
    <span class="hljs-keyword">var</span> a01 = m[<span class="hljs-number">4</span>],
      a11 = m[<span class="hljs-number">5</span>],
      a21 = m[<span class="hljs-number">6</span>],
      a31 = m[<span class="hljs-number">7</span>];
    <span class="hljs-keyword">var</span> a02 = m[<span class="hljs-number">8</span>],
      a12 = m[<span class="hljs-number">9</span>],
      a22 = m[<span class="hljs-number">10</span>],
      a32 = m[<span class="hljs-number">11</span>];
    <span class="hljs-keyword">var</span> a03 = m[<span class="hljs-number">12</span>],
      a13 = m[<span class="hljs-number">13</span>],
      a23 = m[<span class="hljs-number">14</span>],
      a33 = m[<span class="hljs-number">15</span>];
  
    <span class="hljs-keyword">var</span> b00 = a00 * a11 - a01 * a10;
    <span class="hljs-keyword">var</span> b01 = a00 * a12 - a02 * a10;
    <span class="hljs-keyword">var</span> b02 = a00 * a13 - a03 * a10;
    <span class="hljs-keyword">var</span> b03 = a01 * a12 - a02 * a11;
    <span class="hljs-keyword">var</span> b04 = a01 * a13 - a03 * a11;
    <span class="hljs-keyword">var</span> b05 = a02 * a13 - a03 * a12;
    <span class="hljs-keyword">var</span> b06 = a20 * a31 - a21 * a30;
    <span class="hljs-keyword">var</span> b07 = a20 * a32 - a22 * a30;
    <span class="hljs-keyword">var</span> b08 = a20 * a33 - a23 * a30;
    <span class="hljs-keyword">var</span> b09 = a21 * a32 - a22 * a31;
    <span class="hljs-keyword">var</span> b10 = a21 * a33 - a23 * a31;
    <span class="hljs-keyword">var</span> b11 = a22 * a33 - a23 * a32;</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>calculate the determinant (inlined to avoid double-caching)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> invDet = <span class="hljs-number">1</span> / (b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06);
  
    r[<span class="hljs-number">0</span>] = (a11 * b11 - a12 * b10 + a13 * b09) * invDet;
    r[<span class="hljs-number">4</span>] = (-a01 * b11 + a02 * b10 - a03 * b09) * invDet;
    r[<span class="hljs-number">8</span>] = (a31 * b05 - a32 * b04 + a33 * b03) * invDet;
    r[<span class="hljs-number">12</span>] = (-a21 * b05 + a22 * b04 - a23 * b03) * invDet;
    r[<span class="hljs-number">1</span>] = (-a10 * b11 + a12 * b08 - a13 * b07) * invDet;
    r[<span class="hljs-number">5</span>] = (a00 * b11 - a02 * b08 + a03 * b07) * invDet;
    r[<span class="hljs-number">9</span>] = (-a30 * b05 + a32 * b02 - a33 * b01) * invDet;
    r[<span class="hljs-number">13</span>] = (a20 * b05 - a22 * b02 + a23 * b01) * invDet;
    r[<span class="hljs-number">2</span>] = (a10 * b10 - a11 * b08 + a13 * b06) * invDet;
    r[<span class="hljs-number">6</span>] = (-a00 * b10 + a01 * b08 - a03 * b06) * invDet;
    r[<span class="hljs-number">10</span>] = (a30 * b04 - a31 * b02 + a33 * b00) * invDet;
    r[<span class="hljs-number">14</span>] = (-a20 * b04 + a21 * b02 - a23 * b00) * invDet;
    r[<span class="hljs-number">3</span>] = (-a10 * b09 + a11 * b07 - a12 * b06) * invDet;
    r[<span class="hljs-number">7</span>] = (a00 * b09 - a01 * b07 + a02 * b06) * invDet;
    r[<span class="hljs-number">11</span>] = (-a30 * b03 + a31 * b01 - a32 * b00) * invDet;
    r[<span class="hljs-number">15</span>] = (a20 * b03 - a21 * b01 + a22 * b00) * invDet;
  
    <span class="hljs-keyword">return</span> r;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <h2 id="function-shrike-linearlyinterpolate">Function: shrike.linearlyInterpolate</h2>
<p>Linearly interpolate between t0, x0 and t1, x1 at time t.
Requires t0, t1 to be distinct</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>t0</strong> - time 0.</li>
<li><strong>x0</strong> - position 0.</li>
<li><strong>t1</strong> - time 1.</li>
<li><strong>x1</strong> - position 1.</li>
<li><strong>t</strong> - time.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the result object.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.linearlyInterpolate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(t0, x0, t1, x1, t)</span> {</span>
    <span class="hljs-keyword">return</span> (x0 * (t1 - t) + x1 * (t - t0)) / (t1 - t0);
  };
  
  shrike.geom = {};
  
  shrike.geom.canvasToViewport = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(canvasX, canvasY, canvasWidth, canvasHeight, viewportAspectRatio)</span> {</span>
    <span class="hljs-keyword">var</span> viewportX = ((canvasX / canvasWidth) - <span class="hljs-number">0.5</span>) * viewportAspectRatio;
    <span class="hljs-keyword">var</span> viewportY = <span class="hljs-number">0.5</span> - (canvasY / canvasHeight);
    <span class="hljs-keyword">return</span> [viewportX, viewportY];
  };
  
  shrike.geom.getProjectionScale = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(depth, fovDegrees)</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-number">2.0</span> * depth * math.tan(<span class="hljs-number">0.5</span> * math.toRadians(fovDegrees));
  };
  
  shrike.geom.viewportToWorldVec = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(viewportX, viewportY, right, up, look, fovy)</span> {</span>
    <span class="hljs-keyword">var</span> scale = shrike.geom.getProjectionScale(<span class="hljs-number">1.0</span>, fovy);
    <span class="hljs-keyword">return</span> shrike.V3.add(shrike.V3.scale(right, viewportX * scale), shrike.V3.add(shrike.V3.scale(up, viewportY * scale), look));
  };
  
  <span class="hljs-comment">/*
   * given two lines, p + v*t, and q + w*s (parameterized by t and s respectively),
   * find the respective points on the lines, the distance between which is minimized.
   * return [t_min, s_min], where p + v*t_min and q + w*s_min are these two points.
   *
   * note that these formulas came out of mathematica, and are therefore pretty opaque.
   *
   * FIXME: this can be simplified if v and w are assumed to be unit vectors
   * FIXME: add mathematica code
   */</span>
  shrike.geom.findShortestDistanceBetweenLines = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(p, v, q, w)</span> {</span>
    <span class="hljs-keyword">var</span> c = shrike.V3.sub(p, q);
  
    <span class="hljs-keyword">var</span> vDotW = shrike.V3.dot(v, w);
  
    <span class="hljs-keyword">var</span> tNumerator = <span class="hljs-number">4.0</span> * (shrike.V3.dot(c, v) * shrike.V3.dot(w, w) - shrike.V3.dot(c, w) * shrike.V3.dot(v, w));
    <span class="hljs-keyword">var</span> tDenominator = <span class="hljs-number">4.0</span> * (vDotW * vDotW - shrike.V3.dot(v, v) * shrike.V3.dot(w, w));
  
    <span class="hljs-keyword">var</span> sNumerator = c[<span class="hljs-number">2</span>] * (-v[<span class="hljs-number">0</span>] * v[<span class="hljs-number">2</span>] * w[<span class="hljs-number">0</span>] - v[<span class="hljs-number">1</span>] * v[<span class="hljs-number">2</span>] * w[<span class="hljs-number">1</span>] + v[<span class="hljs-number">0</span>] * v[<span class="hljs-number">0</span>] * w[<span class="hljs-number">2</span>] + v[<span class="hljs-number">1</span>] * v[<span class="hljs-number">1</span>] * w[<span class="hljs-number">2</span>]) + c[<span class="hljs-number">0</span>] * (v[<span class="hljs-number">1</span>] * v[<span class="hljs-number">1</span>] * w[<span class="hljs-number">0</span>] + v[<span class="hljs-number">2</span>] * v[<span class="hljs-number">2</span>] * w[<span class="hljs-number">0</span>] - v[<span class="hljs-number">0</span>] * v[<span class="hljs-number">1</span>] * w[<span class="hljs-number">1</span>] - v[<span class="hljs-number">0</span>] * v[<span class="hljs-number">2</span>] * w[<span class="hljs-number">2</span>]) + c[<span class="hljs-number">1</span>] * (-v[<span class="hljs-number">0</span>] * v[<span class="hljs-number">1</span>] * w[<span class="hljs-number">0</span>] + v[<span class="hljs-number">0</span>] * v[<span class="hljs-number">0</span>] * w[<span class="hljs-number">1</span>] + v[<span class="hljs-number">2</span>] * (v[<span class="hljs-number">2</span>] * w[<span class="hljs-number">1</span>] - v[<span class="hljs-number">1</span>] * w[<span class="hljs-number">2</span>]));
  
    <span class="hljs-keyword">var</span> sDenominator = v[<span class="hljs-number">2</span>] * v[<span class="hljs-number">2</span>] * (w[<span class="hljs-number">0</span>] * w[<span class="hljs-number">0</span>] + w[<span class="hljs-number">1</span>] * w[<span class="hljs-number">1</span>]) - <span class="hljs-number">2.0</span> * v[<span class="hljs-number">0</span>] * v[<span class="hljs-number">2</span>] * w[<span class="hljs-number">0</span>] * w[<span class="hljs-number">2</span>] - <span class="hljs-number">2.0</span> * v[<span class="hljs-number">1</span>] * w[<span class="hljs-number">1</span>] * (v[<span class="hljs-number">0</span>] * w[<span class="hljs-number">0</span>] + v[<span class="hljs-number">2</span>] * w[<span class="hljs-number">2</span>]) + v[<span class="hljs-number">1</span>] * v[<span class="hljs-number">1</span>] * (w[<span class="hljs-number">0</span>] * w[<span class="hljs-number">0</span>] + w[<span class="hljs-number">2</span>] * w[<span class="hljs-number">2</span>]) + v[<span class="hljs-number">0</span>] * v[<span class="hljs-number">0</span>] * (w[<span class="hljs-number">1</span>] * w[<span class="hljs-number">1</span>] + w[<span class="hljs-number">2</span>] * w[<span class="hljs-number">2</span>]);</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <p>FIXME: this should be good enough, but i’m not sure yet what the best behavior here is</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">Math</span>.abs(tDenominator) &lt; <span class="hljs-number">1e-10</span> || <span class="hljs-built_in">Math</span>.abs(sDenominator) &lt; <span class="hljs-number">1e-10</span>) {
      <span class="hljs-keyword">return</span> {
        t: <span class="hljs-number">0.0</span>,
        s: <span class="hljs-number">0.0</span>
      };
    }
  
    <span class="hljs-keyword">return</span> {
      t: tNumerator / tDenominator,
      s: sNumerator / sDenominator
    };
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>is there a better way to do this? maybe. but this works.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.geom.findPerpVector = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(v)</span> {</span>
    <span class="hljs-keyword">var</span> vn = shrike.V3.normalize(v);
    <span class="hljs-keyword">var</span> dotProds = [shrike.V3.dot(vn, shrike.V3.$(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>)),
                    shrike.V3.dot(vn, shrike.V3.$(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>)),
                    shrike.V3.dot(vn, shrike.V3.$(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>))];
    <span class="hljs-keyword">var</span> index = dotProds.indexOf(<span class="hljs-built_in">Math</span>.min.apply(<span class="hljs-literal">undefined</span>, dotProds));
    <span class="hljs-keyword">var</span> crossUnitVec;
  
    crossUnitVec = shrike.V3.$(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    crossUnitVec[index] = <span class="hljs-number">1.0</span>;
  
    <span class="hljs-keyword">return</span> shrike.V3.normalize(shrike.V3.cross(vn, crossUnitVec));
  };
  
  shrike.geom.getCameraZoom = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params)</span> {</span>
    <span class="hljs-keyword">var</span> wheelDelta = params.wheelDelta;
    <span class="hljs-keyword">var</span> eye = params.eye;
    <span class="hljs-keyword">var</span> lookAtPoint = params.lookAtPoint;
    <span class="hljs-keyword">var</span> zoomScale = params.zoomScale;
  
    <span class="hljs-keyword">var</span> forward = shrike.V3.sub(lookAtPoint, eye);
    <span class="hljs-keyword">var</span> zoomedForward = shrike.V3.scale(forward, (wheelDelta &gt; <span class="hljs-number">0</span>) ? <span class="hljs-built_in">Math</span>.pow(zoomScale, wheelDelta) : <span class="hljs-built_in">Math</span>.pow(<span class="hljs-number">1</span> / zoomScale, -wheelDelta));
    <span class="hljs-keyword">var</span> zoomedEye = shrike.V3.sub(lookAtPoint, zoomedForward);
  
    <span class="hljs-keyword">return</span> zoomedEye;
  };
  
  shrike.geom.getRotationBetweenNormalizedVectors = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(u, v)</span> {</span>
    <span class="hljs-keyword">var</span> crossProd = shrike.V3.cross(u, v);
    <span class="hljs-keyword">var</span> absSinAngle = shrike.V3.length(crossProd);
    <span class="hljs-keyword">var</span> cosAngle = shrike.V3.dot(u, v);
    <span class="hljs-keyword">var</span> angle;
  
    <span class="hljs-keyword">if</span> (absSinAngle &lt; <span class="hljs-number">1e-16</span>) {
      <span class="hljs-keyword">return</span> {
        axis: shrike.V3.$(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>),
        angle: <span class="hljs-number">0.0</span>
      };
    }
  
    <span class="hljs-keyword">if</span> (cosAngle &gt;= <span class="hljs-number">0.0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Angle is in [-PI/2, +PI/2]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      angle = <span class="hljs-built_in">Math</span>.asin(absSinAngle);
    }
    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>Angle is in [-PI, -PI/2) or (+PI/2, +PI]</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      angle = <span class="hljs-built_in">Math</span>.PI - <span class="hljs-built_in">Math</span>.asin(absSinAngle);
    }
  
    <span class="hljs-keyword">return</span> {
      axis: shrike.V3.normalize(crossProd),
      angle: angle
    };
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>quick background: there are cases when, given a perspective camera and a depth
                  (z value), and given an (x,y) point on the screen, we want
                  to find the world-space point at that depth to which (x,y)
                  maps. in other words we need to do the inverse perspective
                  transform. that inverse perspective transform maps z in [-1,+1]
                  to z in [-nearDepth, -farDepth]. so we need that z in [-1,+1]
                  to apply the inverse perspective transform matrix.</p>
<p>so what this does: given the true world-space depth, i.e. z in [-nearDepth, -farDepth],
                   return the projected z value, i.e. z in [-1, +1], to which the
                   perspective transform maps it.</p>
<p>and so, FIXME:
yes, this is a little silly/wasteful. we map z -&gt; z’ so that we can then
map [x’, y’, z’] back to [x, y, z] with P^-1. an optimized method
would just do the partial inverse application.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.geom.getPerspectiveDepthForSceneDepth = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sceneDepth, nearDepth, farDepth)</span> {</span>
    <span class="hljs-keyword">return</span> ((farDepth + nearDepth) / (farDepth - nearDepth)) + ((<span class="hljs-number">2</span> * farDepth * nearDepth) / ((farDepth - nearDepth) * sceneDepth));
  };
  
  shrike.geom.getPointOnPlane = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(canvasX, canvasY, canvasWidth, canvasHeight, viewVecs, fovX, fovY, planeNormal, planeBias)</span> {</span>
    <span class="hljs-keyword">var</span> viewportPos = shrike.geom.canvasToViewport(canvasX, canvasY, canvasWidth, canvasHeight, <span class="hljs-number">1.0</span>); <span class="hljs-comment">// FIXME: use correct aspect (may not be 1.0)</span>
    <span class="hljs-keyword">var</span> worldVec = shrike.geom.viewportToWorldVec(viewportPos[<span class="hljs-number">0</span>], viewportPos[<span class="hljs-number">1</span>], viewVecs.right, viewVecs.up, viewVecs.look, fovX, fovY);
  
    <span class="hljs-keyword">var</span> t = (-planeBias - shrike.V3.dot(viewVecs.eye, planeNormal)) / shrike.V3.dot(worldVec, planeNormal);
    <span class="hljs-keyword">var</span> p = shrike.V3.add(shrike.V3.scale(worldVec, t), viewVecs.eye);
  
    <span class="hljs-keyword">return</span> p;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>params.x in [-1, +1]
params.y in [-1, +1]
params.fovY in degrees</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.geom.projectScreenPointToWorldPointAtDepth = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params)</span> {</span>
    <span class="hljs-keyword">var</span> x = params.x;
    <span class="hljs-keyword">var</span> y = params.y;
    <span class="hljs-keyword">var</span> z = params.z;
    <span class="hljs-keyword">var</span> fovY = params.fovY;
    <span class="hljs-keyword">var</span> aspect = params.aspect;
    <span class="hljs-keyword">var</span> zNear = params.zNear;
    <span class="hljs-keyword">var</span> zFar = params.zFar;
  
    <span class="hljs-keyword">var</span> zProj = shrike.geom.getPerspectiveDepthForSceneDepth(z, zNear, zFar);
    <span class="hljs-keyword">var</span> projMat = shrike.M4.makePerspective(fovY, aspect, zNear, zFar);
    <span class="hljs-keyword">var</span> invProjMat = shrike.M4.inverse(projMat);
  
    <span class="hljs-keyword">return</span> shrike.V3.mul4x4(invProjMat, shrike.V3.$(x, y, zProj));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>assumes that the two cameras are the same</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.geom.projectWorldPointToWorldPointAtDepth = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params)</span> {</span>
    <span class="hljs-keyword">var</span> x = params.x;
    <span class="hljs-keyword">var</span> y = params.y;
    <span class="hljs-keyword">var</span> z = params.z;
    <span class="hljs-keyword">var</span> newDepth = params.newDepth;
    <span class="hljs-keyword">var</span> fovY = params.fovY;
    <span class="hljs-keyword">var</span> aspect = params.aspect;
    <span class="hljs-keyword">var</span> zNear = params.zNear;
    <span class="hljs-keyword">var</span> zFar = params.zFar;
    <span class="hljs-keyword">var</span> eye = params.eye;
    <span class="hljs-keyword">var</span> lookAtPoint = params.lookAtPoint;
    <span class="hljs-keyword">var</span> up = params.up;
  
    <span class="hljs-keyword">var</span> projMat = shrike.M4.makePerspective(fovY, aspect, zNear, zFar);
    <span class="hljs-keyword">var</span> invProjMat = shrike.M4.inverse(projMat);
    <span class="hljs-keyword">var</span> lookAtMat = shrike.M4.makeLookAt(eye, lookAtPoint, up);
    <span class="hljs-keyword">var</span> invLookAtMat = shrike.M4.inverse(lookAtMat);
  
    <span class="hljs-keyword">var</span> projPoint = shrike.V3.mul4x4(projMat, shrike.V3.mul4x4(lookAtMat, shrike.V3.$(x, y, z)));
  
    projPoint[<span class="hljs-number">2</span>] = shrike.geom.getPerspectiveDepthForSceneDepth(newDepth, zNear, zFar);
  
    <span class="hljs-keyword">return</span> shrike.V3.mul4x4(invLookAtMat, shrike.V3.mul4x4(invProjMat, projPoint));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>FIXME: get rid of fovX</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.geom.viewportToWorldVec = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(viewportX, viewportY, right, up, look, fovX, fovY)</span> {</span>
    <span class="hljs-keyword">var</span> scaleX = shrike.geom.getProjectionScale(<span class="hljs-number">1.0</span>, fovX);
    <span class="hljs-keyword">var</span> scaleY = shrike.geom.getProjectionScale(<span class="hljs-number">1.0</span>, fovY);
  
    <span class="hljs-keyword">return</span> shrike.V3.add(shrike.V3.scale(right, viewportX * scaleX), shrike.V3.add(shrike.V3.scale(up, viewportY * scaleY), look));
  };
  
  shrike.geom.getCameraOrbitRotation = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params)</span> {</span>
    <span class="hljs-keyword">var</span> horizRot = params.horizRot;
    <span class="hljs-keyword">var</span> vertRot = params.vertRot;
    <span class="hljs-keyword">var</span> up = params.up;
    <span class="hljs-keyword">var</span> eye = params.eye;
    <span class="hljs-keyword">var</span> lookAtPoint = params.lookAtPoint;
    <span class="hljs-keyword">var</span> rotationCenter = params.rotationCenter;
    <span class="hljs-keyword">var</span> dragConstant = params.dragConstant;
  
    <span class="hljs-keyword">if</span> (horizRot == <span class="hljs-number">0</span> &amp;&amp; vertRot == <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> {
        eye: eye,
        lookAtPoint: lookAtPoint,
        up: up
      };
    }
  
    <span class="hljs-keyword">var</span> forward = shrike.V3.sub(lookAtPoint, eye);
    <span class="hljs-keyword">var</span> right = shrike.V3.normalize(shrike.V3.cross(forward, up));
    <span class="hljs-keyword">var</span> fixedUp = shrike.V3.normalize(shrike.V3.cross(right, forward));
  
    <span class="hljs-keyword">var</span> rotVec = shrike.V3.add(shrike.V3.scale(fixedUp, -horizRot), shrike.V3.scale(right, -vertRot));
    <span class="hljs-keyword">var</span> rotMat = shrike.M4.makeRotate(shrike.V3.length(rotVec) * dragConstant, rotVec);
  
    <span class="hljs-keyword">var</span> eyeFromCenter = shrike.V3.sub(eye, rotationCenter);
    <span class="hljs-keyword">var</span> lookFromCenter = shrike.V3.sub(lookAtPoint, rotationCenter);
  
    <span class="hljs-keyword">var</span> newEyeFromCenter = shrike.V3.mul4x4(rotMat, eyeFromCenter);
    <span class="hljs-keyword">var</span> newLookFromCenter = shrike.V3.mul4x4(rotMat, lookFromCenter);
  
    <span class="hljs-keyword">return</span> {
      eye: shrike.V3.add(newEyeFromCenter, rotationCenter),
      lookAtPoint: shrike.V3.add(newLookFromCenter, rotationCenter),
      up: shrike.V3.mul4x4(rotMat, fixedUp)
    };
  };
  
  shrike.geom.getCameraStrafe = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(params)</span> {</span>
    <span class="hljs-keyword">var</span> horizTrans = params.horizTrans;
    <span class="hljs-keyword">var</span> vertTrans = params.vertTrans;
    <span class="hljs-keyword">var</span> up = params.up;
    <span class="hljs-keyword">var</span> eye = params.eye;
    <span class="hljs-keyword">var</span> lookAtPoint = params.lookAtPoint;
    <span class="hljs-keyword">var</span> dragConstant = params.dragConstant;
  
    <span class="hljs-keyword">var</span> forward = shrike.V3.sub(lookAtPoint, eye);
    <span class="hljs-keyword">var</span> right = shrike.V3.normalize(shrike.V3.cross(forward, up));
    <span class="hljs-keyword">var</span> fixedUp = shrike.V3.normalize(shrike.V3.cross(right, forward));
  
    <span class="hljs-keyword">var</span> trans = shrike.V3.add(shrike.V3.scale(fixedUp, vertTrans * dragConstant), shrike.V3.scale(right, -horizTrans * dragConstant));
  
    <span class="hljs-keyword">return</span> {
      eye: shrike.V3.add(eye, trans),
      lookAtPoint: shrike.V3.add(lookAtPoint, trans)
    };
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>for debugging / console convenience</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (window.makeGlobal !== <span class="hljs-literal">undefined</span>) {
    window.makeGlobal(shrike);
    window.makeGlobal({
      math: shrike,
      shrike: shrike
    });
  }

  <span class="hljs-keyword">return</span> shrike;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
