<!DOCTYPE html>

<html>
<head>
  <title>shrike.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>shrike.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p>shrike - v0.0.1</p>
<p><a href="https://github.com/Stonelinks/shrike">https://github.com/Stonelinks/shrike</a></p>
<p>yet another javascript math library</p>
<p>Copyright (c)2014 - Lucas Doyle <a href="&#109;&#x61;&#x69;&#x6c;&#116;&#111;&#x3a;&#x6c;&#117;&#99;&#x61;&#115;&#x2e;&#x70;&#46;&#x64;&#111;&#x79;&#x6c;&#x65;&#64;&#103;&#x6d;&#97;&#105;&#108;&#x2e;&#x63;&#x6f;&#x6d;">&#x6c;&#117;&#99;&#x61;&#115;&#x2e;&#x70;&#46;&#x64;&#111;&#x79;&#x6c;&#x65;&#64;&#103;&#x6d;&#97;&#105;&#108;&#x2e;&#x63;&#x6f;&#x6d;</a></p>
<p>Distributed under MIT license</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>

define([<span class="hljs-string">'underscore'</span>, <span class="hljs-string">'mjs'</span>], <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_, mjs)</span> {</span>
<span class="hljs-pi">  'use strict'</span>;

  <span class="hljs-keyword">var</span> shrike = {};</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <h2 id="constant-shrike_float_array_type">Constant: SHRIKE_FLOAT_ARRAY_TYPE</h2>
<p>The base float array type, borrowed it from mjs.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  <span class="hljs-keyword">var</span> SHRIKE_FLOAT_ARRAY_TYPE = mjs.FLOAT_ARRAY_TYPE;
  
  shrike.throwError = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(msg)</span> {</span>
    msg = msg || <span class="hljs-string">'undefined error'</span>;
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">'SHRIKE: '</span> + msg);
  };
  
  shrike.assert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(cond, msg)</span> {</span>
    <span class="hljs-keyword">if</span> (!cond) {
      shrike.throwError(msg);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="function-shrike-isarray">Function: shrike.isArray</h2>
<p>A safer version of _.isArray that works with float32 array types.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>a</strong> - the array / object / whatever operand.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>true or false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.isArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
    <span class="hljs-keyword">if</span> (_.isArray(a)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
  
    <span class="hljs-keyword">return</span> shrike.isFloatArray(a);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="function-shrike-isfloatarray">Function: shrike.isFloatArray</h2>
<p>Detects if something is a float array.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>a</strong> - the array / object / whatever operand.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>true or false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.isFloatArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">return</span> (_.isArray(a) !== <span class="hljs-literal">true</span>) &amp;&amp; <span class="hljs-built_in">Object</span>.prototype.toString.call(a).slice(-<span class="hljs-string">'Array]'</span>.length) == <span class="hljs-string">'Array]'</span>;
    }
    <span class="hljs-keyword">catch</span> (e) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <h2 id="function-shrike-is2darray">Function: shrike.is2DArray</h2>
<p>Detects if something is a 2d array.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>a</strong> - the array / object / whatever operand.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>true or false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.is2DArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
    <span class="hljs-keyword">if</span> (!shrike.isArray(a)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  
    <span class="hljs-keyword">if</span> (shrike.isFloatArray(a)) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  
    <span class="hljs-keyword">if</span> (a.length === <span class="hljs-number">0</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  
    <span class="hljs-keyword">return</span> _.every(_.map(a, shrike.isArray));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <h2 id="function-shrike-isnumber">Function: shrike.isNumber</h2>
<p>Detects if something is a number or numeric type, or can be converted into one.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>a</strong> - the operand.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>true or false</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.isNumber = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
    <span class="hljs-keyword">return</span> !<span class="hljs-built_in">isNaN</span>(<span class="hljs-built_in">parseFloat</span>(a)) &amp;&amp; <span class="hljs-built_in">isFinite</span>(a) &amp;&amp; !shrike.isArray(a);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <h2 id="function-shrike-prettyprint">Function: shrike.prettyPrint</h2>
<p>Pretty printing a matrix. TODO: maybe delete this? it is old and never really used.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>x</strong> - whatever it is youâ€™re trying to print.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>nothing</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.prettyPrint = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span> {</span>
  
    console.log(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      <span class="hljs-keyword">if</span> (shrike.isArray(x)) {
  
        <span class="hljs-keyword">if</span> (!shrike.is2DArray(x)) {
          <span class="hljs-keyword">var</span> ret = <span class="hljs-string">'[ '</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(x).join(<span class="hljs-string">', '</span>) + <span class="hljs-string">' ]'</span>;
          <span class="hljs-keyword">return</span> ret;
        }
        <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>find out what the widest number will be</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">var</span> precision = <span class="hljs-number">6</span>;
          <span class="hljs-keyword">var</span> widest = <span class="hljs-number">0</span>;
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; x.length; i++) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; x[i].length; j++) {
  
              shrike.assert(!_.isString(x[i][j]), <span class="hljs-string">'prettyPrint: there is a string in this matrix, you should fix that'</span>);
              <span class="hljs-keyword">if</span> (shrike.round(x[i][j], precision).toString().length &gt; widest) {
                widest = shrike.round(x[i][j], precision).toString().length;
              }
            }
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>add spacing and create borders</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">var</span> formatted = [];
          <span class="hljs-keyword">var</span> border = <span class="hljs-literal">undefined</span>;
  
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; x.length; i++) {
            <span class="hljs-keyword">var</span> row = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; x[i].length; j++) {
              <span class="hljs-keyword">var</span> raw = shrike.round(x[i][j], precision).toString();
              <span class="hljs-keyword">var</span> extra_space = widest - raw.length;
              <span class="hljs-keyword">var</span> left = <span class="hljs-string">''</span>;
              <span class="hljs-keyword">var</span> right = <span class="hljs-string">''</span>;
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; extra_space; k++) {
                <span class="hljs-keyword">if</span> (k &gt;= extra_space / <span class="hljs-number">2.0</span>) {
                  left += <span class="hljs-string">' '</span>;
                }
                <span class="hljs-keyword">else</span> {
                  right += <span class="hljs-string">' '</span>;
                }
              }
              row.push(left + raw + right);
            }
            formatted.push(row);
  
            <span class="hljs-keyword">if</span> (border === <span class="hljs-literal">undefined</span>) {
              <span class="hljs-keyword">var</span> spacers = [];
              <span class="hljs-keyword">var</span> spacer = <span class="hljs-string">''</span>;
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; widest; k++) {
                spacer += <span class="hljs-string">'-'</span>;
              }
              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; row.length; k++) {
                spacers.push(spacer);
              }
              border = <span class="hljs-string">'+-'</span> + spacers.join(<span class="hljs-string">'-+-'</span>) + <span class="hljs-string">'-+'</span>;
            }
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>actually print everything</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">var</span> ret = border + <span class="hljs-string">'\n'</span>;
          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; x.length; i++) {
            <span class="hljs-keyword">var</span> row = formatted[i];
            <span class="hljs-keyword">var</span> line = <span class="hljs-string">'| '</span> + row.join(<span class="hljs-string">' | '</span>) + <span class="hljs-string">' |'</span>;
            ret += line + <span class="hljs-string">'\n'</span>;
            ret += border + <span class="hljs-string">'\n'</span>;
          }
          <span class="hljs-keyword">return</span> ret;
        }
      }
      <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>not an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> x;
      }
    }());
  };
  window.pp = shrike.prettyPrint;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <h2 id="function-shrike-scalariterator">Function: shrike.scalarIterator</h2>
<p>Iterates through an array and applies a function to every element.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>A</strong> - 1d or 2d array.</li>
<li><strong>_function</strong> - function to be called with each element supplied as its single argument.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>The modified array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.scalarIterator = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(A, _function)</span> {</span>
    _function = _function || pass;
    <span class="hljs-keyword">if</span> (shrike.is2DArray(A)) {
      <span class="hljs-keyword">return</span> _.map(A, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(element)</span> {</span>
        <span class="hljs-keyword">return</span> _.map(element, _function);
      });
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (shrike.isArray(A)) {
      <span class="hljs-keyword">if</span> (shrike.isFloatArray(A)) {
        <span class="hljs-keyword">var</span> ret = <span class="hljs-keyword">new</span> shrike.FLOAT_ARRAY_TYPE(A.length);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; A.length; i++) {
          ret[i] = _function(A[i]);
        }
        <span class="hljs-keyword">return</span> ret;
      }
      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> _.map(A, _function);
      }
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> _function(A);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Borrow all of window.Mathâ€™s functions and constantsâ€¦ except round since shrike provides its own round function.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _.without(<span class="hljs-built_in">Object</span>.getOwnPropertyNames(<span class="hljs-built_in">Math</span>), <span class="hljs-string">'round'</span>).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(prop)</span> {</span>
    shrike[prop] = <span class="hljs-built_in">Math</span>[prop];
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Borrow mjs too.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-built_in">Object</span>.getOwnPropertyNames(mjs).forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(prop)</span> {</span>
    shrike[prop] = mjs[prop];
  });</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Alias M4x4 to M4 for convenience.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.M4 = shrike.M4x4;</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2 id="function-shrike-sum">Function: shrike.sum</h2>
<p>Sum up a 1d array.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>a</strong> - the array operand.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float sum.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.sum = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
  
    shrike.assert(shrike.isArray(a), <span class="hljs-string">'can\'t compute sum of non-array '</span> + a);
    <span class="hljs-keyword">return</span> _.reduce(shrike.toFloat(a), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(memo, num)</span> {</span>
      <span class="hljs-keyword">if</span> (!shrike.isNumber(num)) {
        shrike.throwError(<span class="hljs-string">'can\'t compute sum of array with non numeric element: '</span> + num);
      }
  
      <span class="hljs-keyword">return</span> memo + num;
    }, <span class="hljs-number">0.0</span>);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <h2 id="function-shrike-square">Function: shrike.square</h2>
<p>Square a number.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>x</strong> - the numeric operand.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float square.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.square = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span> {</span>
  
    shrike.assert(shrike.isNumber(x), <span class="hljs-string">'can\'t square non numeric element: '</span> + x);
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(x) * <span class="hljs-built_in">parseFloat</span>(x);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h2 id="function-shrike-round">Function: shrike.round</h2>
<p>Round a number to a an arbitrary precision.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>x</strong> - numeric operand.</li>
<li><strong>dec</strong> - (optional) the number of decimal places, defaults to zero.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float rounded number.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.round = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n, dec)</span> {</span>
    <span class="hljs-keyword">if</span> (dec === <span class="hljs-literal">undefined</span>) {
      dec = <span class="hljs-number">0</span>;
    }
  
    shrike.assert(shrike.isNumber(dec), <span class="hljs-string">'round: '</span> + dec + <span class="hljs-string">' is not valid number of decimal places'</span>);
    shrike.assert(dec &lt;= <span class="hljs-number">20</span>, <span class="hljs-string">'round: can only round up to 20 decimal places'</span>);
    shrike.assert(shrike.isNumber(n), <span class="hljs-string">'round: '</span> + n + <span class="hljs-string">' is not a numeric type'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Number</span>(n + <span class="hljs-string">''</span>).toFixed(<span class="hljs-built_in">parseInt</span>(dec)));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h2 id="function-shrike-roundarray">Function: shrike.roundArray</h2>
<p>Round each element in an array to a an arbitrary precision.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>A</strong> - numeric array operand.</li>
<li><strong>dec</strong> - (optional) the number of decimal places, defaults to zero.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float rounded array.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.roundArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(A, dec)</span> {</span>
    shrike.throwError(shrike.isArray(A), <span class="hljs-string">'roundArray: not an array'</span>);
    <span class="hljs-keyword">return</span> shrike.scalarIterator(A, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
      <span class="hljs-keyword">return</span> shrike.round(a, dec);
    });
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <h2 id="function-shrike-tofloat">Function: shrike.toFloat</h2>
<p>Converts the argument to a float value.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>x, y, z</strong> - the 3 elements of the new vector.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>A new vector containing with the given argument values.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.toFloat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(thing)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>its a number</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (shrike.isNumber(thing)) {
      <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(thing);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>its already floating point</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (shrike.isFloatArray(thing)) {
      <span class="hljs-keyword">return</span> thing;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>its an array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (shrike.isArray(thing)) {
  
      <span class="hljs-keyword">var</span> _convert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(thing)</span> {</span>
  
        shrike.assert(shrike.isNumber(thing), <span class="hljs-string">'toFloat: array has something in it that is not a number: '</span> + thing);
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(thing);
      };</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>its a 2d array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (shrike.is2DArray(thing)) {
        <span class="hljs-keyword">return</span> _.map(thing, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(row)</span> {</span>
          <span class="hljs-keyword">return</span> _.map(row, _convert);
        });
      }
      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> _.map(thing, _convert);
      }
    }
    <span class="hljs-keyword">else</span> {
      shrike.throwError(<span class="hljs-string">'toFloat: can not convert to float: '</span> + thing);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <h2 id="function-shrike-unitconversionscale">Function: shrike.unitConversionScale</h2>
<p>Return a scale so that X source * scale = Y target.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>sourceUnit</strong> - the source unit.</li>
<li><strong>targetUnit</strong> - the target unit.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float scale.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.unitConversionScale = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sourceUnit, targetUnit)</span> {</span>
    <span class="hljs-keyword">var</span> unitDict = {
      m: <span class="hljs-number">1.0</span>,
      meter: <span class="hljs-number">1.0</span>,
      cm: <span class="hljs-number">100.0</span>,
      mm: <span class="hljs-number">1000.0</span>,
      um: <span class="hljs-number">1e6</span>,
      nm: <span class="hljs-number">1e9</span>,
      inch: <span class="hljs-number">39.370078740157481</span>,
      <span class="hljs-keyword">in</span> : <span class="hljs-number">39.370078740157481</span>
    };
    <span class="hljs-keyword">var</span> units = _.keys(unitDict);
  
    shrike.assert(_.contains(units, targetUnit) &amp;&amp; _.contains(units, sourceUnit), <span class="hljs-string">'no conversion for either '</span> + sourceUnit + <span class="hljs-string">' or '</span> + targetUnit);
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">parseFloat</span>(unitDict[targetUnit] / unitDict[sourceUnit]);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <h2 id="function-shrike-todegrees">Function: shrike.toDegrees</h2>
<p>Converts a number, 1 or 2d array of angles in degrees to radians.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>x</strong> - the item being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>the converted value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.toDegrees = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span> {</span>
    <span class="hljs-keyword">var</span> _convert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span> {</span>
  
      shrike.assert(shrike.isNumber(n), <span class="hljs-string">'toDegrees: not a number'</span>);
      <span class="hljs-keyword">if</span> (shrike.abs(n) &lt;= <span class="hljs-number">1e-10</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0.0</span>;
      }
      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> (<span class="hljs-number">180.0</span> / shrike.PI) * n;
      }
    };
  
    <span class="hljs-keyword">if</span> (shrike.isNumber(x)) {
      <span class="hljs-keyword">return</span> _convert(x);
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> shrike.scalarIterator(x, _convert);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h2 id="function-shrike-toradians">Function: shrike.toRadians</h2>
<p>Converts a number, 1 or 2d array of angles in radians to degrees.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>x</strong> - the item being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted value.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.toRadians = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x)</span> {</span>
    <span class="hljs-keyword">var</span> _convert = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(n)</span> {</span>
  
      shrike.assert(shrike.isNumber(n), <span class="hljs-string">'toRadians: not a number'</span>);
      <span class="hljs-keyword">return</span> (shrike.PI / <span class="hljs-number">180.0</span>) * n;
    };
  
    <span class="hljs-keyword">if</span> (shrike.isNumber(x)) {
      <span class="hljs-keyword">return</span> _convert(x);
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">return</span> shrike.scalarIterator(x, _convert);
    }
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <h2 id="function-shrike-toradians">Function: shrike.toRadians</h2>
<p>parses an axis and an angle into an object from some arguments</p>
<p><strong>Parameters:</strong></p>
<ul>
<li>Can be an object with axis and angle properties</li>
<li>or an array of 3 values for the axis and an angle as the second argument</li>
<li>or an array of 4 values, first three being axis and the last one angle</li>
</ul>
<p><strong>Returns:</strong></p>
<p>an object that looks like this:</p>
<pre><code>{
  axis: [float x, float y, float z],
  angle: float
}
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.parseAxisAngle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(axis, angle)</span> {</span>
    <span class="hljs-keyword">var</span> _axis;
    <span class="hljs-keyword">var</span> _angle;
    <span class="hljs-keyword">var</span> _throwError = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>
      shrike.throwError(<span class="hljs-string">'parseAxisAngle: arguments were not something we recognized'</span>);
    };
  
    <span class="hljs-keyword">if</span> (shrike.isArray(axis)) {
      <span class="hljs-keyword">if</span> (axis.length == <span class="hljs-number">4</span> &amp;&amp; angle === <span class="hljs-literal">undefined</span>) {
        _axis = axis.slice(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>);
        _angle = axis[<span class="hljs-number">3</span>];
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (axis.length == <span class="hljs-number">3</span> &amp;&amp; angle !== <span class="hljs-literal">undefined</span>) {
        _axis = axis;
        _angle = angle;
      }
      <span class="hljs-keyword">else</span> {
        _throwError();
      }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (_.isObject(axis) &amp;&amp; angle === <span class="hljs-literal">undefined</span>) {
      <span class="hljs-keyword">if</span> (axis.hasOwnProperty(<span class="hljs-string">'axis'</span>) &amp;&amp; axis.hasOwnProperty(<span class="hljs-string">'angle'</span>)) {
        _axis = axis.axis;
        _angle = axis.angle;
      }
      <span class="hljs-keyword">else</span> {
        _throwError();
      }
    }
    <span class="hljs-keyword">else</span> {
      _throwError();
    }
    <span class="hljs-keyword">return</span> {
      axis: shrike.toFloat(_axis),
      angle: shrike.toFloat(_angle)
    };
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h2 id="function-shrike-quatfromaxisangle">Function: shrike.quatFromAxisAngle</h2>
<p>Convert a quaternion from axis angle (radians).</p>
<p><strong>Parameters:</strong></p>
<ul>
<li>Can be an object with axis and angle properties</li>
<li>or an array of 3 values for the axis and an angle as the second argument</li>
<li>or an array of 4 values, first three being axis and the last one angle</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted quaternion.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.quatFromAxisAngle = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_axis, _angle)</span> {</span>
    <span class="hljs-keyword">var</span> aa = shrike.parseAxisAngle(_axis, _angle);
    <span class="hljs-keyword">var</span> axis = aa.axis;
    <span class="hljs-keyword">var</span> angle = aa.angle;
  
    <span class="hljs-keyword">var</span> axisLength = shrike.sum(_.map(axis, shrike.square));
    <span class="hljs-keyword">if</span> (axisLength &lt;= <span class="hljs-number">1e-10</span>) {
      <span class="hljs-keyword">return</span> [<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>];
    }
    <span class="hljs-keyword">var</span> halfangle = angle / <span class="hljs-number">2.0</span>;
    <span class="hljs-keyword">var</span> sinangle = <span class="hljs-built_in">Math</span>.sin(halfangle) / <span class="hljs-built_in">Math</span>.sqrt(axisLength);</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>TODO: return a float array</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> [<span class="hljs-built_in">Math</span>.cos(halfangle), axis[<span class="hljs-number">0</span>] * sinangle, axis[<span class="hljs-number">1</span>] * sinangle, axis[<span class="hljs-number">2</span>] * sinangle];
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <h2 id="function-shrike-quatfrommatrix">Function: shrike.quatFromMatrix</h2>
<p>Convert a quaternion from matrix.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>Traw</strong> - the matrix being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted quaternion.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.quatFromMatrix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Traw)</span> {</span>
  
    <span class="hljs-keyword">var</span> T = shrike.toFloat(Traw);
  
    <span class="hljs-keyword">var</span> tr = T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] + T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>];
    <span class="hljs-keyword">var</span> rot = [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>];
    <span class="hljs-keyword">if</span> (tr &gt;= <span class="hljs-number">0.0</span>) {
      rot[<span class="hljs-number">0</span>] = tr + <span class="hljs-number">1.0</span>;
      rot[<span class="hljs-number">1</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>] - T[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]);
      rot[<span class="hljs-number">2</span>] = (T[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] - T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]);
      rot[<span class="hljs-number">3</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] - T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]);
    }
    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>find the largest diagonal element and jump to the appropriate case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] &gt; T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]) {
        <span class="hljs-keyword">if</span> (T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] &gt; T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]) {
          rot[<span class="hljs-number">3</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] - (T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>])) + <span class="hljs-number">1.0</span>;
          rot[<span class="hljs-number">1</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] + T[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>]);
          rot[<span class="hljs-number">2</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>] + T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>]);
          rot[<span class="hljs-number">0</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] - T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]);
        }
        <span class="hljs-keyword">else</span> {
          rot[<span class="hljs-number">2</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] - (T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] + T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>])) + <span class="hljs-number">1.0</span>;
          rot[<span class="hljs-number">3</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>] + T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>]);
          rot[<span class="hljs-number">1</span>] = (T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] + T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]);
          rot[<span class="hljs-number">0</span>] = (T[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] - T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]);
        }
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] &gt; T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]) {
        rot[<span class="hljs-number">3</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] - (T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] + T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>])) + <span class="hljs-number">1.0</span>;
        rot[<span class="hljs-number">1</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] + T[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>]);
        rot[<span class="hljs-number">2</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>] + T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>]);
        rot[<span class="hljs-number">0</span>] = (T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] - T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>]);
      }
      <span class="hljs-keyword">else</span> {
        rot[<span class="hljs-number">1</span>] = (T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] - (T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] + T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>])) + <span class="hljs-number">1.0</span>;
        rot[<span class="hljs-number">2</span>] = (T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] + T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]);
        rot[<span class="hljs-number">3</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] + T[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>]);
        rot[<span class="hljs-number">0</span>] = (T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>] - T[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]);
      }
    }
  
    <span class="hljs-keyword">return</span> shrike.divide(rot, shrike.magnitude(rot));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <h2 id="function-shrike-matrixfromquat">Function: shrike.matrixFromQuat</h2>
<p>Convert a matrix from quaternion.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>quatRaw</strong> - the quaternion being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted matrix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.matrixFromQuat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(quatRaw)</span> {</span>
    <span class="hljs-keyword">var</span> quat = shrike.toFloat(quatRaw);
  
    <span class="hljs-keyword">var</span> length2 = shrike.square(shrike.magnitude(quat));
    <span class="hljs-keyword">if</span> (length2 &lt;= <span class="hljs-number">1e-8</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>invalid quaternion, so return identity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> m.eye(<span class="hljs-number">4</span>);
    }
    <span class="hljs-keyword">var</span> ilength2 = <span class="hljs-number">2.0</span> / length2;
  
    <span class="hljs-keyword">var</span> qq1 = ilength2 * quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">var</span> qq2 = ilength2 * quat[<span class="hljs-number">2</span>] * quat[<span class="hljs-number">2</span>];
    <span class="hljs-keyword">var</span> qq3 = ilength2 * quat[<span class="hljs-number">3</span>] * quat[<span class="hljs-number">3</span>];
  
    <span class="hljs-keyword">var</span> T = shrike.eye(<span class="hljs-number">4</span>);
  
    T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">1.0</span> - qq2 - qq3;
    T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">2</span>] - quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">3</span>]);
    T[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">3</span>] + quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">2</span>]);
    T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">2</span>] + quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">3</span>]);
    T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = <span class="hljs-number">1.0</span> - qq1 - qq3;
    T[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>] = ilength2 * (quat[<span class="hljs-number">2</span>] * quat[<span class="hljs-number">3</span>] - quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">1</span>]);
    T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">3</span>] - quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">2</span>]);
    T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>] = ilength2 * (quat[<span class="hljs-number">2</span>] * quat[<span class="hljs-number">3</span>] + quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">1</span>]);
    T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>] = <span class="hljs-number">1.0</span> - qq1 - qq2;
  
    <span class="hljs-keyword">return</span> T;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <h2 id="function-shrike-axisanglefromquat">Function: shrike.axisAngleFromQuat</h2>
<p>Convert a quaternion into axis angle representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>quatRaw</strong> - the quaternion being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted axis angle object (angle is in radians).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.axisAngleFromQuat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(quatraw)</span> {</span>
  
    <span class="hljs-keyword">var</span> quat = shrike.toFloat(quatraw);
    <span class="hljs-keyword">var</span> sinang = shrike.sum(_.map(quat.slice(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>), shrike.square));
  
    <span class="hljs-keyword">var</span> identity = {
      axis: [<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>],
      angle: <span class="hljs-number">0.0</span>
    };
    <span class="hljs-keyword">if</span> (sinang === <span class="hljs-number">0.0</span>) {
      <span class="hljs-keyword">return</span> identity;
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">0</span>] + sinang &lt;= <span class="hljs-number">1e-8</span>) {
      shrike.throwError(<span class="hljs-string">'invalid quaternion '</span> + quat);
    }
    <span class="hljs-keyword">var</span> _quat;
    <span class="hljs-keyword">if</span> (quat[<span class="hljs-number">0</span>] &lt; <span class="hljs-number">0.0</span>) {
      _quat = [-quat[<span class="hljs-number">0</span>], -quat[<span class="hljs-number">1</span>], -quat[<span class="hljs-number">2</span>], -quat[<span class="hljs-number">3</span>]];
    }
    <span class="hljs-keyword">else</span> {
      _quat = quat;
    }
    sinang = <span class="hljs-built_in">Math</span>.sqrt(sinang);
    <span class="hljs-keyword">var</span> f = <span class="hljs-number">1.0</span> / sinang;
  
    <span class="hljs-keyword">var</span> angle = <span class="hljs-number">2.0</span> * <span class="hljs-built_in">Math</span>.atan2(sinang, _quat[<span class="hljs-number">0</span>]);
    <span class="hljs-keyword">return</span> {
      axis: [_quat[<span class="hljs-number">1</span>] * f, _quat[<span class="hljs-number">2</span>] * f, _quat[<span class="hljs-number">3</span>] * f],
      angle: angle
    };
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <h2 id="function-shrike-axisanglefrommatrix">Function: shrike.axisAngleFromMatrix</h2>
<p>Convert a matrix into axis angle representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>m</strong> - the matrix being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted axis angle object (angle is in radians).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.axisAngleFromMatrix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m)</span> {</span>
    <span class="hljs-keyword">return</span> shrike.axisAngleFromQuat(shrike.quatFromMatrix(m));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h2 id="function-shrike-zxyfrommatrix">Function: shrike.zxyFromMatrix</h2>
<p>Convert a matrix into zxy angle representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>Traw</strong> - the matrix being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted array of angles (angles are is in degrees).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.zxyFromMatrix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Traw)</span> {</span>
  
    <span class="hljs-keyword">var</span> T = shrike.matrix4to3(shrike.toFloat(Traw));
  
    <span class="hljs-keyword">var</span> epsilon = <span class="hljs-number">1e-10</span>;
  
    <span class="hljs-keyword">var</span> x, y, z;
    <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">Math</span>.abs(T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]) &lt; epsilon) &amp;&amp; (<span class="hljs-built_in">Math</span>.abs(T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]) &lt; epsilon)) {
      <span class="hljs-keyword">var</span> sinx = T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>];
      <span class="hljs-keyword">if</span> (sinx &gt; <span class="hljs-number">0.0</span>) {
        x = <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2.0</span>;
      }
      <span class="hljs-keyword">else</span> {
        x = -<span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2.0</span>;
      }
      z = <span class="hljs-number">0.0</span>;
      y = <span class="hljs-built_in">Math</span>.atan2(sinx * T[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], T[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]);
    }
    <span class="hljs-keyword">else</span> {
      y = <span class="hljs-built_in">Math</span>.atan2(-T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>], T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]);
      <span class="hljs-keyword">var</span> siny = <span class="hljs-built_in">Math</span>.sin(y);
      <span class="hljs-keyword">var</span> cosy = <span class="hljs-built_in">Math</span>.cos(y);
      <span class="hljs-keyword">var</span> Ryinv = [
      [cosy, <span class="hljs-number">0.0</span>, -siny],
      [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>],
      [siny, <span class="hljs-number">0.0</span>, cosy]
    ];
      <span class="hljs-keyword">var</span> Rzx = shrike.matrixMult(T, Ryinv);
      x = <span class="hljs-built_in">Math</span>.atan2(Rzx[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>], Rzx[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]);
      z = <span class="hljs-built_in">Math</span>.atan2(Rzx[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], Rzx[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]);
    }
    <span class="hljs-keyword">return</span> shrike.toDegrees([x, y, z]);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <h2 id="function-shrike-zyxfrommatrix">Function: shrike.zyxFromMatrix</h2>
<p>Convert a matrix into zyx angle representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>Traw</strong> - the matrix being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted array of angles (angles are is in degrees).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.zyxFromMatrix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Traw)</span> {</span>
    <span class="hljs-keyword">var</span> T = shrike.toFloat(Traw);
    <span class="hljs-keyword">var</span> epsilon = <span class="hljs-number">1e-10</span>;
    <span class="hljs-keyword">var</span> x, y, z;
  
    <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">Math</span>.abs(T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>]) &lt; epsilon) &amp;&amp; (<span class="hljs-built_in">Math</span>.abs(T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]) &lt; epsilon)) {
      <span class="hljs-keyword">if</span> (T[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>] &lt;= <span class="hljs-number">0.0</span>) {
        y = <span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2.0</span>;
      }
      <span class="hljs-keyword">else</span> {
        y = -<span class="hljs-built_in">Math</span>.PI / <span class="hljs-number">2.0</span>;
      }
      <span class="hljs-keyword">if</span> (y &gt; <span class="hljs-number">0.0</span>) {
        <span class="hljs-keyword">var</span> xminusz = <span class="hljs-built_in">Math</span>.atan2(T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]);
        x = xminusz;
        z = <span class="hljs-number">0.0</span>;
      }
      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> xplusz = -<span class="hljs-built_in">Math</span>.atan2(T[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], T[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]);
        x = xplusz;
        z = <span class="hljs-number">0.0</span>;
      }
    }
    <span class="hljs-keyword">else</span> {
      x = <span class="hljs-built_in">Math</span>.atan2(T[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>], T[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]);
      <span class="hljs-keyword">var</span> sinx = <span class="hljs-built_in">Math</span>.sin(x);
      <span class="hljs-keyword">var</span> cosx = <span class="hljs-built_in">Math</span>.cos(x);
      <span class="hljs-keyword">var</span> Rxinv = [[<span class="hljs-number">1.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>], [<span class="hljs-number">0.0</span>, cosx, sinx], [<span class="hljs-number">0.0</span>, -sinx, cosx]];
      <span class="hljs-keyword">var</span> Rzy = shrike.matrixMult(shrike.matrix4to3(T), Rxinv);
      y = <span class="hljs-built_in">Math</span>.atan2(-Rzy[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>], Rzy[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]);
      z = <span class="hljs-built_in">Math</span>.atan2(-Rzy[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], Rzy[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]);
    }
  
    <span class="hljs-keyword">return</span> shrike.toDegrees([x, y, z]);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <h2 id="function-shrike-matrixfromzxy">Function: shrike.matrixFromZXY</h2>
<p>Convert a zxy angle array into matrix representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>ZXY</strong> - the zxy angle array being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted matrix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.matrixFromZXY = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ZXY)</span> {</span>
  
    <span class="hljs-keyword">var</span> x = shrike.toRadians(<span class="hljs-built_in">parseFloat</span>(ZXY[<span class="hljs-number">0</span>]));
    <span class="hljs-keyword">var</span> y = shrike.toRadians(<span class="hljs-built_in">parseFloat</span>(ZXY[<span class="hljs-number">1</span>]));
    <span class="hljs-keyword">var</span> z = shrike.toRadians(<span class="hljs-built_in">parseFloat</span>(ZXY[<span class="hljs-number">2</span>]));
    <span class="hljs-keyword">return</span> [
    [
      -<span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.sin(z) + <span class="hljs-built_in">Math</span>.cos(y) * <span class="hljs-built_in">Math</span>.cos(z),
      -<span class="hljs-built_in">Math</span>.sin(z) * <span class="hljs-built_in">Math</span>.cos(x),
      <span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.sin(z) * <span class="hljs-built_in">Math</span>.cos(y) + <span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.cos(z)
    ], [
      <span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.cos(z) + <span class="hljs-built_in">Math</span>.sin(z) * <span class="hljs-built_in">Math</span>.cos(y),
      <span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.cos(z),
      -<span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.cos(y) * <span class="hljs-built_in">Math</span>.cos(z) + <span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.sin(z)
    ], [
      -<span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.cos(x),
      <span class="hljs-built_in">Math</span>.sin(x),
      <span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.cos(y)
    ]
      ];
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <h2 id="function-shrike-matrixfromzyx">Function: shrike.matrixFromZYX</h2>
<p>Convert a zyx angle array into matrix representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>Traw</strong> - the matrix being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted matrix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.matrixFromZYX = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(ZYX)</span> {</span>
    <span class="hljs-keyword">var</span> x = shrike.toRadians(<span class="hljs-built_in">parseFloat</span>(ZYX[<span class="hljs-number">0</span>]));
    <span class="hljs-keyword">var</span> y = shrike.toRadians(<span class="hljs-built_in">parseFloat</span>(ZYX[<span class="hljs-number">1</span>]));
    <span class="hljs-keyword">var</span> z = shrike.toRadians(<span class="hljs-built_in">parseFloat</span>(ZYX[<span class="hljs-number">2</span>]));
    <span class="hljs-keyword">return</span> [
    [
      <span class="hljs-built_in">Math</span>.cos(y) * <span class="hljs-built_in">Math</span>.cos(z),
      -<span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.sin(z) + <span class="hljs-built_in">Math</span>.cos(z) * <span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.sin(y),
      <span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.sin(z) + <span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.cos(z) * <span class="hljs-built_in">Math</span>.sin(y)
    ], [
      <span class="hljs-built_in">Math</span>.cos(y) * <span class="hljs-built_in">Math</span>.sin(z),
      <span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.cos(z) + <span class="hljs-built_in">Math</span>.sin(x) * <span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.sin(z),
      -<span class="hljs-built_in">Math</span>.cos(z) * <span class="hljs-built_in">Math</span>.sin(x) + <span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.sin(y) * <span class="hljs-built_in">Math</span>.sin(z)
    ], [
      -<span class="hljs-built_in">Math</span>.sin(y),
      <span class="hljs-built_in">Math</span>.cos(y) * <span class="hljs-built_in">Math</span>.sin(x),
      <span class="hljs-built_in">Math</span>.cos(x) * <span class="hljs-built_in">Math</span>.cos(y)
    ]
      ];
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <h2 id="function-shrike-zxyfromquat">Function: shrike.zxyFromQuat</h2>
<p>Convert a quaternion into zxy representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>quat</strong> - the quaternion being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted array of angles (angles are is in degrees).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.zxyFromQuat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(quat)</span> {</span>
    <span class="hljs-keyword">return</span> shrike.zxyFromMatrix(shrike.matrixFromQuat(shrike.toFloat(quat)));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <h2 id="function-shrike-quatfromzxy">Function: shrike.quatFromZXY</h2>
<p>Convert a zxy angle array into quaternion.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>zxy</strong> - the angle array being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted quaternion.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.quatFromZXY = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(zxy)</span> {</span>
    <span class="hljs-keyword">return</span> shrike.quatFromMatrix(shrike.matrixFromZXY(shrike.toFloat(zxy)));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <h2 id="function-shrike-zyxfromquat">Function: shrike.zyxFromQuat</h2>
<p>Convert a quaternion into zxy representation.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>quat</strong> - the quaternion being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted array of angles (angles are is in degrees).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.zyxFromQuat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(quat)</span> {</span>
    <span class="hljs-keyword">return</span> shrike.zyxFromMatrix(shrike.matrixFromQuat(shrike.toFloat(quat)));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <h2 id="function-shrike-quatfromzyx">Function: shrike.quatFromZYX</h2>
<p>Convert a zyx angle array into quaternion.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>zyx</strong> - the angle array being converted.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the converted quaternion.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.quatFromZYX = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(zyx)</span> {</span>
    <span class="hljs-keyword">return</span> shrike.quatFromMatrix(shrike.matrixFromZYX(shrike.toFloat(zyx)));
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h2 id="function-shrike-matrix4to3">Function: shrike.matrix4to3</h2>
<p>Carves out the 3x3 rotation matrix out of a 3x4 or 4x4 transform.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>M</strong> - the source matrix.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float 3x3 rotation matrix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.matrix4to3 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(M)</span> {</span>
    <span class="hljs-keyword">return</span> [[M[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], M[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], M[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>]], [M[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], M[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>], M[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>]], [M[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>], M[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>], M[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]]];
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <h2 id="function-shrike-composetransformarray">Function: shrike.composeTransformArray</h2>
<p>Make a 4x4 transform from a 3x3 rotation matrix and a translation vector.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>rot</strong> - the rotation matrix.</li>
<li><strong>trans</strong> - the translation vector.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>float the 4x4 result matrix.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.composeTransformArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(rot, trans)</span> {</span>
    <span class="hljs-keyword">return</span> [[rot[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], rot[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], rot[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>], trans[<span class="hljs-number">0</span>]], [rot[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], rot[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>], rot[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>], trans[<span class="hljs-number">1</span>]], [rot[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>], rot[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>], rot[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>], trans[<span class="hljs-number">2</span>]], [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>]];
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h2 id="function-shrike-decomposetransformarray">Function: shrike.decomposeTransformArray</h2>
<p>Break a 4x4 transform down into a 3x3 rotation matrix and a translation vector.</p>
<p><strong>Parameters:</strong></p>
<ul>
<li><strong>T</strong> - the source matrix.</li>
</ul>
<p><strong>Returns:</strong></p>
<p>an object that looks like this</p>
<pre><code>{
  rotationMatrix: <span class="hljs-number">3</span>x3 rotation matrix,
  translation: [float x, float y, float z],
}
</code></pre>
            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.decomposeTransformArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(T)</span> {</span>
    <span class="hljs-keyword">return</span> {
      rotationMatrix: [T[<span class="hljs-number">0</span>].slice(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>), T[<span class="hljs-number">1</span>].slice(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>), T[<span class="hljs-number">2</span>].slice(<span class="hljs-number">0</span>, <span class="hljs-number">3</span>)],
      translation: [T[<span class="hljs-number">0</span>][<span class="hljs-number">3</span>], T[<span class="hljs-number">1</span>][<span class="hljs-number">3</span>], T[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>]]
    };
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>common matrix operations</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.divide = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(A, scalar)</span> {</span>
    <span class="hljs-keyword">return</span> shrike.scalarIterator(shrike.toFloat(A), <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
      <span class="hljs-keyword">return</span> a / <span class="hljs-built_in">parseFloat</span>(scalar);
    });
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>identity matrix
returns an m x n identity matrix
if you leave out n, it will be an m x m matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.eye = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m, n)</span> {</span>
    n = n || m;
    <span class="hljs-keyword">var</span> ret = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; n; i++) {
      <span class="hljs-keyword">var</span> row = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; m; j++) {
        <span class="hljs-keyword">if</span> (i == j) {
          row.push(<span class="hljs-number">1.0</span>);
        }
        <span class="hljs-keyword">else</span> {
          row.push(<span class="hljs-number">0.0</span>);
        }
      }
      ret.push(row);
    }
    <span class="hljs-keyword">return</span> ret;
  };
  
  
  shrike.magnitude = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span> {</span>
    <span class="hljs-keyword">if</span> (shrike.isFloatArray(a)) {
  
      shrike.assert(a.length === <span class="hljs-number">3</span>, <span class="hljs-string">'magnitude: native float array\'s need to be of length three'</span>);
      <span class="hljs-keyword">return</span> shrike.sqrt(a[<span class="hljs-number">0</span>] * a[<span class="hljs-number">0</span>] + a[<span class="hljs-number">1</span>] * a[<span class="hljs-number">1</span>] + a[<span class="hljs-number">2</span>] * a[<span class="hljs-number">2</span>]);
    }
    <span class="hljs-keyword">return</span> shrike.sqrt(shrike.sum(_.map(shrike.toFloat(a), shrike.square)));
  };
  
  shrike.norm = shrike.magnitude;
  
  
  shrike.normalize = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(array)</span> {</span>
    <span class="hljs-keyword">var</span> length = shrike.magnitude(array);
  
    shrike.assert(length !== <span class="hljs-number">0</span>, <span class="hljs-string">'normalize: trying to normalize a zero array'</span>);
    <span class="hljs-keyword">return</span> shrike.divide(array, length);
  };
  
  
  shrike.matrixMult = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_A, _B)</span> {</span>
    <span class="hljs-keyword">var</span> A = shrike.toFloat(_A);
    <span class="hljs-keyword">var</span> B = shrike.toFloat(_B);
  
    shrike.assert(A[<span class="hljs-number">0</span>].length === A.length, <span class="hljs-string">'matrixMult: incompatible array sizes!'</span>);
    <span class="hljs-keyword">var</span> result = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; A.length; i++) {
      <span class="hljs-keyword">var</span> row = [];
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; B[i].length; j++) {
        <span class="hljs-keyword">var</span> sum = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> k = <span class="hljs-number">0</span>; k &lt; A[i].length; k++) {
          sum += A[i][k] * B[k][j];
        }
        row.push(sum);
      }
      result.push(row);
    }
  
    <span class="hljs-keyword">return</span> result;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>functions to augment mjsâ€™s V3 vector</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.V3.objectToArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(o)</span> {</span>
  
    shrike.assert(_.isObject(o), <span class="hljs-string">'not an object'</span>);
    <span class="hljs-keyword">return</span> [<span class="hljs-string">'x'</span>, <span class="hljs-string">'y'</span>, <span class="hljs-string">'z'</span>].map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(p)</span> {</span>
      <span class="hljs-keyword">return</span> o[p];
    });
  };
  
  
  shrike.V3.arrayToObject = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_v)</span> {</span>
  
    shrike.assert(shrike.isArray(_v), <span class="hljs-string">'not an array'</span>);
    <span class="hljs-keyword">var</span> v = shrike.toFloat(_v);
    <span class="hljs-keyword">return</span> _.object([<span class="hljs-string">'x'</span>, <span class="hljs-string">'y'</span>, <span class="hljs-string">'z'</span>], v);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>functions to augment mjsâ€™s 4x4 matrix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.M4.matrixFromQuat = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(quatRaw)</span> {</span>
  
    shrike.assert(quatRaw.length === <span class="hljs-number">4</span>, <span class="hljs-string">'M4.matrixFromQuat: quatRaw.length !== 4'</span>);
    <span class="hljs-keyword">var</span> quat = shrike.toFloat(quatRaw);
    <span class="hljs-keyword">var</span> r = shrike.M4.clone(shrike.M4.I);
  
    <span class="hljs-keyword">var</span> length2 = shrike.sum(_.map(quat, shrike.square));
    <span class="hljs-keyword">if</span> (length2 &lt;= <span class="hljs-number">1e-8</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>invalid quaternion, so return identity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> r;
    }
    <span class="hljs-keyword">var</span> ilength2 = <span class="hljs-number">2.0</span> / length2;
  
    <span class="hljs-keyword">var</span> qq1 = ilength2 * quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">var</span> qq2 = ilength2 * quat[<span class="hljs-number">2</span>] * quat[<span class="hljs-number">2</span>];
    <span class="hljs-keyword">var</span> qq3 = ilength2 * quat[<span class="hljs-number">3</span>] * quat[<span class="hljs-number">3</span>];
  
    r[<span class="hljs-number">0</span>] = <span class="hljs-number">1.0</span> - qq2 - qq3;
    r[<span class="hljs-number">1</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">2</span>] + quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">3</span>]);
    r[<span class="hljs-number">2</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">3</span>] - quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">2</span>]);
  
    r[<span class="hljs-number">4</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">2</span>] - quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">3</span>]);
    r[<span class="hljs-number">5</span>] = <span class="hljs-number">1.0</span> - qq1 - qq3;
    r[<span class="hljs-number">6</span>] = ilength2 * (quat[<span class="hljs-number">2</span>] * quat[<span class="hljs-number">3</span>] + quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">1</span>]);
  
    r[<span class="hljs-number">8</span>] = ilength2 * (quat[<span class="hljs-number">1</span>] * quat[<span class="hljs-number">3</span>] + quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">2</span>]);
    r[<span class="hljs-number">9</span>] = ilength2 * (quat[<span class="hljs-number">2</span>] * quat[<span class="hljs-number">3</span>] - quat[<span class="hljs-number">0</span>] * quat[<span class="hljs-number">1</span>]);
    r[<span class="hljs-number">10</span>] = <span class="hljs-number">1.0</span> - qq1 - qq2;
  
    <span class="hljs-keyword">return</span> r;
  };
  
  
  shrike.M4.quatFromMatrix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_m)</span> {</span>
  
    <span class="hljs-keyword">var</span> m = shrike.toFloat(_m);
  
    <span class="hljs-keyword">var</span> m11 = m[<span class="hljs-number">0</span>];
    <span class="hljs-keyword">var</span> m21 = m[<span class="hljs-number">1</span>];
    <span class="hljs-keyword">var</span> m31 = m[<span class="hljs-number">2</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>var m41 = m[3];</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> m12 = m[<span class="hljs-number">4</span>];
    <span class="hljs-keyword">var</span> m22 = m[<span class="hljs-number">5</span>];
    <span class="hljs-keyword">var</span> m32 = m[<span class="hljs-number">6</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <p>var m42 = m[7];</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> m13 = m[<span class="hljs-number">8</span>];
    <span class="hljs-keyword">var</span> m23 = m[<span class="hljs-number">9</span>];
    <span class="hljs-keyword">var</span> m33 = m[<span class="hljs-number">10</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>var m43 = m[11];
var m14 = m[12];
var m24 = m[13];
var m34 = m[14];
var m44 = m[15];</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
    <span class="hljs-keyword">var</span> tr = m11 + m22 + m33;
    <span class="hljs-keyword">var</span> r = [<span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>, <span class="hljs-number">0.0</span>];
    <span class="hljs-keyword">if</span> (tr &gt;= <span class="hljs-number">0.0</span>) {
      r[<span class="hljs-number">0</span>] = tr + <span class="hljs-number">1.0</span>;
      r[<span class="hljs-number">1</span>] = (m32 - m23);
      r[<span class="hljs-number">2</span>] = (m13 - m31);
      r[<span class="hljs-number">3</span>] = (m21 - m12);
    }
    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>find mhe largesm diagonal elemenm and jump mo mhe appropriame case</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (m22 &gt; m11) {
        <span class="hljs-keyword">if</span> (m33 &gt; m22) {
          r[<span class="hljs-number">3</span>] = (m33 - (m11 + m22)) + <span class="hljs-number">1.0</span>;
          r[<span class="hljs-number">1</span>] = (m31 + m13);
          r[<span class="hljs-number">2</span>] = (m23 + m32);
          r[<span class="hljs-number">0</span>] = (m21 - m12);
        }
        <span class="hljs-keyword">else</span> {
          r[<span class="hljs-number">2</span>] = (m22 - (m33 + m11)) + <span class="hljs-number">1.0</span>;
          r[<span class="hljs-number">3</span>] = (m23 + m32);
          r[<span class="hljs-number">1</span>] = (m12 + m21);
          r[<span class="hljs-number">0</span>] = (m13 - m31);
        }
      }
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (m33 &gt; m11) {
        r[<span class="hljs-number">3</span>] = (m33 - (m11 + m22)) + <span class="hljs-number">1.0</span>;
        r[<span class="hljs-number">1</span>] = (m31 + m13);
        r[<span class="hljs-number">2</span>] = (m23 + m32);
        r[<span class="hljs-number">0</span>] = (m21 - m12);
      }
      <span class="hljs-keyword">else</span> {
        r[<span class="hljs-number">1</span>] = (m11 - (m22 + m33)) + <span class="hljs-number">1.0</span>;
        r[<span class="hljs-number">2</span>] = (m12 + m21);
        r[<span class="hljs-number">3</span>] = (m31 + m13);
        r[<span class="hljs-number">0</span>] = (m32 - m23);
      }
    }
  
    <span class="hljs-keyword">return</span> shrike.divide(r, shrike.magnitude(r));
  };
  
  
  shrike.M4.transFromMatrix = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m)</span> {</span></pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>var r = new shrike.FLOAT_ARRAY_TYPE(3);</p>

            </div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>TODO use native array type hereâ€¦</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> r = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(<span class="hljs-number">3</span>);
    r[<span class="hljs-number">0</span>] = m[<span class="hljs-number">12</span>];
    r[<span class="hljs-number">1</span>] = m[<span class="hljs-number">13</span>];
    r[<span class="hljs-number">2</span>] = m[<span class="hljs-number">14</span>];
    <span class="hljs-keyword">return</span> r;
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <p>composes an instance from a quaternion and translation V3</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  
  shrike.M4.composeFromQuatTrans = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(quatRaw, transRaw)</span> {</span>
    <span class="hljs-keyword">var</span> r = shrike.M4.matrixFromQuat(quatRaw);
  
    <span class="hljs-keyword">var</span> trans = shrike.toFloat(transRaw);
  
    shrike.assert(trans.length === <span class="hljs-number">3</span>, <span class="hljs-string">'M4.composeFromQuatTrans: trans.length !== 3'</span>);
    r[<span class="hljs-number">12</span>] = trans[<span class="hljs-number">0</span>];
    r[<span class="hljs-number">13</span>] = trans[<span class="hljs-number">1</span>];
    r[<span class="hljs-number">14</span>] = trans[<span class="hljs-number">2</span>];
  
    <span class="hljs-keyword">return</span> r;
  };
  
  shrike.M4toTransformArray = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m)</span> {</span>
    <span class="hljs-keyword">return</span> [[m[<span class="hljs-number">0</span>], m[<span class="hljs-number">4</span>], m[<span class="hljs-number">8</span>], m[<span class="hljs-number">12</span>]], [m[<span class="hljs-number">1</span>], m[<span class="hljs-number">5</span>], m[<span class="hljs-number">9</span>], m[<span class="hljs-number">13</span>]], [m[<span class="hljs-number">2</span>], m[<span class="hljs-number">6</span>], m[<span class="hljs-number">10</span>], m[<span class="hljs-number">14</span>]], [m[<span class="hljs-number">3</span>], m[<span class="hljs-number">7</span>], m[<span class="hljs-number">11</span>], m[<span class="hljs-number">15</span>]]];
  };
  
  
  shrike.transformArrayToM4 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(m)</span> {</span>
    <span class="hljs-keyword">return</span> [m[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>], m[<span class="hljs-number">1</span>][<span class="hljs-number">0</span>], m[<span class="hljs-number">2</span>][<span class="hljs-number">0</span>], m[<span class="hljs-number">3</span>][<span class="hljs-number">0</span>], m[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>], m[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>], m[<span class="hljs-number">2</span>][<span class="hljs-number">1</span>], m[<span class="hljs-number">3</span>][<span class="hljs-number">1</span>], m[<span class="hljs-number">0</span>][<span class="hljs-number">2</span>], m[<span class="hljs-number">1</span>][<span class="hljs-number">2</span>], m[<span class="hljs-number">2</span>][<span class="hljs-number">2</span>], m[<span class="hljs-number">3</span>][<span class="hljs-number">2</span>], m[<span class="hljs-number">0</span>][<span class="hljs-number">3</span>], m[<span class="hljs-number">1</span>][<span class="hljs-number">3</span>], m[<span class="hljs-number">2</span>][<span class="hljs-number">3</span>], m[<span class="hljs-number">3</span>][<span class="hljs-number">3</span>]];
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>requires t0, t1 to be distinct</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  shrike.linearlyInterpolate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(t0, x0, t1, x1, t)</span> {</span>
    <span class="hljs-keyword">return</span> (x0 * (t1 - t) + x1 * (t - t0)) / (t1 - t0);
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>for debugging / console convenience</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">if</span> (window.makeGlobal !== <span class="hljs-literal">undefined</span>) {
    window.makeGlobal(shrike);
    window.makeGlobal({
      math: shrike,
      shrike: shrike
    });
  }

  <span class="hljs-keyword">return</span> shrike;
});</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
