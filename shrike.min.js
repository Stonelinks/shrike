(function(){var r=this,t=r._,n={},e=Array.prototype,a=Object.prototype,i=Function.prototype,o=e.push,u=e.slice,s=e.concat,c=a.toString,l=a.hasOwnProperty,f=e.forEach,h=e.map,p=e.reduce,g=e.reduceRight,m=e.filter,v=e.every,d=e.some,y=e.indexOf,M=e.lastIndexOf,x=Array.isArray,F=Object.keys,w=i.bind,b=function(r){return r instanceof b?r:this instanceof b?(this._wrapped=r,void 0):new b(r)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports._=b):r._=b,b.VERSION="1.6.0";var A=b.each=b.forEach=function(r,t,e){if(null==r)return r;if(f&&r.forEach===f)r.forEach(t,e);else if(r.length===+r.length){for(var a=0,i=r.length;i>a;a++)if(t.call(e,r[a],a,r)===n)return}else for(var o=b.keys(r),a=0,i=o.length;i>a;a++)if(t.call(e,r[o[a]],o[a],r)===n)return;return r};b.map=b.collect=function(r,t,n){var e=[];return null==r?e:h&&r.map===h?r.map(t,n):(A(r,function(r,a,i){e.push(t.call(n,r,a,i))}),e)};var j="Reduce of empty array with no initial value";b.reduce=b.foldl=b.inject=function(r,t,n,e){var a=arguments.length>2;if(null==r&&(r=[]),p&&r.reduce===p)return e&&(t=b.bind(t,e)),a?r.reduce(t,n):r.reduce(t);if(A(r,function(r,i,o){a?n=t.call(e,n,r,i,o):(n=r,a=!0)}),!a)throw new TypeError(j);return n},b.reduceRight=b.foldr=function(r,t,n,e){var a=arguments.length>2;if(null==r&&(r=[]),g&&r.reduceRight===g)return e&&(t=b.bind(t,e)),a?r.reduceRight(t,n):r.reduceRight(t);var i=r.length;if(i!==+i){var o=b.keys(r);i=o.length}if(A(r,function(u,s,c){s=o?o[--i]:--i,a?n=t.call(e,n,r[s],s,c):(n=r[s],a=!0)}),!a)throw new TypeError(j);return n},b.find=b.detect=function(r,t,n){var e;return _(r,function(r,a,i){return t.call(n,r,a,i)?(e=r,!0):void 0}),e},b.filter=b.select=function(r,t,n){var e=[];return null==r?e:m&&r.filter===m?r.filter(t,n):(A(r,function(r,a,i){t.call(n,r,a,i)&&e.push(r)}),e)},b.reject=function(r,t,n){return b.filter(r,function(r,e,a){return!t.call(n,r,e,a)},n)},b.every=b.all=function(r,t,e){t||(t=b.identity);var a=!0;return null==r?a:v&&r.every===v?r.every(t,e):(A(r,function(r,i,o){return(a=a&&t.call(e,r,i,o))?void 0:n}),!!a)};var _=b.some=b.any=function(r,t,e){t||(t=b.identity);var a=!1;return null==r?a:d&&r.some===d?r.some(t,e):(A(r,function(r,i,o){return a||(a=t.call(e,r,i,o))?n:void 0}),!!a)};b.contains=b.include=function(r,t){return null==r?!1:y&&r.indexOf===y?-1!=r.indexOf(t):_(r,function(r){return r===t})},b.invoke=function(r,t){var n=u.call(arguments,2),e=b.isFunction(t);return b.map(r,function(r){return(e?t:r[t]).apply(r,n)})},b.pluck=function(r,t){return b.map(r,b.property(t))},b.where=function(r,t){return b.filter(r,b.matches(t))},b.findWhere=function(r,t){return b.find(r,b.matches(t))},b.max=function(r,t,n){if(!t&&b.isArray(r)&&r[0]===+r[0]&&r.length<65535)return Math.max.apply(Math,r);var e=-1/0,a=-1/0;return A(r,function(r,i,o){var u=t?t.call(n,r,i,o):r;u>a&&(e=r,a=u)}),e},b.min=function(r,t,n){if(!t&&b.isArray(r)&&r[0]===+r[0]&&r.length<65535)return Math.min.apply(Math,r);var e=1/0,a=1/0;return A(r,function(r,i,o){var u=t?t.call(n,r,i,o):r;a>u&&(e=r,a=u)}),e},b.shuffle=function(r){var t,n=0,e=[];return A(r,function(r){t=b.random(n++),e[n-1]=e[t],e[t]=r}),e},b.sample=function(r,t,n){return null==t||n?(r.length!==+r.length&&(r=b.values(r)),r[b.random(r.length-1)]):b.shuffle(r).slice(0,Math.max(0,t))};var I=function(r){return null==r?b.identity:b.isFunction(r)?r:b.property(r)};b.sortBy=function(r,t,n){return t=I(t),b.pluck(b.map(r,function(r,e,a){return{value:r,index:e,criteria:t.call(n,r,e,a)}}).sort(function(r,t){var n=r.criteria,e=t.criteria;if(n!==e){if(n>e||void 0===n)return 1;if(e>n||void 0===e)return-1}return r.index-t.index}),"value")};var k=function(r){return function(t,n,e){var a={};return n=I(n),A(t,function(i,o){var u=n.call(e,i,o,t);r(a,u,i)}),a}};b.groupBy=k(function(r,t,n){b.has(r,t)?r[t].push(n):r[t]=[n]}),b.indexBy=k(function(r,t,n){r[t]=n}),b.countBy=k(function(r,t){b.has(r,t)?r[t]++:r[t]=1}),b.sortedIndex=function(r,t,n,e){n=I(n);for(var a=n.call(e,t),i=0,o=r.length;o>i;){var u=i+o>>>1;n.call(e,r[u])<a?i=u+1:o=u}return i},b.toArray=function(r){return r?b.isArray(r)?u.call(r):r.length===+r.length?b.map(r,b.identity):b.values(r):[]},b.size=function(r){return null==r?0:r.length===+r.length?r.length:b.keys(r).length},b.first=b.head=b.take=function(r,t,n){return null==r?void 0:null==t||n?r[0]:0>t?[]:u.call(r,0,t)},b.initial=function(r,t,n){return u.call(r,0,r.length-(null==t||n?1:t))},b.last=function(r,t,n){return null==r?void 0:null==t||n?r[r.length-1]:u.call(r,Math.max(r.length-t,0))},b.rest=b.tail=b.drop=function(r,t,n){return u.call(r,null==t||n?1:t)},b.compact=function(r){return b.filter(r,b.identity)};var E=function(r,t,n){return t&&b.every(r,b.isArray)?s.apply(n,r):(A(r,function(r){b.isArray(r)||b.isArguments(r)?t?o.apply(n,r):E(r,t,n):n.push(r)}),n)};b.flatten=function(r,t){return E(r,t,[])},b.without=function(r){return b.difference(r,u.call(arguments,1))},b.partition=function(r,t){var n=[],e=[];return A(r,function(r){(t(r)?n:e).push(r)}),[n,e]},b.uniq=b.unique=function(r,t,n,e){b.isFunction(t)&&(e=n,n=t,t=!1);var a=n?b.map(r,n,e):r,i=[],o=[];return A(a,function(n,e){(t?e&&o[o.length-1]===n:b.contains(o,n))||(o.push(n),i.push(r[e]))}),i},b.union=function(){return b.uniq(b.flatten(arguments,!0))},b.intersection=function(r){var t=u.call(arguments,1);return b.filter(b.uniq(r),function(r){return b.every(t,function(t){return b.contains(t,r)})})},b.difference=function(r){var t=s.apply(e,u.call(arguments,1));return b.filter(r,function(r){return!b.contains(t,r)})},b.zip=function(){for(var r=b.max(b.pluck(arguments,"length").concat(0)),t=new Array(r),n=0;r>n;n++)t[n]=b.pluck(arguments,""+n);return t},b.object=function(r,t){if(null==r)return{};for(var n={},e=0,a=r.length;a>e;e++)t?n[r[e]]=t[e]:n[r[e][0]]=r[e][1];return n},b.indexOf=function(r,t,n){if(null==r)return-1;var e=0,a=r.length;if(n){if("number"!=typeof n)return e=b.sortedIndex(r,t),r[e]===t?e:-1;e=0>n?Math.max(0,a+n):n}if(y&&r.indexOf===y)return r.indexOf(t,n);for(;a>e;e++)if(r[e]===t)return e;return-1},b.lastIndexOf=function(r,t,n){if(null==r)return-1;var e=null!=n;if(M&&r.lastIndexOf===M)return e?r.lastIndexOf(t,n):r.lastIndexOf(t);for(var a=e?n:r.length;a--;)if(r[a]===t)return a;return-1},b.range=function(r,t,n){arguments.length<=1&&(t=r||0,r=0),n=arguments[2]||1;for(var e=Math.max(Math.ceil((t-r)/n),0),a=0,i=new Array(e);e>a;)i[a++]=r,r+=n;return i};var O=function(){};b.bind=function(r,t){var n,e;if(w&&r.bind===w)return w.apply(r,u.call(arguments,1));if(!b.isFunction(r))throw new TypeError;return n=u.call(arguments,2),e=function(){if(!(this instanceof e))return r.apply(t,n.concat(u.call(arguments)));O.prototype=r.prototype;var a=new O;O.prototype=null;var i=r.apply(a,n.concat(u.call(arguments)));return Object(i)===i?i:a}},b.partial=function(r){var t=u.call(arguments,1);return function(){for(var n=0,e=t.slice(),a=0,i=e.length;i>a;a++)e[a]===b&&(e[a]=arguments[n++]);for(;n<arguments.length;)e.push(arguments[n++]);return r.apply(this,e)}},b.bindAll=function(r){var t=u.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return A(t,function(t){r[t]=b.bind(r[t],r)}),r},b.memoize=function(r,t){var n={};return t||(t=b.identity),function(){var e=t.apply(this,arguments);return b.has(n,e)?n[e]:n[e]=r.apply(this,arguments)}},b.delay=function(r,t){var n=u.call(arguments,2);return setTimeout(function(){return r.apply(null,n)},t)},b.defer=function(r){return b.delay.apply(b,[r,1].concat(u.call(arguments,1)))},b.throttle=function(r,t,n){var e,a,i,o=null,u=0;n||(n={});var s=function(){u=n.leading===!1?0:b.now(),o=null,i=r.apply(e,a),e=a=null};return function(){var c=b.now();u||n.leading!==!1||(u=c);var l=t-(c-u);return e=this,a=arguments,0>=l?(clearTimeout(o),o=null,u=c,i=r.apply(e,a),e=a=null):o||n.trailing===!1||(o=setTimeout(s,l)),i}},b.debounce=function(r,t,n){var e,a,i,o,u,s=function(){var c=b.now()-o;t>c?e=setTimeout(s,t-c):(e=null,n||(u=r.apply(i,a),i=a=null))};return function(){i=this,a=arguments,o=b.now();var c=n&&!e;return e||(e=setTimeout(s,t)),c&&(u=r.apply(i,a),i=a=null),u}},b.once=function(r){var t,n=!1;return function(){return n?t:(n=!0,t=r.apply(this,arguments),r=null,t)}},b.wrap=function(r,t){return b.partial(t,r)},b.compose=function(){var r=arguments;return function(){for(var t=arguments,n=r.length-1;n>=0;n--)t=[r[n].apply(this,t)];return t[0]}},b.after=function(r,t){return function(){return--r<1?t.apply(this,arguments):void 0}},b.keys=function(r){if(!b.isObject(r))return[];if(F)return F(r);var t=[];for(var n in r)b.has(r,n)&&t.push(n);return t},b.values=function(r){for(var t=b.keys(r),n=t.length,e=new Array(n),a=0;n>a;a++)e[a]=r[t[a]];return e},b.pairs=function(r){for(var t=b.keys(r),n=t.length,e=new Array(n),a=0;n>a;a++)e[a]=[t[a],r[t[a]]];return e},b.invert=function(r){for(var t={},n=b.keys(r),e=0,a=n.length;a>e;e++)t[r[n[e]]]=n[e];return t},b.functions=b.methods=function(r){var t=[];for(var n in r)b.isFunction(r[n])&&t.push(n);return t.sort()},b.extend=function(r){return A(u.call(arguments,1),function(t){if(t)for(var n in t)r[n]=t[n]}),r},b.pick=function(r){var t={},n=s.apply(e,u.call(arguments,1));return A(n,function(n){n in r&&(t[n]=r[n])}),t},b.omit=function(r){var t={},n=s.apply(e,u.call(arguments,1));for(var a in r)b.contains(n,a)||(t[a]=r[a]);return t},b.defaults=function(r){return A(u.call(arguments,1),function(t){if(t)for(var n in t)void 0===r[n]&&(r[n]=t[n])}),r},b.clone=function(r){return b.isObject(r)?b.isArray(r)?r.slice():b.extend({},r):r},b.tap=function(r,t){return t(r),r};var q=function(r,t,n,e){if(r===t)return 0!==r||1/r==1/t;if(null==r||null==t)return r===t;r instanceof b&&(r=r._wrapped),t instanceof b&&(t=t._wrapped);var a=c.call(r);if(a!=c.call(t))return!1;switch(a){case"[object String]":return r==String(t);case"[object Number]":return r!=+r?t!=+t:0==r?1/r==1/t:r==+t;case"[object Date]":case"[object Boolean]":return+r==+t;case"[object RegExp]":return r.source==t.source&&r.global==t.global&&r.multiline==t.multiline&&r.ignoreCase==t.ignoreCase}if("object"!=typeof r||"object"!=typeof t)return!1;for(var i=n.length;i--;)if(n[i]==r)return e[i]==t;var o=r.constructor,u=t.constructor;if(o!==u&&!(b.isFunction(o)&&o instanceof o&&b.isFunction(u)&&u instanceof u)&&"constructor"in r&&"constructor"in t)return!1;n.push(r),e.push(t);var s=0,l=!0;if("[object Array]"==a){if(s=r.length,l=s==t.length)for(;s--&&(l=q(r[s],t[s],n,e)););}else{for(var f in r)if(b.has(r,f)&&(s++,!(l=b.has(t,f)&&q(r[f],t[f],n,e))))break;if(l){for(f in t)if(b.has(t,f)&&!s--)break;l=!s}}return n.pop(),e.pop(),l};b.isEqual=function(r,t){return q(r,t,[],[])},b.isEmpty=function(r){if(null==r)return!0;if(b.isArray(r)||b.isString(r))return 0===r.length;for(var t in r)if(b.has(r,t))return!1;return!0},b.isElement=function(r){return!(!r||1!==r.nodeType)},b.isArray=x||function(r){return"[object Array]"==c.call(r)},b.isObject=function(r){return r===Object(r)},A(["Arguments","Function","String","Number","Date","RegExp"],function(r){b["is"+r]=function(t){return c.call(t)=="[object "+r+"]"}}),b.isArguments(arguments)||(b.isArguments=function(r){return!(!r||!b.has(r,"callee"))}),"function"!=typeof/./&&(b.isFunction=function(r){return"function"==typeof r}),b.isFinite=function(r){return isFinite(r)&&!isNaN(parseFloat(r))},b.isNaN=function(r){return b.isNumber(r)&&r!=+r},b.isBoolean=function(r){return r===!0||r===!1||"[object Boolean]"==c.call(r)},b.isNull=function(r){return null===r},b.isUndefined=function(r){return void 0===r},b.has=function(r,t){return l.call(r,t)},b.noConflict=function(){return r._=t,this},b.identity=function(r){return r},b.constant=function(r){return function(){return r}},b.property=function(r){return function(t){return t[r]}},b.matches=function(r){return function(t){if(t===r)return!0;for(var n in r)if(r[n]!==t[n])return!1;return!0}},b.times=function(r,t,n){for(var e=Array(Math.max(0,r)),a=0;r>a;a++)e[a]=t.call(n,a);return e},b.random=function(r,t){return null==t&&(t=r,r=0),r+Math.floor(Math.random()*(t-r+1))},b.now=Date.now||function(){return(new Date).getTime()};var R={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};R.unescape=b.invert(R.escape);var S={escape:new RegExp("["+b.keys(R.escape).join("")+"]","g"),unescape:new RegExp("("+b.keys(R.unescape).join("|")+")","g")};b.each(["escape","unescape"],function(r){b[r]=function(t){return null==t?"":(""+t).replace(S[r],function(t){return R[r][t]})}}),b.result=function(r,t){if(null==r)return void 0;var n=r[t];return b.isFunction(n)?n.call(r):n},b.mixin=function(r){A(b.functions(r),function(t){var n=b[t]=r[t];b.prototype[t]=function(){var r=[this._wrapped];return o.apply(r,arguments),D.call(this,n.apply(b,r))}})};var z=0;b.uniqueId=function(r){var t=++z+"";return r?r+t:t},b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var P=/(.)^/,T={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\t|\u2028|\u2029/g;b.template=function(r,t,n){var e;n=b.defaults({},n,b.templateSettings);var a=new RegExp([(n.escape||P).source,(n.interpolate||P).source,(n.evaluate||P).source].join("|")+"|$","g"),i=0,o="__p+='";r.replace(a,function(t,n,e,a,u){return o+=r.slice(i,u).replace(N,function(r){return"\\"+T[r]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),e&&(o+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),a&&(o+="';\n"+a+"\n__p+='"),i=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{e=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return e(t,b);var s=function(r){return e.call(this,r,b)};return s.source="function("+(n.variable||"obj")+"){\n"+o+"}",s},b.chain=function(r){return b(r).chain()};var D=function(r){return this._chain?b(r).chain():r};b.mixin(b),A(["pop","push","reverse","shift","sort","splice","unshift"],function(r){var t=e[r];b.prototype[r]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=r&&"splice"!=r||0!==n.length||delete n[0],D.call(this,n)}}),A(["concat","join","slice"],function(r){var t=e[r];b.prototype[r]=function(){return D.call(this,t.apply(this._wrapped,arguments))}}),b.extend(b.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return b})}).call(this),define("utils",["underscore"],function(r){return window.pass=function(){},function(t){t.register=function(r,n){t.hasOwnProperty(r)?console.log("SHRIKE: error: shrike already has a "+r):t[r]=n},t.register("isArray",function(t){return r.isArray(t)?!0:"Array]"==Object.prototype.toString.call(t).slice(-"Array]".length)}),t.register("prettyPrint",function(n){if(r.isArray(n)){if(r.isArray(n[0])){for(var e=6,a=0,i=0;i<n.length;i++)for(var o=0;o<n[i].length;o++){if("string"==typeof n[i][o])throw new Error("WARNING: there is a string in this matrix, you should fix that");t.round(n[i][o],e).toString().length>a&&(a=t.round(n[i][o],e).toString().length)}for(var u=[],s=void 0,i=0;i<n.length;i++){for(var c=[],o=0;o<n[i].length;o++){for(var l=t.round(n[i][o],e).toString(),f=a-l.length,h="",p="",g=0;f>g;g++)g>=f/2?h+=" ":p+=" ";c.push(h+l+p)}if(u.push(c),void 0===s){for(var m=[],v="",g=0;a>g;g++)v+="-";for(var g=0;g<c.length;g++)m.push(v);s="+-"+m.join("-+-")+"-+"}}for(var d=s+"\n",i=0;i<n.length;i++){var c=u[i],y="| "+c.join(" | ")+" |";d+=y+"\n",d+=s+"\n"}return d}var d="[ "+n.join(", ")+" ]";return d}return n})}}),define("iterators",["underscore"],function(r){return function(t){t.register("recursiveIterator",function(n,e){return e=e||pass,t.isArray(n)?t.isArray(n)&&1==n.length?[e(parseFloat(n[0]))]:r.isString(n)?e(parseFloat(n)):n.map(function(r){return t.recursiveIterator(r,e)}):e(parseFloat(n))}),t.register("elementWiseIterator",function(r,n,e){if(e=e||pass,t.isArray(r)&&t.isArray(n)&&r.length==n.length){for(var a=[],i=0;i<r.length;i++)if(t.isArray(r[i])&&t.isArray(n[i])&&r[i].length==n[i].length){for(var o=[],u=0;u<r[i].length;u++)o.push(e(parseFloat(r[i][u]),parseFloat(n[i][u])));a.push(o)}else a.push(e(parseFloat(r[i]),parseFloat(n[i])));return a}throw new Error("trying to do an element-wise operation on unequal sized arrays or something thats not an array!")}),t.register("scalarIterator",function(r,n){return n=n||pass,t.isArray(r)?r.map(function(r){return t.isArray(r)?r.map(function(r){return n(parseFloat(r))}):n(parseFloat(r))}):n(parseFloat(r))})}}),define("base",["underscore"],function(r){return function(t){r.without(Object.getOwnPropertyNames(Math),"round").forEach(function(r){t.register(r,Math[r])}),t.register("sum",function(n){return r.reduce(t.toFloat(n),function(r,t){return r+t},0)}),t.register("square",function(r){return parseFloat(r)*parseFloat(r)}),t.register("round",function(r,n){return n=n||0,t.scalarIterator(r,function(r){return parseFloat(new Number(r+"").toFixed(parseInt(n)))})})}}),define("converters",["underscore"],function(r){return function(t){t.register("unitConversionScale",function(t,n){var e={m:1,meter:1,cm:100,mm:1e3,um:1e6,nm:1e9,inch:39.37007874015748},a=r.keys(e);if(r.contains(a,n)&&r.contains(a,t))return parseFloat(e[n]/e[t]);throw new Error("no conversion for either "+t+" or "+n)}),t.register("toDegrees",function(r){return t.scalarIterator(r,function(r){return Math.abs(r)<=1e-10?0:180/Math.PI*r})}),t.register("toRadians",function(r){return t.scalarIterator(r,function(r){return Math.PI/180*r})}),t.register("toFloat",t.scalarIterator),t.register("parseAxisAngle",function(n,e){var a,i,o=function(){throw new Error("parse axis and angle input was not something we recognized")};return t.isArray(n)?4==n.length&&void 0===e?(a=n.slice(0,3),i=n[3]):3==n.length&&void 0!==e?(a=n,i=e):o():r.isObject(n)&&void 0===e?n.hasOwnProperty("axis")&&n.hasOwnProperty("angle")?(a=n.axis,i=n.angle):o():o(),{axis:t.toFloat(a),angle:t.toFloat(i)}}),t.register("quatFromAxisAngle",function(r,n){var e=t.parseAxisAngle(r,n),a=e.axis,i=e.angle,o=t.sum(a.map(t.square));if(1e-10>=o)return[1,0,0,0];var u=i/2,s=Math.sin(u)/Math.sqrt(o);return[Math.cos(u),a[0]*s,a[1]*s,a[2]*s]}),t.register("quatFromMatrix",function(r){var n=t.toFloat(r),e=n[0][0]+n[1][1]+n[2][2],a=[0,0,0,0];return e>=0?(a[0]=e+1,a[1]=n[2][1]-n[1][2],a[2]=n[0][2]-n[2][0],a[3]=n[1][0]-n[0][1]):n[1][1]>n[0][0]?n[2][2]>n[1][1]?(a[3]=n[2][2]-(n[0][0]+n[1][1])+1,a[1]=n[2][0]+n[0][2],a[2]=n[1][2]+n[2][1],a[0]=n[1][0]-n[0][1]):(a[2]=n[1][1]-(n[2][2]+n[0][0])+1,a[3]=n[1][2]+n[2][1],a[1]=n[0][1]+n[1][0],a[0]=n[0][2]-n[2][0]):n[2][2]>n[0][0]?(a[3]=n[2][2]-(n[0][0]+n[1][1])+1,a[1]=n[2][0]+n[0][2],a[2]=n[1][2]+n[2][1],a[0]=n[1][0]-n[0][1]):(a[1]=n[0][0]-(n[1][1]+n[2][2])+1,a[2]=n[0][1]+n[1][0],a[3]=n[2][0]+n[0][2],a[0]=n[2][1]-n[1][2]),t.divide(a,t.magnitude(a))}),t.register("matrixFromQuat",function(r){var n=t.toFloat(r),e=t.square(t.magnitude(n));if(1e-8>=e)return m.eye(4);var a=2/e,i=a*n[1]*n[1],o=a*n[2]*n[2],u=a*n[3]*n[3],s=t.eye(4);return s[0][0]=1-o-u,s[0][1]=a*(n[1]*n[2]-n[0]*n[3]),s[0][2]=a*(n[1]*n[3]+n[0]*n[2]),s[1][0]=a*(n[1]*n[2]+n[0]*n[3]),s[1][1]=1-i-u,s[1][2]=a*(n[2]*n[3]-n[0]*n[1]),s[2][0]=a*(n[1]*n[3]-n[0]*n[2]),s[2][1]=a*(n[2]*n[3]+n[0]*n[1]),s[2][2]=1-i-o,s}),t.register("matrixFromAxisAngle",t.rot),t.register("axisAngleFromQuat",function(r){var n=t.toFloat(r),e=t.sum(n.slice(1,4).map(t.square)),a={axis:[1,0,0],angle:0};if(0===e)return a;if(n[0]*n[0]+e<=1e-8)throw new Error("invalid quaternion "+n);var i;i=n[0]<0?[-n[0],-n[1],-n[2],-n[3]]:n,e=Math.sqrt(e);var o=1/e,u=2*Math.atan2(e,i[0]);return{axis:[i[1]*o,i[2]*o,i[3]*o],angle:u}}),t.register("axisAngleFromMatrix",function(r){return t.axisAngleFromQuat(t.quatFromMatrix(r))}),t.register("zxyFromMatrix",function(r){var n,e,a,i=t.matrix4to3(t.toFloat(r)),o=1e-10;if(Math.abs(i[2][0])<o&&Math.abs(i[2][2])<o){var u=i[2][1];n=u>0?Math.PI/2:-Math.PI/2,a=0,e=Math.atan2(u*i[1][0],i[0][0])}else{e=Math.atan2(-i[2][0],i[2][2]);var s=Math.sin(e),c=Math.cos(e),l=[[c,0,-s],[0,1,0],[s,0,c]],f=t.matrixMult(i,l);n=Math.atan2(f[2][1],f[2][2]),a=Math.atan2(f[1][0],f[0][0])}return t.toDegrees([n,e,a])}),t.register("zyxFromMatrix",function(r){var n,e,a,i=t.toFloat(r),o=1e-10;if(Math.abs(i[2][1])<o&&Math.abs(i[2][2])<o)if(e=i[2][0]<=0?Math.PI/2:-Math.PI/2,e>0){var u=Math.atan2(i[0][1],i[1][1]);n=u,a=0}else{var s=-Math.atan2(i[0][1],i[1][1]);n=s,a=0}else{n=Math.atan2(i[2][1],i[2][2]);var c=Math.sin(n),l=Math.cos(n),f=[[1,0,0],[0,l,c],[0,-c,l]],h=t.matrixMult(t.matrix4to3(i),f);e=Math.atan2(-h[2][0],h[2][2]),a=Math.atan2(-h[0][1],h[1][1])}return t.toDegrees([n,e,a])}),t.register("matrixFromZXY",function(r){var n=t.toRadians(parseFloat(r[0])),e=t.toRadians(parseFloat(r[1])),a=t.toRadians(parseFloat(r[2]));return[[-Math.sin(n)*Math.sin(e)*Math.sin(a)+Math.cos(e)*Math.cos(a),-Math.sin(a)*Math.cos(n),Math.sin(n)*Math.sin(a)*Math.cos(e)+Math.sin(e)*Math.cos(a)],[Math.sin(n)*Math.sin(e)*Math.cos(a)+Math.sin(a)*Math.cos(e),Math.cos(n)*Math.cos(a),-Math.sin(n)*Math.cos(e)*Math.cos(a)+Math.sin(e)*Math.sin(a)],[-Math.sin(e)*Math.cos(n),Math.sin(n),Math.cos(n)*Math.cos(e)]]}),t.register("matrixFromZYX",function(r){var n=t.toRadians(parseFloat(r[0])),e=t.toRadians(parseFloat(r[1])),a=t.toRadians(parseFloat(r[2]));return[[Math.cos(e)*Math.cos(a),-Math.cos(n)*Math.sin(a)+Math.cos(a)*Math.sin(n)*Math.sin(e),Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.sin(e)],[Math.cos(e)*Math.sin(a),Math.cos(n)*Math.cos(a)+Math.sin(n)*Math.sin(e)*Math.sin(a),-Math.cos(a)*Math.sin(n)+Math.cos(n)*Math.sin(e)*Math.sin(a)],[-Math.sin(e),Math.cos(e)*Math.sin(n),Math.cos(n)*Math.cos(e)]]}),t.register("zxyFromQuat",function(r){return t.zxyFromMatrix(t.matrixFromQuat(t.toFloat(r)))}),t.register("quatFromZXY",function(r){return t.quatFromMatrix(t.matrixFromZXY(t.toFloat(r)))}),t.register("zyxFromQuat",function(r){return t.zyxFromMatrix(t.matrixFromQuat(t.toFloat(r)))}),t.register("quatFromZYX",function(r){return t.quatFromMatrix(t.matrixFromZYX(t.toFloat(r)))}),t.register("matrix4to3",function(r){return[[r[0][0],r[0][1],r[0][2]],[r[1][0],r[1][1],r[1][2]],[r[2][0],r[2][1],r[2][2]]]}),t.register("matrix4",function(r){return 3==r[0].length&&(r[0].push(0),r[1].push(0),r[2].push(0)),3==r.length&&r.push([0,0,0,1]),r}),t.register("composeTransform",function(r,t){return[[r[0][0],r[0][1],r[0][2],t[0]],[r[1][0],r[1][1],r[1][2],t[1]],[r[2][0],r[2][1],r[2][2],t[2]],[0,0,0,1]]}),t.register("decomposeTransform",function(r){var t=[r[0][3],r[1][3],r[2][3]],n=[r[0].slice(0,3),r[1].slice(0,3),r[2].slice(0,3)];return{rotationMatrix:n,translation:t}}),t.register("mjsToMujin",function(r){var t=r;return[[t[0],t[4],t[8],t[12]],[t[1],t[5],t[9],t[13]],[t[2],t[6],t[10],t[14]],[t[3],t[7],t[11],t[15]]]})}}),define("matrix",["underscore"],function(){return function(r){r.register("add",function(t,n){return r.elementWiseIterator(t,n,function(r,t){return r+t})}),r.register("subtract",function(t,n){return r.elementWiseIterator(t,n,function(r,t){return r-t})}),r.register("eltMult",function(t,n){return r.elementWiseIterator(t,n,function(r,t){return r*t})}),r.register("scalarMult",function(t,n){return r.scalarIterator(t,function(r){return r*n})}),r.register("scalarDivide",function(t,n){return r.scalarIterator(t,function(r){return r/n})}),r.register("divide",r.scalarDivide),r.register("dot",function(t,n){return r.sum(r.eltMult(r.toFloat(t),r.toFloat(n)))}),r.register("cross",function(t,n){if(!r.isArray(t)||!r.isArray(n)||3!=t.length||3!=n.length)throw new Error("can't do a cross product with "+t+" and "+n);var e=r.toFloat(t),a=r.toFloat(n);return[e[1]*a[2]-e[2]*a[1],e[2]*a[0]-e[0]*a[2],e[0]*a[1]-e[1]*a[0]]}),r.register("eye",function(r,t){t=t||r;for(var n=[],e=0;t>e;e++){for(var a=[],i=0;r>i;i++)e==i?a.push(1):a.push(0);n.push(a)}return n}),r.register("identity",r.eye),r.register("zeros",function(r,t){t=t||r;for(var n=[],e=0;t>e;e++){for(var a=[],i=0;r>i;i++)a.push(0);n.push(a)}return n}),r.register("magnitude",function(t){return Math.sqrt(r.sum(r.toFloat(t).map(square)))}),r.register("norm",r.magnitude),r.register("normalize",function(t){var n=r.magnitude(t);if(0==n)throw new Error("Trying to normalize a zero array");return r.divide(t,n)}),r.register("rot",function(t,n){var e=r.parseAxisAngle(t,n),a=e.axis,i=e.angle,o=function(r){return[[0,-r[2],r[1]],[r[2],0,-r[0]],[-r[1],r[0],0]]};a=r.normalize(a);var u=r.eye(3);return u=r.add(u,r.scalarMult(o(a),Math.sin(i))),u=r.add(u,r.matrixMult(r.scalarMult(o(a),1-Math.cos(i)),o(a))),r.matrix4(u)}),r.register("translate",function(t){var n=r.eye(4);return n[0][3]=t[0],n[1][3]=t[1],n[2][3]=t[2],n}),r.register("transformLookat",function(t,n,e){lookat=r.toFloat(t),camerapos=r.toFloat(n),cameraup=r.toFloat(e);var a=r.subtract(r.toFloat(lookat),camerapos),i=r.norm(a);a=i>1e-15?r.scalarMult(a,1/i):[0,0,1];var o=r.subtract(cameraup,r.scalarMult(a,r.dot(a,cameraup)));i=r.norm(o),1e-8>i&&(o=[0,1,0],o=r.subtract(o,r.scalarMult(a,r.dot(a,o))),i=r.norm(o),1e-8>i&&(o=[1,0,0],o=r.subtract(o,r.scalarMult(a,r.dot(a,o))),i=r.norm(o))),o=r.scalarMult(o,1/i);var u=r.cross(o,a),s=r.eye(4);return s[0][0]=u[0],s[0][1]=o[0],s[0][2]=a[0],s[0][3]=camerapos[0],s[1][0]=u[1],s[1][1]=o[1],s[1][2]=a[1],s[1][3]=camerapos[1],s[2][0]=u[2],s[2][1]=o[2],s[2][2]=a[2],s[2][3]=camerapos[2],s}),r.register("matrixMult",function(t,n){var e=r.toFloat(t),a=r.toFloat(n);if(e[0].length!=e.length)throw r.prettyPrint(e),r.prettyPrint(a),new Error("incompatible array sizes!");for(var i=[],o=0;o<e.length;o++){for(var u=[],s=0;s<a[o].length;s++){for(var c=0,l=0;l<e[o].length;l++)c+=e[o][l]*a[l][s];u.push(c)}i.push(u)}return i}),r.register("matrixMultWithRow",function(t,n){for(var e=r.toFloat(t),a=r.toFloat(n),i=new Array(e.length),o=0;o<e.length;++o){i[o]=0;for(var u=0;u<a.length;++u)i[o]+=e[o][u]*a[u]}return i})}}),define("tween",["underscore"],function(){return function(r){r.register("linearlyInterpolate",function(r,t,n,e,a){return(t*(n-a)+e*(a-r))/(n-r)})}}),define("shrike",["underscore","./utils","./iterators","./base","./converters","./matrix","./tween"],function(r,t,n,e,a,i,o){var u={};return t(u),n(u),e(u),a(u),i(u),o(u),void 0!==window.makeGlobal&&(window.makeGlobal(u),window.makeGlobal({shrike:u})),u});