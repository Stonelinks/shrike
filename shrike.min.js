// shrike - v0.0.1
//
// https://github.com/Stonelinks/shrike
//
// yet another javascript math library
//
// Copyright (c)2014 - Lucas Doyle <lucas.p.doyle@gmail.com>
//
// Distributed under MIT license
//

define(["underscore","mjs"],function(a,b){"use strict";{var c={};b.FLOAT_ARRAY_TYPE}return c.throwError=function(a){throw a=a||"undefined error",new Error("SHRIKE: "+a)},c.isArray=function(b){return a.isArray(b)?!0:c.isFloatArray(b)},c.isFloatArray=function(b){try{return a.isArray(b)!==!0&&"Array]"==Object.prototype.toString.call(b).slice(-"Array]".length)}catch(c){return!1}},c.is2DArray=function(b){return c.isArray(b)?c.isFloatArray(b)?!1:0===b.length?!1:a.every(a.map(b,c.isArray)):!1},c.isNumber=function(a){return!isNaN(parseFloat(a))&&isFinite(a)&&!c.isArray(a)},c.prettyPrint=function(a){console.log(function(){if(c.isArray(a)){if(c.is2DArray(a)){for(var b=6,d=0,e=0;e<a.length;e++)for(var f=0;f<a[e].length;f++)c.round(a[e][f],b).toString().length>d&&(d=c.round(a[e][f],b).toString().length);for(var g=[],h=void 0,e=0;e<a.length;e++){for(var i=[],f=0;f<a[e].length;f++){for(var j=c.round(a[e][f],b).toString(),k=d-j.length,l="",m="",n=0;k>n;n++)n>=k/2?l+=" ":m+=" ";i.push(l+j+m)}if(g.push(i),void 0===h){for(var o=[],p="",n=0;d>n;n++)p+="-";for(var n=0;n<i.length;n++)o.push(p);h="+-"+o.join("-+-")+"-+"}}for(var q=h+"\n",e=0;e<a.length;e++){var i=g[e],r="| "+i.join(" | ")+" |";q+=r+"\n",q+=h+"\n"}return q}var q="[ "+new Array(a).join(", ")+" ]";return q}return a}())},window.pp=c.prettyPrint,c.scalarIterator=function(b,d){if(d=d||pass,c.is2DArray(b))return a.map(b,function(b){return a.map(b,d)});if(c.isArray(b)){if(c.isFloatArray(b)){for(var e=new c.FLOAT_ARRAY_TYPE(b.length),f=0;f<b.length;f++)e[f]=d(b[f]);return e}return a.map(b,d)}return d(b)},a.without(Object.getOwnPropertyNames(Math),"round").forEach(function(a){c[a]=Math[a]}),Object.getOwnPropertyNames(b).forEach(function(a){c[a]=b[a]}),c.M4=c.M4x4,c.sum=function(b){return a.reduce(c.toFloat(b),function(a,b){return c.isNumber(b)||c.throwError("can't compute sum of array with non numeric element: "+b),a+b},0)},c.square=function(a){return parseFloat(a)*parseFloat(a)},c.round=function(a,b){return void 0===b&&(b=0),parseFloat(new Number(a+"").toFixed(parseInt(b)))},c.roundArray=function(a,b){return c.throwError(c.isArray(a),"roundArray: not an array"),c.scalarIterator(a,function(a){return c.round(a,b)})},c.toFloat=function(b){if(c.isNumber(b))return parseFloat(b);if(c.isFloatArray(b))return b;if(c.isArray(b)){var d=function(a){return parseFloat(a)};return c.is2DArray(b)?a.map(b,function(b){return a.map(b,d)}):a.map(b,d)}c.throwError("toFloat: can not convert to float: "+b)},c.unitConversionScale=function(b,c){{var d={m:1,meter:1,cm:100,mm:1e3,um:1e6,nm:1e9,inch:39.37007874015748,"in":39.37007874015748};a.keys(d)}return parseFloat(d[c]/d[b])},c.toDegrees=function(a){var b=function(a){return c.abs(a)<=1e-10?0:180/c.PI*a};return c.isNumber(a)?b(a):c.scalarIterator(a,b)},c.toRadians=function(a){var b=function(a){return c.PI/180*a};return c.isNumber(a)?b(a):c.scalarIterator(a,b)},c.parseAxisAngle=function(b,d){var e,f,g=function(){c.throwError("parseAxisAngle: arguments were not something we recognized")};return c.isArray(b)?4==b.length&&void 0===d?(e=b.slice(0,3),f=b[3]):3==b.length&&void 0!==d?(e=b,f=d):g():a.isObject(b)&&void 0===d?b.hasOwnProperty("axis")&&b.hasOwnProperty("angle")?(e=b.axis,f=b.angle):g():g(),{axis:c.toFloat(e),angle:c.toFloat(f)}},c.quatFromAxisAngle=function(b,d){var e=c.parseAxisAngle(b,d),f=e.axis,g=e.angle,h=c.sum(a.map(f,c.square));if(1e-10>=h)return[1,0,0,0];var i=g/2,j=Math.sin(i)/Math.sqrt(h);return[Math.cos(i),f[0]*j,f[1]*j,f[2]*j]},c.quatFromMatrix=function(a){var b=c.toFloat(a),d=b[0][0]+b[1][1]+b[2][2],e=[0,0,0,0];return d>=0?(e[0]=d+1,e[1]=b[2][1]-b[1][2],e[2]=b[0][2]-b[2][0],e[3]=b[1][0]-b[0][1]):b[1][1]>b[0][0]?b[2][2]>b[1][1]?(e[3]=b[2][2]-(b[0][0]+b[1][1])+1,e[1]=b[2][0]+b[0][2],e[2]=b[1][2]+b[2][1],e[0]=b[1][0]-b[0][1]):(e[2]=b[1][1]-(b[2][2]+b[0][0])+1,e[3]=b[1][2]+b[2][1],e[1]=b[0][1]+b[1][0],e[0]=b[0][2]-b[2][0]):b[2][2]>b[0][0]?(e[3]=b[2][2]-(b[0][0]+b[1][1])+1,e[1]=b[2][0]+b[0][2],e[2]=b[1][2]+b[2][1],e[0]=b[1][0]-b[0][1]):(e[1]=b[0][0]-(b[1][1]+b[2][2])+1,e[2]=b[0][1]+b[1][0],e[3]=b[2][0]+b[0][2],e[0]=b[2][1]-b[1][2]),c.divide(e,c.magnitude(e))},c.matrixFromQuat=function(a){var b=c.toFloat(a),d=c.square(c.magnitude(b));if(1e-8>=d)return m.eye(4);var e=2/d,f=e*b[1]*b[1],g=e*b[2]*b[2],h=e*b[3]*b[3],i=c.eye(4);return i[0][0]=1-g-h,i[0][1]=e*(b[1]*b[2]-b[0]*b[3]),i[0][2]=e*(b[1]*b[3]+b[0]*b[2]),i[1][0]=e*(b[1]*b[2]+b[0]*b[3]),i[1][1]=1-f-h,i[1][2]=e*(b[2]*b[3]-b[0]*b[1]),i[2][0]=e*(b[1]*b[3]-b[0]*b[2]),i[2][1]=e*(b[2]*b[3]+b[0]*b[1]),i[2][2]=1-f-g,i},c.axisAngleFromQuat=function(b){var d=c.toFloat(b),e=c.sum(a.map(d.slice(1,4),c.square)),f={axis:[1,0,0],angle:0};if(0===e)return f;d[0]*d[0]+e<=1e-8&&c.throwError("invalid quaternion "+d);var g;g=d[0]<0?[-d[0],-d[1],-d[2],-d[3]]:d,e=Math.sqrt(e);var h=1/e,i=2*Math.atan2(e,g[0]);return{axis:[g[1]*h,g[2]*h,g[3]*h],angle:i}},c.axisAngleFromMatrix=function(a){return c.axisAngleFromQuat(c.quatFromMatrix(a))},c.zxyFromMatrix=function(a){var b,d,e,f=c.matrix4to3(c.toFloat(a)),g=1e-10;if(Math.abs(f[2][0])<g&&Math.abs(f[2][2])<g){var h=f[2][1];b=h>0?Math.PI/2:-Math.PI/2,e=0,d=Math.atan2(h*f[1][0],f[0][0])}else{d=Math.atan2(-f[2][0],f[2][2]);var i=Math.sin(d),j=Math.cos(d),k=[[j,0,-i],[0,1,0],[i,0,j]],l=c.matrixMult(f,k);b=Math.atan2(l[2][1],l[2][2]),e=Math.atan2(l[1][0],l[0][0])}return c.toDegrees([b,d,e])},c.zyxFromMatrix=function(a){var b,d,e,f=c.toFloat(a),g=1e-10;if(Math.abs(f[2][1])<g&&Math.abs(f[2][2])<g)if(d=f[2][0]<=0?Math.PI/2:-Math.PI/2,d>0){var h=Math.atan2(f[0][1],f[1][1]);b=h,e=0}else{var i=-Math.atan2(f[0][1],f[1][1]);b=i,e=0}else{b=Math.atan2(f[2][1],f[2][2]);var j=Math.sin(b),k=Math.cos(b),l=[[1,0,0],[0,k,j],[0,-j,k]],m=c.matrixMult(c.matrix4to3(f),l);d=Math.atan2(-m[2][0],m[2][2]),e=Math.atan2(-m[0][1],m[1][1])}return c.toDegrees([b,d,e])},c.matrixFromZXY=function(a){var b=c.toRadians(parseFloat(a[0])),d=c.toRadians(parseFloat(a[1])),e=c.toRadians(parseFloat(a[2]));return[[-Math.sin(b)*Math.sin(d)*Math.sin(e)+Math.cos(d)*Math.cos(e),-Math.sin(e)*Math.cos(b),Math.sin(b)*Math.sin(e)*Math.cos(d)+Math.sin(d)*Math.cos(e)],[Math.sin(b)*Math.sin(d)*Math.cos(e)+Math.sin(e)*Math.cos(d),Math.cos(b)*Math.cos(e),-Math.sin(b)*Math.cos(d)*Math.cos(e)+Math.sin(d)*Math.sin(e)],[-Math.sin(d)*Math.cos(b),Math.sin(b),Math.cos(b)*Math.cos(d)]]},c.matrixFromZYX=function(a){var b=c.toRadians(parseFloat(a[0])),d=c.toRadians(parseFloat(a[1])),e=c.toRadians(parseFloat(a[2]));return[[Math.cos(d)*Math.cos(e),-Math.cos(b)*Math.sin(e)+Math.cos(e)*Math.sin(b)*Math.sin(d),Math.sin(b)*Math.sin(e)+Math.cos(b)*Math.cos(e)*Math.sin(d)],[Math.cos(d)*Math.sin(e),Math.cos(b)*Math.cos(e)+Math.sin(b)*Math.sin(d)*Math.sin(e),-Math.cos(e)*Math.sin(b)+Math.cos(b)*Math.sin(d)*Math.sin(e)],[-Math.sin(d),Math.cos(d)*Math.sin(b),Math.cos(b)*Math.cos(d)]]},c.zxyFromQuat=function(a){return c.zxyFromMatrix(c.matrixFromQuat(c.toFloat(a)))},c.quatFromZXY=function(a){return c.quatFromMatrix(c.matrixFromZXY(c.toFloat(a)))},c.zyxFromQuat=function(a){return c.zyxFromMatrix(c.matrixFromQuat(c.toFloat(a)))},c.quatFromZYX=function(a){return c.quatFromMatrix(c.matrixFromZYX(c.toFloat(a)))},c.matrix4to3=function(a){return[[a[0][0],a[0][1],a[0][2]],[a[1][0],a[1][1],a[1][2]],[a[2][0],a[2][1],a[2][2]]]},c.composeTransformArray=function(a,b){return[[a[0][0],a[0][1],a[0][2],b[0]],[a[1][0],a[1][1],a[1][2],b[1]],[a[2][0],a[2][1],a[2][2],b[2]],[0,0,0,1]]},c.decomposeTransformArray=function(a){return{rotationMatrix:[a[0].slice(0,3),a[1].slice(0,3),a[2].slice(0,3)],translation:[a[0][3],a[1][3],a[2][3]]}},c.M4toTransformArray=function(a){return[[a[0],a[4],a[8],a[12]],[a[1],a[5],a[9],a[13]],[a[2],a[6],a[10],a[14]],[a[3],a[7],a[11],a[15]]]},c.transformArrayToM4=function(a){return[a[0][0],a[1][0],a[2][0],a[3][0],a[0][1],a[1][1],a[2][1],a[3][1],a[0][2],a[1][2],a[2][2],a[3][2],a[0][3],a[1][3],a[2][3],a[3][3]]},c.divide=function(a,b){return c.scalarIterator(c.toFloat(a),function(a){return a/parseFloat(b)})},c.eye=function(a,b){b=b||a;for(var c=[],d=0;b>d;d++){for(var e=[],f=0;a>f;f++)e.push(d==f?1:0);c.push(e)}return c},c.magnitude=function(b){return c.sqrt(c.isFloatArray(b)?b[0]*b[0]+b[1]*b[1]+b[2]*b[2]:c.sum(a.map(c.toFloat(b),c.square)))},c.norm=c.magnitude,c.normalize=function(a){var b=c.magnitude(a);return c.divide(a,b)},c.matrixMult=function(a,b){for(var d=c.toFloat(a),e=c.toFloat(b),f=[],g=0;g<d.length;g++){for(var h=[],i=0;i<e[g].length;i++){for(var j=0,k=0;k<d[g].length;k++)j+=d[g][k]*e[k][i];h.push(j)}f.push(h)}return f},c.V3.objectToArray=function(a){return["x","y","z"].map(function(b){return a[b]})},c.V3.arrayToObject=function(b){var d=c.toFloat(b);return a.object(["x","y","z"],d)},c.M4.matrixFromQuat=function(b){var d=c.toFloat(b),e=c.M4.clone(c.M4.I),f=c.sum(a.map(d,c.square));if(1e-8>=f)return e;var g=2/f,h=g*d[1]*d[1],i=g*d[2]*d[2],j=g*d[3]*d[3];return e[0]=1-i-j,e[1]=g*(d[1]*d[2]+d[0]*d[3]),e[2]=g*(d[1]*d[3]-d[0]*d[2]),e[4]=g*(d[1]*d[2]-d[0]*d[3]),e[5]=1-h-j,e[6]=g*(d[2]*d[3]+d[0]*d[1]),e[8]=g*(d[1]*d[3]+d[0]*d[2]),e[9]=g*(d[2]*d[3]-d[0]*d[1]),e[10]=1-h-i,e},c.M4.quatFromMatrix=function(a){var b=c.toFloat(a),d=b[0],e=b[1],f=b[2],g=b[4],h=b[5],i=b[6],j=b[8],k=b[9],l=b[10],m=d+h+l,n=[0,0,0,0];return m>=0?(n[0]=m+1,n[1]=i-k,n[2]=j-f,n[3]=e-g):h>d?l>h?(n[3]=l-(d+h)+1,n[1]=f+j,n[2]=k+i,n[0]=e-g):(n[2]=h-(l+d)+1,n[3]=k+i,n[1]=g+e,n[0]=j-f):l>d?(n[3]=l-(d+h)+1,n[1]=f+j,n[2]=k+i,n[0]=e-g):(n[1]=d-(h+l)+1,n[2]=g+e,n[3]=f+j,n[0]=i-k),c.divide(n,c.magnitude(n))},c.M4.transFromMatrix=function(a){var b=new Array(3);return b[0]=a[12],b[1]=a[13],b[2]=a[14],b},c.M4.composeFromQuatTrans=function(a,b){var d=c.M4.matrixFromQuat(a),e=c.toFloat(b);return d[12]=e[0],d[13]=e[1],d[14]=e[2],d},c.linearlyInterpolate=function(a,b,c,d,e){return(b*(c-e)+d*(e-a))/(c-a)},void 0!==window.makeGlobal&&(window.makeGlobal(c),window.makeGlobal({math:c,shrike:c})),c});