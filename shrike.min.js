(function(){var r=this,t=r._,n={},e=Array.prototype,a=Object.prototype,i=Function.prototype,o=e.push,u=e.slice,s=e.concat,c=a.toString,l=a.hasOwnProperty,f=e.forEach,h=e.map,p=e.reduce,g=e.reduceRight,m=e.filter,v=e.every,d=e.some,y=e.indexOf,M=e.lastIndexOf,w=Array.isArray,x=Object.keys,F=i.bind,A=function(r){return r instanceof A?r:this instanceof A?(this._wrapped=r,void 0):new A(r)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=A),exports._=A):r._=A,A.VERSION="1.6.0";var b=A.each=A.forEach=function(r,t,e){if(null==r)return r;if(f&&r.forEach===f)r.forEach(t,e);else if(r.length===+r.length){for(var a=0,i=r.length;i>a;a++)if(t.call(e,r[a],a,r)===n)return}else for(var o=A.keys(r),a=0,i=o.length;i>a;a++)if(t.call(e,r[o[a]],o[a],r)===n)return;return r};A.map=A.collect=function(r,t,n){var e=[];return null==r?e:h&&r.map===h?r.map(t,n):(b(r,function(r,a,i){e.push(t.call(n,r,a,i))}),e)};var j="Reduce of empty array with no initial value";A.reduce=A.foldl=A.inject=function(r,t,n,e){var a=arguments.length>2;if(null==r&&(r=[]),p&&r.reduce===p)return e&&(t=A.bind(t,e)),a?r.reduce(t,n):r.reduce(t);if(b(r,function(r,i,o){a?n=t.call(e,n,r,i,o):(n=r,a=!0)}),!a)throw new TypeError(j);return n},A.reduceRight=A.foldr=function(r,t,n,e){var a=arguments.length>2;if(null==r&&(r=[]),g&&r.reduceRight===g)return e&&(t=A.bind(t,e)),a?r.reduceRight(t,n):r.reduceRight(t);var i=r.length;if(i!==+i){var o=A.keys(r);i=o.length}if(b(r,function(u,s,c){s=o?o[--i]:--i,a?n=t.call(e,n,r[s],s,c):(n=r[s],a=!0)}),!a)throw new TypeError(j);return n},A.find=A.detect=function(r,t,n){var e;return E(r,function(r,a,i){return t.call(n,r,a,i)?(e=r,!0):void 0}),e},A.filter=A.select=function(r,t,n){var e=[];return null==r?e:m&&r.filter===m?r.filter(t,n):(b(r,function(r,a,i){t.call(n,r,a,i)&&e.push(r)}),e)},A.reject=function(r,t,n){return A.filter(r,function(r,e,a){return!t.call(n,r,e,a)},n)},A.every=A.all=function(r,t,e){t||(t=A.identity);var a=!0;return null==r?a:v&&r.every===v?r.every(t,e):(b(r,function(r,i,o){return(a=a&&t.call(e,r,i,o))?void 0:n}),!!a)};var E=A.some=A.any=function(r,t,e){t||(t=A.identity);var a=!1;return null==r?a:d&&r.some===d?r.some(t,e):(b(r,function(r,i,o){return a||(a=t.call(e,r,i,o))?n:void 0}),!!a)};A.contains=A.include=function(r,t){return null==r?!1:y&&r.indexOf===y?-1!=r.indexOf(t):E(r,function(r){return r===t})},A.invoke=function(r,t){var n=u.call(arguments,2),e=A.isFunction(t);return A.map(r,function(r){return(e?t:r[t]).apply(r,n)})},A.pluck=function(r,t){return A.map(r,A.property(t))},A.where=function(r,t){return A.filter(r,A.matches(t))},A.findWhere=function(r,t){return A.find(r,A.matches(t))},A.max=function(r,t,n){if(!t&&A.isArray(r)&&r[0]===+r[0]&&r.length<65535)return Math.max.apply(Math,r);var e=-1/0,a=-1/0;return b(r,function(r,i,o){var u=t?t.call(n,r,i,o):r;u>a&&(e=r,a=u)}),e},A.min=function(r,t,n){if(!t&&A.isArray(r)&&r[0]===+r[0]&&r.length<65535)return Math.min.apply(Math,r);var e=1/0,a=1/0;return b(r,function(r,i,o){var u=t?t.call(n,r,i,o):r;a>u&&(e=r,a=u)}),e},A.shuffle=function(r){var t,n=0,e=[];return b(r,function(r){t=A.random(n++),e[n-1]=e[t],e[t]=r}),e},A.sample=function(r,t,n){return null==t||n?(r.length!==+r.length&&(r=A.values(r)),r[A.random(r.length-1)]):A.shuffle(r).slice(0,Math.max(0,t))};var _=function(r){return null==r?A.identity:A.isFunction(r)?r:A.property(r)};A.sortBy=function(r,t,n){return t=_(t),A.pluck(A.map(r,function(r,e,a){return{value:r,index:e,criteria:t.call(n,r,e,a)}}).sort(function(r,t){var n=r.criteria,e=t.criteria;if(n!==e){if(n>e||void 0===n)return 1;if(e>n||void 0===e)return-1}return r.index-t.index}),"value")};var I=function(r){return function(t,n,e){var a={};return n=_(n),b(t,function(i,o){var u=n.call(e,i,o,t);r(a,u,i)}),a}};A.groupBy=I(function(r,t,n){A.has(r,t)?r[t].push(n):r[t]=[n]}),A.indexBy=I(function(r,t,n){r[t]=n}),A.countBy=I(function(r,t){A.has(r,t)?r[t]++:r[t]=1}),A.sortedIndex=function(r,t,n,e){n=_(n);for(var a=n.call(e,t),i=0,o=r.length;o>i;){var u=i+o>>>1;n.call(e,r[u])<a?i=u+1:o=u}return i},A.toArray=function(r){return r?A.isArray(r)?u.call(r):r.length===+r.length?A.map(r,A.identity):A.values(r):[]},A.size=function(r){return null==r?0:r.length===+r.length?r.length:A.keys(r).length},A.first=A.head=A.take=function(r,t,n){return null==r?void 0:null==t||n?r[0]:0>t?[]:u.call(r,0,t)},A.initial=function(r,t,n){return u.call(r,0,r.length-(null==t||n?1:t))},A.last=function(r,t,n){return null==r?void 0:null==t||n?r[r.length-1]:u.call(r,Math.max(r.length-t,0))},A.rest=A.tail=A.drop=function(r,t,n){return u.call(r,null==t||n?1:t)},A.compact=function(r){return A.filter(r,A.identity)};var k=function(r,t,n){return t&&A.every(r,A.isArray)?s.apply(n,r):(b(r,function(r){A.isArray(r)||A.isArguments(r)?t?o.apply(n,r):k(r,t,n):n.push(r)}),n)};A.flatten=function(r,t){return k(r,t,[])},A.without=function(r){return A.difference(r,u.call(arguments,1))},A.partition=function(r,t){var n=[],e=[];return b(r,function(r){(t(r)?n:e).push(r)}),[n,e]},A.uniq=A.unique=function(r,t,n,e){A.isFunction(t)&&(e=n,n=t,t=!1);var a=n?A.map(r,n,e):r,i=[],o=[];return b(a,function(n,e){(t?e&&o[o.length-1]===n:A.contains(o,n))||(o.push(n),i.push(r[e]))}),i},A.union=function(){return A.uniq(A.flatten(arguments,!0))},A.intersection=function(r){var t=u.call(arguments,1);return A.filter(A.uniq(r),function(r){return A.every(t,function(t){return A.contains(t,r)})})},A.difference=function(r){var t=s.apply(e,u.call(arguments,1));return A.filter(r,function(r){return!A.contains(t,r)})},A.zip=function(){for(var r=A.max(A.pluck(arguments,"length").concat(0)),t=new Array(r),n=0;r>n;n++)t[n]=A.pluck(arguments,""+n);return t},A.object=function(r,t){if(null==r)return{};for(var n={},e=0,a=r.length;a>e;e++)t?n[r[e]]=t[e]:n[r[e][0]]=r[e][1];return n},A.indexOf=function(r,t,n){if(null==r)return-1;var e=0,a=r.length;if(n){if("number"!=typeof n)return e=A.sortedIndex(r,t),r[e]===t?e:-1;e=0>n?Math.max(0,a+n):n}if(y&&r.indexOf===y)return r.indexOf(t,n);for(;a>e;e++)if(r[e]===t)return e;return-1},A.lastIndexOf=function(r,t,n){if(null==r)return-1;var e=null!=n;if(M&&r.lastIndexOf===M)return e?r.lastIndexOf(t,n):r.lastIndexOf(t);for(var a=e?n:r.length;a--;)if(r[a]===t)return a;return-1},A.range=function(r,t,n){arguments.length<=1&&(t=r||0,r=0),n=arguments[2]||1;for(var e=Math.max(Math.ceil((t-r)/n),0),a=0,i=new Array(e);e>a;)i[a++]=r,r+=n;return i};var O=function(){};A.bind=function(r,t){var n,e;if(F&&r.bind===F)return F.apply(r,u.call(arguments,1));if(!A.isFunction(r))throw new TypeError;return n=u.call(arguments,2),e=function(){if(!(this instanceof e))return r.apply(t,n.concat(u.call(arguments)));O.prototype=r.prototype;var a=new O;O.prototype=null;var i=r.apply(a,n.concat(u.call(arguments)));return Object(i)===i?i:a}},A.partial=function(r){var t=u.call(arguments,1);return function(){for(var n=0,e=t.slice(),a=0,i=e.length;i>a;a++)e[a]===A&&(e[a]=arguments[n++]);for(;n<arguments.length;)e.push(arguments[n++]);return r.apply(this,e)}},A.bindAll=function(r){var t=u.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return b(t,function(t){r[t]=A.bind(r[t],r)}),r},A.memoize=function(r,t){var n={};return t||(t=A.identity),function(){var e=t.apply(this,arguments);return A.has(n,e)?n[e]:n[e]=r.apply(this,arguments)}},A.delay=function(r,t){var n=u.call(arguments,2);return setTimeout(function(){return r.apply(null,n)},t)},A.defer=function(r){return A.delay.apply(A,[r,1].concat(u.call(arguments,1)))},A.throttle=function(r,t,n){var e,a,i,o=null,u=0;n||(n={});var s=function(){u=n.leading===!1?0:A.now(),o=null,i=r.apply(e,a),e=a=null};return function(){var c=A.now();u||n.leading!==!1||(u=c);var l=t-(c-u);return e=this,a=arguments,0>=l?(clearTimeout(o),o=null,u=c,i=r.apply(e,a),e=a=null):o||n.trailing===!1||(o=setTimeout(s,l)),i}},A.debounce=function(r,t,n){var e,a,i,o,u,s=function(){var c=A.now()-o;t>c?e=setTimeout(s,t-c):(e=null,n||(u=r.apply(i,a),i=a=null))};return function(){i=this,a=arguments,o=A.now();var c=n&&!e;return e||(e=setTimeout(s,t)),c&&(u=r.apply(i,a),i=a=null),u}},A.once=function(r){var t,n=!1;return function(){return n?t:(n=!0,t=r.apply(this,arguments),r=null,t)}},A.wrap=function(r,t){return A.partial(t,r)},A.compose=function(){var r=arguments;return function(){for(var t=arguments,n=r.length-1;n>=0;n--)t=[r[n].apply(this,t)];return t[0]}},A.after=function(r,t){return function(){return--r<1?t.apply(this,arguments):void 0}},A.keys=function(r){if(!A.isObject(r))return[];if(x)return x(r);var t=[];for(var n in r)A.has(r,n)&&t.push(n);return t},A.values=function(r){for(var t=A.keys(r),n=t.length,e=new Array(n),a=0;n>a;a++)e[a]=r[t[a]];return e},A.pairs=function(r){for(var t=A.keys(r),n=t.length,e=new Array(n),a=0;n>a;a++)e[a]=[t[a],r[t[a]]];return e},A.invert=function(r){for(var t={},n=A.keys(r),e=0,a=n.length;a>e;e++)t[r[n[e]]]=n[e];return t},A.functions=A.methods=function(r){var t=[];for(var n in r)A.isFunction(r[n])&&t.push(n);return t.sort()},A.extend=function(r){return b(u.call(arguments,1),function(t){if(t)for(var n in t)r[n]=t[n]}),r},A.pick=function(r){var t={},n=s.apply(e,u.call(arguments,1));return b(n,function(n){n in r&&(t[n]=r[n])}),t},A.omit=function(r){var t={},n=s.apply(e,u.call(arguments,1));for(var a in r)A.contains(n,a)||(t[a]=r[a]);return t},A.defaults=function(r){return b(u.call(arguments,1),function(t){if(t)for(var n in t)void 0===r[n]&&(r[n]=t[n])}),r},A.clone=function(r){return A.isObject(r)?A.isArray(r)?r.slice():A.extend({},r):r},A.tap=function(r,t){return t(r),r};var q=function(r,t,n,e){if(r===t)return 0!==r||1/r==1/t;if(null==r||null==t)return r===t;r instanceof A&&(r=r._wrapped),t instanceof A&&(t=t._wrapped);var a=c.call(r);if(a!=c.call(t))return!1;switch(a){case"[object String]":return r==String(t);case"[object Number]":return r!=+r?t!=+t:0==r?1/r==1/t:r==+t;case"[object Date]":case"[object Boolean]":return+r==+t;case"[object RegExp]":return r.source==t.source&&r.global==t.global&&r.multiline==t.multiline&&r.ignoreCase==t.ignoreCase}if("object"!=typeof r||"object"!=typeof t)return!1;for(var i=n.length;i--;)if(n[i]==r)return e[i]==t;var o=r.constructor,u=t.constructor;if(o!==u&&!(A.isFunction(o)&&o instanceof o&&A.isFunction(u)&&u instanceof u)&&"constructor"in r&&"constructor"in t)return!1;n.push(r),e.push(t);var s=0,l=!0;if("[object Array]"==a){if(s=r.length,l=s==t.length)for(;s--&&(l=q(r[s],t[s],n,e)););}else{for(var f in r)if(A.has(r,f)&&(s++,!(l=A.has(t,f)&&q(r[f],t[f],n,e))))break;if(l){for(f in t)if(A.has(t,f)&&!s--)break;l=!s}}return n.pop(),e.pop(),l};A.isEqual=function(r,t){return q(r,t,[],[])},A.isEmpty=function(r){if(null==r)return!0;if(A.isArray(r)||A.isString(r))return 0===r.length;for(var t in r)if(A.has(r,t))return!1;return!0},A.isElement=function(r){return!(!r||1!==r.nodeType)},A.isArray=w||function(r){return"[object Array]"==c.call(r)},A.isObject=function(r){return r===Object(r)},b(["Arguments","Function","String","Number","Date","RegExp"],function(r){A["is"+r]=function(t){return c.call(t)=="[object "+r+"]"}}),A.isArguments(arguments)||(A.isArguments=function(r){return!(!r||!A.has(r,"callee"))}),"function"!=typeof/./&&(A.isFunction=function(r){return"function"==typeof r}),A.isFinite=function(r){return isFinite(r)&&!isNaN(parseFloat(r))},A.isNaN=function(r){return A.isNumber(r)&&r!=+r},A.isBoolean=function(r){return r===!0||r===!1||"[object Boolean]"==c.call(r)},A.isNull=function(r){return null===r},A.isUndefined=function(r){return void 0===r},A.has=function(r,t){return l.call(r,t)},A.noConflict=function(){return r._=t,this},A.identity=function(r){return r},A.constant=function(r){return function(){return r}},A.property=function(r){return function(t){return t[r]}},A.matches=function(r){return function(t){if(t===r)return!0;for(var n in r)if(r[n]!==t[n])return!1;return!0}},A.times=function(r,t,n){for(var e=Array(Math.max(0,r)),a=0;r>a;a++)e[a]=t.call(n,a);return e},A.random=function(r,t){return null==t&&(t=r,r=0),r+Math.floor(Math.random()*(t-r+1))},A.now=Date.now||function(){return(new Date).getTime()};var N={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};N.unescape=A.invert(N.escape);var R={escape:new RegExp("["+A.keys(N.escape).join("")+"]","g"),unescape:new RegExp("("+A.keys(N.unescape).join("|")+")","g")};A.each(["escape","unescape"],function(r){A[r]=function(t){return null==t?"":(""+t).replace(R[r],function(t){return N[r][t]})}}),A.result=function(r,t){if(null==r)return void 0;var n=r[t];return A.isFunction(n)?n.call(r):n},A.mixin=function(r){b(A.functions(r),function(t){var n=A[t]=r[t];A.prototype[t]=function(){var r=[this._wrapped];return o.apply(r,arguments),T.call(this,n.apply(A,r))}})};var z=0;A.uniqueId=function(r){var t=++z+"";return r?r+t:t},A.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var S=/(.)^/,D={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},P=/\\|'|\r|\n|\t|\u2028|\u2029/g;A.template=function(r,t,n){var e;n=A.defaults({},n,A.templateSettings);var a=new RegExp([(n.escape||S).source,(n.interpolate||S).source,(n.evaluate||S).source].join("|")+"|$","g"),i=0,o="__p+='";r.replace(a,function(t,n,e,a,u){return o+=r.slice(i,u).replace(P,function(r){return"\\"+D[r]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),e&&(o+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),a&&(o+="';\n"+a+"\n__p+='"),i=u+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{e=new Function(n.variable||"obj","_",o)}catch(u){throw u.source=o,u}if(t)return e(t,A);var s=function(r){return e.call(this,r,A)};return s.source="function("+(n.variable||"obj")+"){\n"+o+"}",s},A.chain=function(r){return A(r).chain()};var T=function(r){return this._chain?A(r).chain():r};A.mixin(A),b(["pop","push","reverse","shift","sort","splice","unshift"],function(r){var t=e[r];A.prototype[r]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=r&&"splice"!=r||0!==n.length||delete n[0],T.call(this,n)}}),b(["concat","join","slice"],function(r){var t=e[r];A.prototype[r]=function(){return T.call(this,t.apply(this._wrapped,arguments))}}),A.extend(A.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return A})}).call(this),define("utils",["underscore"],function(r){return window.pass=window.pass||function(){},function(t){t.throwError=function(r){throw r=r||"undefined error",new Error("SHRIKE: "+r)},t.register=function(r,n){t.hasOwnProperty(r)?t.throwError("shrike already has a "+r):t[r]=n},t.alias=function(r,n){t.hasOwnProperty(n)||t.throwError("shrike doesn't have a "+n+" to alias"),t.register(r,t[n])},t.register("isArray",function(n){return r.isArray(n)?!0:t.isNativeFloatArray(n)}),t.register("isNativeFloatArray",function(t){try{return r.isArray(t)!==!0&&"Array]"==Object.prototype.toString.call(t).slice(-"Array]".length)}catch(n){return!1}}),t.register("is2DArray",function(n){return t.isArray(n)?t.isNativeFloatArray(n)?!1:0===n.length?!1:r.some(n.map(t.isArray)):!1}),t.register("isNumber",function(r){return!isNaN(parseFloat(r))&&isFinite(r)&&!t.isArray(r)}),t.register("prettyPrint",function(n){console.log(function(){if(r.isArray(n)){if(r.isArray(n[0])){for(var e=6,a=0,i=0;i<n.length;i++)for(var o=0;o<n[i].length;o++){if("string"==typeof n[i][o])throw new Error("WARNING: there is a string in this matrix, you should fix that");t.round(n[i][o],e).toString().length>a&&(a=t.round(n[i][o],e).toString().length)}for(var u=[],s=void 0,i=0;i<n.length;i++){for(var c=[],o=0;o<n[i].length;o++){for(var l=t.round(n[i][o],e).toString(),f=a-l.length,h="",p="",g=0;f>g;g++)g>=f/2?h+=" ":p+=" ";c.push(h+l+p)}if(u.push(c),void 0===s){for(var m=[],v="",g=0;a>g;g++)v+="-";for(var g=0;g<c.length;g++)m.push(v);s="+-"+m.join("-+-")+"-+"}}for(var d=s+"\n",i=0;i<n.length;i++){var c=u[i],y="| "+c.join(" | ")+" |";d+=y+"\n",d+=s+"\n"}return d}var d="[ "+n.join(", ")+" ]";return d}return n}())})}}),define("iterators",["underscore"],function(){return function(r){r.register("elementWiseIterator",function(t,n,e){e=e||pass,r.isArray(t)&&r.isArray(n)||(console.warn("elementWiseIterator: one of these is not an array: %o and %o",t,n),r.throwError()),t.length!==n.length&&r.throwError("elementWiseIterator: trying to do an element-wise operation on unequal sized arrays");var a=!1;r.is2DArray(t)&&(r.is2DArray(n)?a=!0:(console.warn("elementWiseIterator: one of these is a 2d array and the other is not: %o and %o",t,n),r.throwError()));for(var i=[],o=0;o<t.length;o++)if(a){t[o].length!==n[o].length&&r.throwError("elementWiseIterator: unequal row lengths while iterating through 2d array");for(var u=[],s=0;s<t[o].length;s++)u.push(e(t[o][s],n[o][s]));i.push(u)}else i.push(e(t[o],n[o]));return i}),r.register("scalarIterator",function(t,n){return n=n||pass,r.is2DArray(t)?t.map(function(r){return r.map(n)}):r.isArray(t)?t.map(n):n(t)})}}),define("base",["underscore"],function(r){return function(t){r.without(Object.getOwnPropertyNames(Math),"round").forEach(function(r){t.register(r,Math[r])}),t.register("sum",function(n){if(t.isArray(n)){if(!(n.length>0&&t.isArray(n[0])))return r.reduce(t.toFloat(n),function(r,t){return r+t},0);t.throwError("can't compute sum of >1d arrays")}else t.throwError("can't compute sum of non-array "+n)}),t.register("square",function(r){return parseFloat(r)*parseFloat(r)}),t.register("round",function(r,n){return n=n||0,t.scalarIterator(r,function(r){return parseFloat(new Number(r+"").toFixed(parseInt(n)))})})}}),define("converters",["underscore"],function(r){return function(t){t.register("unitConversionScale",function(t,n){var e={m:1,meter:1,cm:100,mm:1e3,um:1e6,nm:1e9,inch:39.37007874015748},a=r.keys(e);if(r.contains(a,n)&&r.contains(a,t))return parseFloat(e[n]/e[t]);throw new Error("no conversion for either "+t+" or "+n)}),t.register("toDegrees",function(r){return t.scalarIterator(r,function(r){return Math.abs(r)<=1e-10?0:180/Math.PI*r})}),t.register("toRadians",function(r){return t.scalarIterator(r,function(r){return Math.PI/180*r})}),t.register("toFloat",function(r){if(t.isNumber(r))return parseFloat(r);if(t.isNativeFloatArray(r))return r;if(t.isArray(r)){var n=function(r){return t.isNumber(r)?parseFloat(r):(t.throwError("toFloat: array has something in it that is not a number: "+r),void 0)};return t.is2DArray(r)?r.map(function(r){return r.map(n)}):r.map(n)}t.throwError("toFloat: can not convert to float: "+r)}),t.register("parseAxisAngle",function(n,e){var a,i,o=function(){throw new Error("parse axis and angle input was not something we recognized")};return t.isArray(n)?4==n.length&&void 0===e?(a=n.slice(0,3),i=n[3]):3==n.length&&void 0!==e?(a=n,i=e):o():r.isObject(n)&&void 0===e?n.hasOwnProperty("axis")&&n.hasOwnProperty("angle")?(a=n.axis,i=n.angle):o():o(),{axis:t.toFloat(a),angle:t.toFloat(i)}}),t.register("quatFromAxisAngle",function(r,n){var e=t.parseAxisAngle(r,n),a=e.axis,i=e.angle,o=t.sum(a.map(t.square));if(1e-10>=o)return[1,0,0,0];var u=i/2,s=Math.sin(u)/Math.sqrt(o);return[Math.cos(u),a[0]*s,a[1]*s,a[2]*s]}),t.register("quatFromMatrix",function(r){var n=t.toFloat(r),e=n[0][0]+n[1][1]+n[2][2],a=[0,0,0,0];return e>=0?(a[0]=e+1,a[1]=n[2][1]-n[1][2],a[2]=n[0][2]-n[2][0],a[3]=n[1][0]-n[0][1]):n[1][1]>n[0][0]?n[2][2]>n[1][1]?(a[3]=n[2][2]-(n[0][0]+n[1][1])+1,a[1]=n[2][0]+n[0][2],a[2]=n[1][2]+n[2][1],a[0]=n[1][0]-n[0][1]):(a[2]=n[1][1]-(n[2][2]+n[0][0])+1,a[3]=n[1][2]+n[2][1],a[1]=n[0][1]+n[1][0],a[0]=n[0][2]-n[2][0]):n[2][2]>n[0][0]?(a[3]=n[2][2]-(n[0][0]+n[1][1])+1,a[1]=n[2][0]+n[0][2],a[2]=n[1][2]+n[2][1],a[0]=n[1][0]-n[0][1]):(a[1]=n[0][0]-(n[1][1]+n[2][2])+1,a[2]=n[0][1]+n[1][0],a[3]=n[2][0]+n[0][2],a[0]=n[2][1]-n[1][2]),t.divide(a,t.magnitude(a))}),t.register("matrixFromQuat",function(r){var n=t.toFloat(r),e=t.square(t.magnitude(n));if(1e-8>=e)return m.eye(4);var a=2/e,i=a*n[1]*n[1],o=a*n[2]*n[2],u=a*n[3]*n[3],s=t.eye(4);return s[0][0]=1-o-u,s[0][1]=a*(n[1]*n[2]-n[0]*n[3]),s[0][2]=a*(n[1]*n[3]+n[0]*n[2]),s[1][0]=a*(n[1]*n[2]+n[0]*n[3]),s[1][1]=1-i-u,s[1][2]=a*(n[2]*n[3]-n[0]*n[1]),s[2][0]=a*(n[1]*n[3]-n[0]*n[2]),s[2][1]=a*(n[2]*n[3]+n[0]*n[1]),s[2][2]=1-i-o,s}),t.register("rot",function(r,n){var e=t.parseAxisAngle(r,n),a=e.axis,i=e.angle,o=function(r){return[[0,-r[2],r[1]],[r[2],0,-r[0]],[-r[1],r[0],0]]};a=t.normalize(a);var u=t.eye(3);return u=t.add(u,t.scalarMult(o(a),Math.sin(i))),u=t.add(u,t.matrixMult(t.scalarMult(o(a),1-Math.cos(i)),o(a))),t.matrix4(u)}),t.alias("matrixFromAxisAngle","rot"),t.register("axisAngleFromQuat",function(r){var n=t.toFloat(r),e=t.sum(n.slice(1,4).map(t.square)),a={axis:[1,0,0],angle:0};if(0===e)return a;if(n[0]*n[0]+e<=1e-8)throw new Error("invalid quaternion "+n);var i;i=n[0]<0?[-n[0],-n[1],-n[2],-n[3]]:n,e=Math.sqrt(e);var o=1/e,u=2*Math.atan2(e,i[0]);return{axis:[i[1]*o,i[2]*o,i[3]*o],angle:u}}),t.register("axisAngleFromMatrix",function(r){return t.axisAngleFromQuat(t.quatFromMatrix(r))}),t.register("zxyFromMatrix",function(r){var n,e,a,i=t.matrix4to3(t.toFloat(r)),o=1e-10;if(Math.abs(i[2][0])<o&&Math.abs(i[2][2])<o){var u=i[2][1];n=u>0?Math.PI/2:-Math.PI/2,a=0,e=Math.atan2(u*i[1][0],i[0][0])}else{e=Math.atan2(-i[2][0],i[2][2]);var s=Math.sin(e),c=Math.cos(e),l=[[c,0,-s],[0,1,0],[s,0,c]],f=t.matrixMult(i,l);n=Math.atan2(f[2][1],f[2][2]),a=Math.atan2(f[1][0],f[0][0])}return t.toDegrees([n,e,a])}),t.register("zyxFromMatrix",function(r){var n,e,a,i=t.toFloat(r),o=1e-10;if(Math.abs(i[2][1])<o&&Math.abs(i[2][2])<o)if(e=i[2][0]<=0?Math.PI/2:-Math.PI/2,e>0){var u=Math.atan2(i[0][1],i[1][1]);n=u,a=0}else{var s=-Math.atan2(i[0][1],i[1][1]);n=s,a=0}else{n=Math.atan2(i[2][1],i[2][2]);var c=Math.sin(n),l=Math.cos(n),f=[[1,0,0],[0,l,c],[0,-c,l]],h=t.matrixMult(t.matrix4to3(i),f);e=Math.atan2(-h[2][0],h[2][2]),a=Math.atan2(-h[0][1],h[1][1])}return t.toDegrees([n,e,a])}),t.register("matrixFromZXY",function(r){var n=t.toRadians(parseFloat(r[0])),e=t.toRadians(parseFloat(r[1])),a=t.toRadians(parseFloat(r[2]));return[[-Math.sin(n)*Math.sin(e)*Math.sin(a)+Math.cos(e)*Math.cos(a),-Math.sin(a)*Math.cos(n),Math.sin(n)*Math.sin(a)*Math.cos(e)+Math.sin(e)*Math.cos(a)],[Math.sin(n)*Math.sin(e)*Math.cos(a)+Math.sin(a)*Math.cos(e),Math.cos(n)*Math.cos(a),-Math.sin(n)*Math.cos(e)*Math.cos(a)+Math.sin(e)*Math.sin(a)],[-Math.sin(e)*Math.cos(n),Math.sin(n),Math.cos(n)*Math.cos(e)]]}),t.register("matrixFromZYX",function(r){var n=t.toRadians(parseFloat(r[0])),e=t.toRadians(parseFloat(r[1])),a=t.toRadians(parseFloat(r[2]));return[[Math.cos(e)*Math.cos(a),-Math.cos(n)*Math.sin(a)+Math.cos(a)*Math.sin(n)*Math.sin(e),Math.sin(n)*Math.sin(a)+Math.cos(n)*Math.cos(a)*Math.sin(e)],[Math.cos(e)*Math.sin(a),Math.cos(n)*Math.cos(a)+Math.sin(n)*Math.sin(e)*Math.sin(a),-Math.cos(a)*Math.sin(n)+Math.cos(n)*Math.sin(e)*Math.sin(a)],[-Math.sin(e),Math.cos(e)*Math.sin(n),Math.cos(n)*Math.cos(e)]]}),t.register("zxyFromQuat",function(r){return t.zxyFromMatrix(t.matrixFromQuat(t.toFloat(r)))}),t.register("quatFromZXY",function(r){return t.quatFromMatrix(t.matrixFromZXY(t.toFloat(r)))}),t.register("zyxFromQuat",function(r){return t.zyxFromMatrix(t.matrixFromQuat(t.toFloat(r)))}),t.register("quatFromZYX",function(r){return t.quatFromMatrix(t.matrixFromZYX(t.toFloat(r)))}),t.register("matrix4to3",function(r){return[[r[0][0],r[0][1],r[0][2]],[r[1][0],r[1][1],r[1][2]],[r[2][0],r[2][1],r[2][2]]]}),t.register("matrix4",function(r){return 3==r[0].length&&(r[0].push(0),r[1].push(0),r[2].push(0)),3==r.length&&r.push([0,0,0,1]),r}),t.register("composeTransform",function(r,t){return[[r[0][0],r[0][1],r[0][2],t[0]],[r[1][0],r[1][1],r[1][2],t[1]],[r[2][0],r[2][1],r[2][2],t[2]],[0,0,0,1]]}),t.register("decomposeTransform",function(r){var t=[r[0][3],r[1][3],r[2][3]],n=[r[0].slice(0,3),r[1].slice(0,3),r[2].slice(0,3)];return{rotationMatrix:n,translation:t}}),t.register("mjsToMujin",function(r){var t=r;return[[t[0],t[4],t[8],t[12]],[t[1],t[5],t[9],t[13]],[t[2],t[6],t[10],t[14]],[t[3],t[7],t[11],t[15]]]})}}),define("matrix",["underscore"],function(r){return function(t){t.register("add",function(r,n){return t.elementWiseIterator(t.toFloat(r),t.toFloat(n),function(r,t){return r+t})}),t.register("subtract",function(r,n){return t.elementWiseIterator(t.toFloat(r),t.toFloat(n),function(r,t){return r-t})}),t.register("eltMult",function(r,n){return t.elementWiseIterator(t.toFloat(r),t.toFloat(n),function(r,t){return r*t})}),t.register("scalarMult",function(r,n){return t.scalarIterator(t.toFloat(r),function(r){return r*parseFloat(n)})}),t.register("scalarDivide",function(r,n){return t.scalarIterator(t.toFloat(r),function(r){return r/parseFloat(n)})}),t.register("divide",t.scalarDivide),t.register("transpose",function(n){return t.is2DArray(n)?r.zip.apply(r,n):(t.throwError("can only transpose 2d arrays"),void 0)}),t.register("dot",function(r,n){return t.sum(t.eltMult(t.toFloat(r),t.toFloat(n)))}),t.register("cross",function(r,n){if(!t.isArray(r)||!t.isArray(n)||3!=r.length||3!=n.length)throw new Error("can't do a cross product with "+r+" and "+n);var e=t.toFloat(r),a=t.toFloat(n);return[e[1]*a[2]-e[2]*a[1],e[2]*a[0]-e[0]*a[2],e[0]*a[1]-e[1]*a[0]]}),t.register("eye",function(r,t){t=t||r;for(var n=[],e=0;t>e;e++){for(var a=[],i=0;r>i;i++)e==i?a.push(1):a.push(0);n.push(a)}return n}),t.register("identity",t.eye),t.register("zeros",function(r,t){t=t||r;for(var n=[],e=0;t>e;e++){for(var a=[],i=0;r>i;i++)a.push(0);n.push(a)}return n}),t.register("magnitude",function(r){return Math.sqrt(t.sum(t.toFloat(r).map(square)))}),t.register("norm",t.magnitude),t.register("normalize",function(r){var n=t.magnitude(r);if(0==n)throw new Error("Trying to normalize a zero array");return t.divide(r,n)}),t.register("translate",function(r){var n=t.eye(4);return n[0][3]=r[0],n[1][3]=r[1],n[2][3]=r[2],n}),t.register("transformLookat",function(r,n,e){var a=t.toFloat(r),i=t.toFloat(n),o=t.toFloat(e),u=t.subtract(a,i),s=t.norm(u);u=s>1e-15?t.scalarMult(u,1/s):[0,0,1];var c=t.subtract(o,t.scalarMult(u,t.dot(u,o)));s=t.norm(c),1e-8>s&&(c=[0,1,0],c=t.subtract(c,t.scalarMult(u,t.dot(u,c))),s=t.norm(c),1e-8>s&&(c=[1,0,0],c=t.subtract(c,t.scalarMult(u,t.dot(u,c))),s=t.norm(c))),c=t.scalarMult(c,1/s);var l=t.cross(c,u),f=t.eye(4);return f[0][0]=l[0],f[0][1]=c[0],f[0][2]=u[0],f[0][3]=i[0],f[1][0]=l[1],f[1][1]=c[1],f[1][2]=u[1],f[1][3]=i[1],f[2][0]=l[2],f[2][1]=c[2],f[2][2]=u[2],f[2][3]=i[2],f}),t.register("matrixMult",function(r,n){var e=t.toFloat(r),a=t.toFloat(n);if(e[0].length!==e.length)throw t.prettyPrint(e),t.prettyPrint(a),new Error("incompatible array sizes!");for(var i=[],o=0;o<e.length;o++){for(var u=[],s=0;s<a[o].length;s++){for(var c=0,l=0;l<e[o].length;l++)c+=e[o][l]*a[l][s];u.push(c)}i.push(u)}return i}),t.register("matrixMultWithRow",function(r,n){for(var e=t.toFloat(r),a=t.toFloat(n),i=new Array(e.length),o=0;o<e.length;++o){i[o]=0;for(var u=0;u<a.length;++u)i[o]+=e[o][u]*a[u]}return i})}}),define("tween",["underscore"],function(){return function(r){r.register("linearlyInterpolate",function(r,t,n,e,a){return(t*(n-a)+e*(a-r))/(n-r)})}}),define("shrike",["underscore","./utils","./iterators","./base","./converters","./matrix","./tween"],function(r,t,n,e,a,i,o){var u={};return t(u),n(u),e(u),a(u),i(u),o(u),void 0!==window.makeGlobal&&(window.makeGlobal(u),window.makeGlobal({math:u,shrike:u})),u});